<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebP ë³€í™˜ê¸° â€“ PNG, JPG â†” WebP ë¬´ë£Œ ì´ë¯¸ì§€ ë³€í™˜ | íˆ´íˆ´ë²„ìŠ¤</title>
<meta name="description" content="PNG, JPG, GIF ì´ë¯¸ì§€ë¥¼ WebPë¡œ, WebPë¥¼ PNG/JPGë¡œ ë¬´ë£Œ ë³€í™˜í•˜ì„¸ìš”. ë¦¬ì‚¬ì´ì¦ˆë„ ê°€ëŠ¥. ì„¤ì¹˜ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ë³€í™˜ë˜ë©°, ì„œë²„ ì „ì†¡ ì—†ì´ 100% ë¡œì»¬ ì²˜ë¦¬ë©ë‹ˆë‹¤.">
<meta name="keywords" content="WebP ë³€í™˜, PNG to WebP, JPG to WebP, WebP to PNG, WebP to JPG, ì´ë¯¸ì§€ ë³€í™˜, WebP ë³€í™˜ê¸°, ë¬´ë£Œ WebP ë³€í™˜, ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://webtoolbox.kr/webp-converter/">

<!-- Open Graph -->
<meta property="og:title" content="WebP ë³€í™˜ê¸° â€“ PNG, JPG â†” WebP ë¬´ë£Œ ì´ë¯¸ì§€ ë³€í™˜">
<meta property="og:description" content="PNG, JPG â†” WebP ì–‘ë°©í–¥ ë³€í™˜. ë¦¬ì‚¬ì´ì¦ˆ ì§€ì›. ì„œë²„ ì „ì†¡ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì²˜ë¦¬.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://webtoolbox.kr/webp-converter/">
<meta property="og:site_name" content="íˆ´íˆ´ë²„ìŠ¤">
<meta property="og:locale" content="ko_KR">

<!-- Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebP ë³€í™˜ê¸° â€“ PNG, JPG â†” WebP ë¬´ë£Œ ë³€í™˜">
<meta name="twitter:description" content="PNG, JPG â†” WebP ì–‘ë°©í–¥ ë³€í™˜. ë¦¬ì‚¬ì´ì¦ˆ ì§€ì›. 100% ë¸Œë¼ìš°ì € ì²˜ë¦¬.">

<!-- JSON-LD: WebApplication -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "WebP ë³€í™˜ê¸°",
  "description": "PNG, JPG, GIF ì´ë¯¸ì§€ë¥¼ WebPë¡œ, WebPë¥¼ PNG/JPGë¡œ ë¬´ë£Œ ë³€í™˜í•˜ëŠ” ì˜¨ë¼ì¸ ë„êµ¬",
  "url": "https://webtoolbox.kr/webp-converter/",
  "applicationCategory": "MultimediaApplication",
  "operatingSystem": "Any",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" },
  "isPartOf": { "@type": "WebSite", "name": "íˆ´íˆ´ë²„ìŠ¤", "url": "https://webtoolbox.kr" }
}
</script>

<!-- JSON-LD: FAQPage -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "WebP í¬ë§·ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "WebPëŠ” êµ¬ê¸€ì´ ê°œë°œí•œ ì´ë¯¸ì§€ í¬ë§·ìœ¼ë¡œ, JPGì™€ PNG ëŒ€ë¹„ 25~35% ë” ì‘ì€ íŒŒì¼ í¬ê¸°ë¥¼ ì œê³µí•˜ë©´ì„œë„ ë¹„ìŠ·í•œ í™”ì§ˆì„ ìœ ì§€í•©ë‹ˆë‹¤. í˜„ì¬ ëŒ€ë¶€ë¶„ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤." }
    },
    {
      "@type": "Question",
      "name": "ë³€í™˜í•˜ë©´ í™”ì§ˆì´ ë–¨ì–´ì§€ë‚˜ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "í’ˆì§ˆ ì„¤ì •ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. 80% ì´ìƒìœ¼ë¡œ ì„¤ì •í•˜ë©´ ìœ¡ì•ˆìœ¼ë¡œ ê±°ì˜ ì°¨ì´ë¥¼ ëŠë¼ê¸° ì–´ë µìŠµë‹ˆë‹¤." }
    },
    {
      "@type": "Question",
      "name": "WebPë¥¼ PNGë‚˜ JPGë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‚˜ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "ë„¤. ì¶œë ¥ í¬ë§·ì„ PNG ë˜ëŠ” JPGë¡œ ì„ íƒí•˜ë©´ WebP íŒŒì¼ì„ ë‹¤ë¥¸ í¬ë§·ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
    },
    {
      "@type": "Question",
      "name": "íˆ¬ëª… ë°°ê²½(ì•ŒíŒŒ ì±„ë„)ë„ ìœ ì§€ë˜ë‚˜ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "WebPì™€ PNGëŠ” íˆ¬ëª… ë°°ê²½ì„ ì§€ì›í•©ë‹ˆë‹¤. JPGë¡œ ë³€í™˜í•  ê²½ìš° íˆ¬ëª… ì˜ì—­ì´ í°ìƒ‰ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤." }
    },
    {
      "@type": "Question",
      "name": "ë³€í™˜ëœ íŒŒì¼ì€ ì„œë²„ì— ì €ì¥ë˜ë‚˜ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "ì•„ë‹ˆìš”. ëª¨ë“  ë³€í™˜ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬ë˜ë©°, ì´ë¯¸ì§€ê°€ ì™¸ë¶€ ì„œë²„ë¡œ ì „ì†¡ë˜ê±°ë‚˜ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤." }
    },
    {
      "@type": "Question",
      "name": "ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‚˜ìš”?",
      "acceptedAnswer": { "@type": "Answer", "text": "ë„¤. ë¦¬ì‚¬ì´ì¦ˆ ì˜µì…˜ì„ ì¼œë©´ ìµœëŒ€ ë„ˆë¹„ë¥¼ ì§€ì •í•˜ì—¬ ì´ë¯¸ì§€ í•´ìƒë„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹„ìœ¨ì€ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤." }
    }
  ]
}
</script>

<!-- JSON-LD: BreadcrumbList -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "íˆ´íˆ´ë²„ìŠ¤", "item": "https://webtoolbox.kr" },
    { "@type": "ListItem", "position": 2, "name": "WebP ë³€í™˜ê¸°", "item": "https://webtoolbox.kr/webp-converter/" }
  ]
}
</script>

<link rel="icon" href="/favicon.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<!-- JSZip for ZIP download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --bg: #f6f7f9; --surface: #ffffff; --border: #e4e6eb;
    --text: #1a1c20; --text-sub: #5f6368; --text-muted: #9aa0a8;
    --accent: #2563eb; --accent-hover: #1d4ed8; --accent-light: #eff4ff;
    --green: #16a34a; --green-light: #dcfce7;
    --red: #dc2626; --red-light: #fef2f2;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.06), 0 2px 4px rgba(0,0,0,0.04);
    --radius: 14px; --radius-sm: 10px;
  }
  body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; -webkit-font-smoothing: antialiased; }

  .nav { background: rgba(255,255,255,0.92); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; backdrop-filter: blur(12px); }
  .nav-inner { max-width: 960px; margin: 0 auto; padding: 0 24px; height: 56px; display: flex; align-items: center; gap: 10px; }
  .nav-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text); }
  .nav-logo img { width: 30px; height: 30px; border-radius: 7px; }
  .nav-logo-text { font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 17px; }
  .nav-sep { color: var(--border); font-size: 20px; font-weight: 300; }
  .nav-page { font-size: 14px; color: var(--text-sub); font-weight: 500; }

  .container { max-width: 960px; margin: 0 auto; padding: 28px 24px 80px; }

  .page-header { text-align: center; margin-bottom: 24px; }
  .page-header h1 { font-family: 'Outfit', sans-serif; font-size: 30px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 8px; }
  .page-header p { font-size: 15px; color: var(--text-sub); max-width: 540px; margin: 0 auto; }

  .ad-slot { margin: 20px 0; }
  .ad-banner { background: var(--surface); border: 1px dashed var(--border); border-radius: var(--radius-sm); min-height: 90px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 13px; }

  /* Dropzone */
  .dropzone {
    background: var(--surface); border: 2px dashed var(--border); border-radius: var(--radius);
    padding: 40px 28px; text-align: center; cursor: pointer; transition: all 0.2s;
    margin-bottom: 16px;
  }
  .dropzone:hover, .dropzone.dragover { border-color: var(--accent); background: var(--accent-light); }
  .dropzone.disabled { opacity: 0.5; pointer-events: none; cursor: not-allowed; }
  .dropzone-icon { font-size: 44px; margin-bottom: 10px; }
  .dropzone-text { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 5px; }
  .dropzone-sub { font-size: 12px; color: var(--text-muted); }
  .dropzone-btn {
    display: inline-block; margin-top: 14px; padding: 9px 22px;
    background: var(--accent); color: #fff; border-radius: 8px;
    font-size: 13px; font-weight: 600; pointer-events: none;
  }

  /* Settings */
  .settings {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 16px 20px; margin-bottom: 16px; display: flex; align-items: center;
    gap: 16px; flex-wrap: wrap; box-shadow: var(--shadow-sm);
  }
  .setting-group { display: flex; align-items: center; gap: 8px; }
  .setting-label { font-size: 13px; font-weight: 600; color: var(--text-sub); white-space: nowrap; }
  .quality-slider { width: 140px; accent-color: var(--accent); cursor: pointer; height: 6px; }
  .quality-value {
    font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600;
    color: var(--accent); min-width: 36px; text-align: center;
  }
  .format-select, .resize-input {
    padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px;
    font-size: 13px; font-family: 'Noto Sans KR', sans-serif;
    color: var(--text); background: var(--surface); cursor: pointer; min-height: 36px;
  }
  .resize-input { width: 70px; font-family: 'JetBrains Mono', monospace; text-align: center; }
  .resize-input:disabled { opacity: 0.4; cursor: not-allowed; }
  .toggle-wrap { display: flex; align-items: center; gap: 6px; }
  .toggle {
    width: 38px; height: 22px; border-radius: 11px; background: var(--border);
    position: relative; cursor: pointer; transition: background 0.2s; border: none; padding: 0;
  }
  .toggle::after {
    content: ''; position: absolute; top: 3px; left: 3px;
    width: 16px; height: 16px; border-radius: 50%; background: #fff;
    transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }
  .toggle.on { background: var(--accent); }
  .toggle.on::after { transform: translateX(16px); }
  .settings-sep { width: 1px; height: 24px; background: var(--border); flex-shrink: 0; }

  /* Progress */
  .progress-bar {
    width: 100%; height: 4px; background: var(--border); border-radius: 2px;
    margin-bottom: 12px; overflow: hidden; display: none;
  }
  .progress-bar.show { display: block; }
  .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.3s ease; }

  /* Results */
  .results { display: flex; flex-direction: column; gap: 10px; }
  .result-item {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 14px 18px; box-shadow: var(--shadow-sm);
    display: grid; grid-template-columns: 56px 1fr auto; gap: 14px; align-items: center;
  }
  .result-thumb {
    width: 56px; height: 56px; border-radius: 8px; object-fit: cover;
    background: var(--bg); border: 1px solid var(--border); cursor: pointer; transition: opacity 0.15s;
  }
  .result-thumb:hover { opacity: 0.8; }
  .result-info { min-width: 0; }
  .result-name { font-size: 13px; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 3px; }
  .result-meta { font-size: 11px; color: var(--text-muted); display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .result-meta span { white-space: nowrap; }
  .result-arrow { color: var(--text-muted); }
  .result-size-new { font-weight: 600; color: var(--text); }
  .result-saving { font-weight: 600; }
  .result-saving.good { color: var(--green); }
  .result-saving.bad { color: var(--red); }
  .result-dim { color: var(--text-muted); font-size: 10px; }
  .result-actions { display: flex; gap: 6px; flex-shrink: 0; }

  .btn {
    padding: 8px 14px; border: none; border-radius: 7px; font-size: 12px;
    font-weight: 600; cursor: pointer; font-family: 'Noto Sans KR', sans-serif;
    transition: all 0.15s; min-height: 36px; display: inline-flex; align-items: center; gap: 4px;
  }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover:not(:disabled) { background: var(--accent-hover); }
  .btn-outline { background: var(--bg); color: var(--text-sub); border: 1px solid var(--border); }
  .btn-outline:hover:not(:disabled) { border-color: var(--accent); color: var(--accent); }
  .btn-outline.danger:hover:not(:disabled) { border-color: var(--red); color: var(--red); }
  .btn-green { background: var(--green); color: #fff; }
  .btn-green:hover:not(:disabled) { background: #15803d; }

  /* Batch bar */
  .batch-bar {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 14px 20px; margin-top: 12px; display: none; align-items: center;
    justify-content: space-between; box-shadow: var(--shadow-sm); flex-wrap: wrap; gap: 10px;
  }
  .batch-bar.show { display: flex; }
  .batch-info { font-size: 13px; font-weight: 500; color: var(--text-sub); }
  .batch-info strong { color: var(--text); }
  .batch-actions { display: flex; gap: 6px; }

  /* Preview Modal */
  .preview-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000;
    display: none; align-items: center; justify-content: center;
    cursor: zoom-out; padding: 24px;
  }
  .preview-overlay.show { display: flex; }
  .preview-overlay img {
    max-width: 100%; max-height: 100%; object-fit: contain;
    border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .preview-close {
    position: absolute; top: 16px; right: 20px;
    background: rgba(255,255,255,0.15); border: none; color: #fff;
    width: 40px; height: 40px; border-radius: 50%; font-size: 20px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(8px); transition: background 0.2s;
  }
  .preview-close:hover { background: rgba(255,255,255,0.3); }
  .preview-info {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.6); color: #fff; padding: 8px 16px; border-radius: 8px;
    font-size: 12px; font-family: 'JetBrains Mono', monospace; backdrop-filter: blur(8px);
    white-space: nowrap;
  }

  /* Privacy */
  .privacy {
    text-align: center; margin-top: 20px; padding: 12px;
    background: var(--green-light); border-radius: var(--radius-sm);
    font-size: 12px; color: var(--green); font-weight: 600;
  }

  .toast {
    position: fixed; bottom: 30px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--text); color: #fff; padding: 10px 20px;
    border-radius: 8px; font-size: 13px; font-weight: 500;
    opacity: 0; transition: all 0.3s; z-index: 999; pointer-events: none;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  .usage-section { margin-top: 36px; }
  .usage-section h2 { font-size: 20px; font-weight: 700; margin-bottom: 10px; }
  .usage-desc { color: var(--text-sub); font-size: 14px; line-height: 1.8; }

  .faq-section { margin-top: 36px; }
  .faq-section h2 { font-size: 20px; font-weight: 700; margin-bottom: 16px; }
  .faq-item { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 8px; overflow: hidden; }
  .faq-q { padding: 14px 18px; font-weight: 500; font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: 12px; min-height: 48px; user-select: none; -webkit-user-select: none; }
  .faq-q::after { content: '+'; font-size: 20px; color: var(--text-muted); transition: transform 0.2s; flex-shrink: 0; }
  .faq-item.open .faq-q::after { transform: rotate(45deg); }
  .faq-a { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
  .faq-a-inner { padding: 0 18px 14px; color: var(--text-sub); font-size: 14px; line-height: 1.8; }
  .faq-item.open .faq-a { max-height: 300px; }

  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .fade-up { animation: fadeUp 0.3s ease forwards; }

  @media (max-width: 640px) {
    .container { padding: 20px 16px 60px; }
    .page-header h1 { font-size: 22px; }
    .page-header p { font-size: 13px; }
    .dropzone { padding: 32px 20px; }
    .dropzone-icon { font-size: 36px; }
    .dropzone-text { font-size: 14px; }
    .result-item { grid-template-columns: 48px 1fr; gap: 10px; padding: 12px 14px; }
    .result-thumb { width: 48px; height: 48px; }
    .result-actions { grid-column: 1 / -1; justify-content: flex-end; }
    .settings { padding: 14px 16px; gap: 10px; }
    .settings-sep { display: none; }
    .quality-slider { width: 100px; }
    .btn { padding: 7px 12px; font-size: 11px; min-height: 34px; }
    .faq-q { padding: 12px 14px; font-size: 13px; }
    .faq-a-inner { font-size: 13px; padding: 0 14px 12px; }
  }
</style>
</head>
<body>

<nav class="nav" aria-label="ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜">
  <div class="nav-inner">
    <a href="/" class="nav-logo" aria-label="íˆ´íˆ´ë²„ìŠ¤ í™ˆ">
      <img src="/favicon.png" alt="íˆ´íˆ´ë²„ìŠ¤" width="30" height="30">
      <span class="nav-logo-text">íˆ´íˆ´ë²„ìŠ¤</span>
    </a>
    <span class="nav-sep" aria-hidden="true">/</span>
    <span class="nav-page">WebP ë³€í™˜ê¸°</span>
  </div>
</nav>

<main class="container">
  <header class="page-header">
    <h1>WebP ë³€í™˜ê¸°</h1>
    <p>PNG, JPG, GIF â†’ WebP ë³€í™˜ì€ ë¬¼ë¡ , WebP â†’ PNG/JPG ì—­ë³€í™˜ë„ ì§€ì›í•©ë‹ˆë‹¤. ë¦¬ì‚¬ì´ì¦ˆê¹Œì§€ í•œë²ˆì—.</p>
  </header>

  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>

  <!-- Dropzone -->
  <div class="dropzone" id="dropzone">
    <div class="dropzone-icon">ğŸ–¼ï¸</div>
    <div class="dropzone-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</div>
    <div class="dropzone-sub">PNG, JPG, GIF, BMP, WebP ì§€ì› Â· ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ë³€í™˜ ê°€ëŠ¥</div>
    <div class="dropzone-btn">íŒŒì¼ ì„ íƒ</div>
    <input type="file" id="fileInput" accept="image/png,image/jpeg,image/gif,image/bmp,image/webp" multiple hidden>
  </div>

  <!-- Settings -->
  <div class="settings">
    <div class="setting-group">
      <span class="setting-label">ì¶œë ¥</span>
      <select class="format-select" id="formatSelect" aria-label="ì¶œë ¥ í¬ë§· ì„ íƒ">
        <option value="webp" selected>WebP</option>
        <option value="png">PNG</option>
        <option value="jpeg">JPG</option>
      </select>
    </div>

    <div class="settings-sep"></div>

    <div class="setting-group">
      <span class="setting-label">í’ˆì§ˆ</span>
      <input type="range" class="quality-slider" id="qualitySlider" min="1" max="100" value="80" aria-label="ë³€í™˜ í’ˆì§ˆ">
      <span class="quality-value" id="qualityValue">80%</span>
    </div>

    <div class="settings-sep"></div>

    <div class="setting-group">
      <div class="toggle-wrap">
        <button class="toggle" id="resizeToggle" type="button" aria-label="ë¦¬ì‚¬ì´ì¦ˆ ì¼œê¸°/ë„ê¸°"></button>
        <span class="setting-label">ë¦¬ì‚¬ì´ì¦ˆ</span>
      </div>
      <span class="setting-label" style="color:var(--text-muted);font-size:11px;">ìµœëŒ€ ë„ˆë¹„</span>
      <input type="number" class="resize-input" id="resizeWidth" value="1920" min="100" max="9999" disabled aria-label="ìµœëŒ€ ë„ˆë¹„ ì…ë ¥">
      <span style="font-size:11px;color:var(--text-muted);">px</span>
    </div>
  </div>

  <!-- Progress -->
  <div class="progress-bar" id="progressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
    <div class="progress-fill" id="progressFill" style="width:0%"></div>
  </div>

  <!-- Results -->
  <div class="results" id="results"></div>

  <!-- Batch bar -->
  <div class="batch-bar" id="batchBar">
    <div class="batch-info" id="batchInfo"></div>
    <div class="batch-actions">
      <button class="btn btn-green" id="btnDownloadAll">ğŸ“¥ ZIP ë‹¤ìš´ë¡œë“œ</button>
      <button class="btn btn-outline danger" id="btnClearAll">âœ• ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="privacy">ğŸ”’ ì„œë²„ ì „ì†¡ ì—†ìŒ â€“ ëª¨ë“  ë³€í™˜ì€ 100% ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤</div>

  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>

  <!-- Usage -->
  <section class="usage-section">
    <h2>WebP ë³€í™˜ê¸° ì‚¬ìš©ë²•</h2>
    <p class="usage-desc">
      ì´ë¯¸ì§€ íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ íŒŒì¼ ì„ íƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ë³€í™˜ì´ ì‹œì‘ë©ë‹ˆë‹¤. ì¶œë ¥ í¬ë§·ì€ WebP, PNG, JPG ì¤‘ ì„ íƒí•  ìˆ˜ ìˆì–´ ì–‘ë°©í–¥ ë³€í™˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. WebP íŒŒì¼ì„ ë°›ì•˜ëŠ”ë° ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì—ì„œ ì—´ë¦¬ì§€ ì•Šì„ ë•Œ, JPGë‚˜ PNGë¡œ ì—­ë³€í™˜í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤. í’ˆì§ˆ ìŠ¬ë¼ì´ë”ë¡œ íŒŒì¼ í¬ê¸°ì™€ í™”ì§ˆ ì‚¬ì´ì˜ ê· í˜•ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìœ¼ë©°, 80% ì´ìƒì´ë©´ ìœ¡ì•ˆìœ¼ë¡œ ê±°ì˜ ì°¨ì´ë¥¼ ëŠë¼ê¸° ì–´ë µìŠµë‹ˆë‹¤. ë¦¬ì‚¬ì´ì¦ˆ ì˜µì…˜ì„ ì¼œë©´ ìµœëŒ€ ë„ˆë¹„ë¥¼ ì§€ì •í•˜ì—¬ ì´ë¯¸ì§€ í•´ìƒë„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìœ¼ë©°, ê°€ë¡œì„¸ë¡œ ë¹„ìœ¨ì€ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤. ì—¬ëŸ¬ íŒŒì¼ì„ í•œë²ˆì— ë³€í™˜í•˜ê³  ZIP íŒŒì¼ë¡œ ì¼ê´„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ì²˜ë¦¬ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì´ë£¨ì–´ì§€ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </p>
  </section>

  <!-- FAQ -->
  <section class="faq-section">
    <h2>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ğŸ’¬</h2>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">WebP í¬ë§·ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">WebPëŠ” êµ¬ê¸€ì´ ê°œë°œí•œ ì´ë¯¸ì§€ í¬ë§·ìœ¼ë¡œ, JPGì™€ PNG ëŒ€ë¹„ 25~35% ë” ì‘ì€ íŒŒì¼ í¬ê¸°ë¥¼ ì œê³µí•˜ë©´ì„œë„ ë¹„ìŠ·í•œ í™”ì§ˆì„ ìœ ì§€í•©ë‹ˆë‹¤. í˜„ì¬ Chrome, Firefox, Safari, Edge ë“± ëŒ€ë¶€ë¶„ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">ë³€í™˜í•˜ë©´ í™”ì§ˆì´ ë–¨ì–´ì§€ë‚˜ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">í’ˆì§ˆ ì„¤ì •ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. 80% ì´ìƒìœ¼ë¡œ ì„¤ì •í•˜ë©´ ìœ¡ì•ˆìœ¼ë¡œ ê±°ì˜ ì°¨ì´ë¥¼ ëŠë¼ê¸° ì–´ë µìŠµë‹ˆë‹¤. í’ˆì§ˆì„ ë‚®ì¶œìˆ˜ë¡ íŒŒì¼ í¬ê¸°ëŠ” ì¤„ì§€ë§Œ í™”ì§ˆ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. PNG ì¶œë ¥ì€ ë¬´ì†ì‹¤ì´ë¯€ë¡œ í’ˆì§ˆ ì„¤ì •ê³¼ ë¬´ê´€í•©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">WebPë¥¼ PNGë‚˜ JPGë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‚˜ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">ë„¤. ì¶œë ¥ í¬ë§·ì„ PNG ë˜ëŠ” JPGë¡œ ì„ íƒí•˜ë©´ WebP íŒŒì¼ì„ ë‹¤ë¥¸ í¬ë§·ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. WebP íŒŒì¼ì´ íŠ¹ì • í”„ë¡œê·¸ë¨ì—ì„œ ì—´ë¦¬ì§€ ì•Šì„ ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">íˆ¬ëª… ë°°ê²½(ì•ŒíŒŒ ì±„ë„)ë„ ìœ ì§€ë˜ë‚˜ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">WebPì™€ PNGëŠ” íˆ¬ëª… ë°°ê²½ì„ ì§€ì›í•©ë‹ˆë‹¤. ë‹¤ë§Œ JPGë¡œ ë³€í™˜í•  ê²½ìš° íˆ¬ëª… ì˜ì—­ì´ í°ìƒ‰ ë°°ê²½ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.</div></div>
    </div>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">ì´ë¯¸ì§€ í¬ê¸°(í•´ìƒë„)ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‚˜ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">ë„¤. ë¦¬ì‚¬ì´ì¦ˆ ì˜µì…˜ì„ ì¼œê³  ìµœëŒ€ ë„ˆë¹„ë¥¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ ë„ˆë¹„ ì´ìƒì˜ ì´ë¯¸ì§€ê°€ ìë™ìœ¼ë¡œ ì¶•ì†Œë©ë‹ˆë‹¤. ê°€ë¡œì„¸ë¡œ ë¹„ìœ¨ì€ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤. ì´ë¯¸ ì§€ì • ë„ˆë¹„ë³´ë‹¤ ì‘ì€ ì´ë¯¸ì§€ëŠ” ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div></div>
    </div>
    <div class="faq-item">
      <div class="faq-q" onclick="toggleFaq(this)">ë³€í™˜ëœ íŒŒì¼ì€ ì„œë²„ì— ì €ì¥ë˜ë‚˜ìš”?</div>
      <div class="faq-a"><div class="faq-a-inner">ì•„ë‹ˆìš”. ëª¨ë“  ë³€í™˜ ê³¼ì •ì€ ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì´ë£¨ì–´ì§€ë©°, ì´ë¯¸ì§€ê°€ ì™¸ë¶€ ì„œë²„ë¡œ ì „ì†¡ë˜ê±°ë‚˜ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ë‹«ìœ¼ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</div></div>
    </div>
  </section>

  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>
</main>

<!-- Preview Modal (#7) -->
<div class="preview-overlay" id="previewOverlay">
  <button class="preview-close" id="previewClose" aria-label="ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°">âœ•</button>
  <img id="previewImg" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
  <div class="preview-info" id="previewInfo"></div>
</div>

<div class="toast" id="toast" role="alert" aria-live="polite"></div>

<script>
const $ = (sel) => document.querySelector(sel);
const dropzone = $('#dropzone');
const fileInput = $('#fileInput');
const qualitySlider = $('#qualitySlider');
const qualityValue = $('#qualityValue');
const formatSelect = $('#formatSelect');
const resizeToggle = $('#resizeToggle');
const resizeWidth = $('#resizeWidth');
const resultsEl = $('#results');
const progressBar = $('#progressBar');
const progressFill = $('#progressFill');
const batchBar = $('#batchBar');
const batchInfo = $('#batchInfo');
const btnDownloadAll = $('#btnDownloadAll');
const btnClearAll = $('#btnClearAll');
const toastEl = $('#toast');
const previewOverlay = $('#previewOverlay');
const previewImg = $('#previewImg');
const previewInfo = $('#previewInfo');

let convertedFiles = [];
let isProcessing = false; // (#4) ë³€í™˜ ì¤‘ ì ê¸ˆ í”Œë˜ê·¸

// === Quality slider ===
qualitySlider.addEventListener('input', () => {
  qualityValue.textContent = qualitySlider.value + '%';
});

// === Format change: disable quality for PNG (lossless) (#3 fix) ===
formatSelect.addEventListener('change', () => {
  const isPng = formatSelect.value === 'png';
  qualitySlider.disabled = isPng;
  qualitySlider.style.opacity = isPng ? '0.4' : '1';
  qualityValue.textContent = isPng ? 'ë¬´ì†ì‹¤' : qualitySlider.value + '%';
});

// === Resize toggle ===
resizeToggle.addEventListener('click', () => {
  const on = resizeToggle.classList.toggle('on');
  resizeWidth.disabled = !on;
});

// === Dropzone ===
dropzone.addEventListener('click', () => {
  if (isProcessing) return; // (#4)
  fileInput.click();
});
dropzone.addEventListener('dragover', (e) => {
  e.preventDefault();
  if (!isProcessing) dropzone.classList.add('dragover');
});
dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
dropzone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  if (isProcessing) { showToast('ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ì‹œë„í•˜ì„¸ìš”.'); return; } // (#4)

  const allFiles = Array.from(e.dataTransfer.files);
  const imageFiles = allFiles.filter(f => f.type.startsWith('image/'));

  // (#6) ë¹„ì´ë¯¸ì§€ íŒŒì¼ í•„í„°ë§ í† ìŠ¤íŠ¸
  if (imageFiles.length === 0 && allFiles.length > 0) {
    showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤ (PNG, JPG, GIF, BMP, WebP)');
    return;
  }
  if (imageFiles.length < allFiles.length) {
    showToast(`ì´ë¯¸ì§€ê°€ ì•„ë‹Œ ${allFiles.length - imageFiles.length}ê°œ íŒŒì¼ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤`);
  }

  if (imageFiles.length) processFiles(imageFiles);
});
fileInput.addEventListener('change', () => {
  if (fileInput.files.length) processFiles(Array.from(fileInput.files));
  fileInput.value = '';
});

// === (#4) ë³€í™˜ ì¤‘ ë“œë¡­ì¡´ ì ê¸ˆ ===
function setProcessing(val) {
  isProcessing = val;
  dropzone.classList.toggle('disabled', val);
}

// === Process files ===
async function processFiles(files) {
  const quality = qualitySlider.value / 100;
  const format = formatSelect.value;
  const doResize = resizeToggle.classList.contains('on');
  const maxW = parseInt(resizeWidth.value) || 9999;

  setProcessing(true); // (#4)
  progressBar.classList.add('show');
  progressFill.style.width = '0%';

  let failCount = 0;

  for (let i = 0; i < files.length; i++) {
    const pct = ((i / files.length) * 100);
    progressFill.style.width = pct + '%';
    progressBar.setAttribute('aria-valuenow', Math.round(pct));

    const success = await convertImage(files[i], format, quality, doResize, maxW);
    if (!success) failCount++;
  }

  progressFill.style.width = '100%';
  progressBar.setAttribute('aria-valuenow', 100);
  setTimeout(() => progressBar.classList.remove('show'), 500);
  setProcessing(false); // (#4)
  updateBatchBar();

  // (#5) ì‹¤íŒ¨ ì•Œë¦¼
  if (failCount > 0) {
    showToast(`${failCount}ê°œ íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨ (ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í¬ê±°ë‚˜ ì†ìƒë¨)`);
  }
}

function convertImage(file, format, quality, doResize, maxW) {
  return new Promise((resolve) => {
    const img = new Image();
    const url = URL.createObjectURL(file);

    img.onload = () => {
      let w = img.naturalWidth;
      let h = img.naturalHeight;
      const origW = w, origH = h;

      // (#5) ë§¤ìš° í° ì´ë¯¸ì§€ ê²½ê³  (Canvas ì œí•œ ë°©ì–´)
      const MAX_CANVAS = 16384;
      if (w > MAX_CANVAS || h > MAX_CANVAS) {
        const scale = Math.min(MAX_CANVAS / w, MAX_CANVAS / h);
        w = Math.floor(w * scale);
        h = Math.floor(h * scale);
      }

      // Resize if enabled
      if (doResize && w > maxW) {
        h = Math.round(h * (maxW / w));
        w = maxW;
      }

      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');

      if (format === 'jpeg') {
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, w, h);
      }

      ctx.drawImage(img, 0, 0, w, h);

      const mime = 'image/' + format;
      const q = format === 'png' ? undefined : quality;

      canvas.toBlob((blob) => {
        URL.revokeObjectURL(url);

        // Canvas ë©”ëª¨ë¦¬ í•´ì œ (GPU ë¹„íŠ¸ë§µ ì¦‰ì‹œ ë°˜í™˜)
        canvas.width = 0;
        canvas.height = 0;

        if (!blob) { resolve(false); return; }

        const ext = format === 'jpeg' ? 'jpg' : format;
        const originalName = file.name.replace(/\.[^.]+$/, '');

        // (#2) ì¤‘ë³µ íŒŒì¼ëª… ì²˜ë¦¬
        const desiredName = originalName + '.' + ext;
        const uniqueName = getUniqueName(desiredName);

        const item = {
          name: uniqueName,
          originalName: file.name,
          originalSize: file.size,
          newSize: blob.size,
          blob: blob,
          thumbUrl: URL.createObjectURL(blob),
          origW: origW, origH: origH,
          newW: w, newH: h,
          format: ext.toUpperCase(),
        };

        convertedFiles.push(item);
        addResultItem(item, convertedFiles.length - 1);
        resolve(true);
      }, mime, q);
    };

    img.onerror = () => { URL.revokeObjectURL(url); resolve(false); }; // (#5)
    img.src = url;
  });
}

// === (#2) ì¤‘ë³µ íŒŒì¼ëª… ì²˜ë¦¬ ===
function getUniqueName(name) {
  const existing = convertedFiles.filter(f => f !== null).map(f => f.name);
  if (!existing.includes(name)) return name;

  const dotIdx = name.lastIndexOf('.');
  const base = dotIdx > 0 ? name.substring(0, dotIdx) : name;
  const ext = dotIdx > 0 ? name.substring(dotIdx) : '';

  let counter = 1;
  let candidate;
  do {
    candidate = `${base} (${counter})${ext}`;
    counter++;
  } while (existing.includes(candidate));

  return candidate;
}

// === Result item ===
function addResultItem(f, idx) {
  const saving = ((1 - f.newSize / f.originalSize) * 100);
  const isGood = saving > 0;
  const resized = (f.origW !== f.newW || f.origH !== f.newH);

  const item = document.createElement('div');
  item.className = 'result-item fade-up';
  item.setAttribute('data-idx', idx);
  item.innerHTML = `
    <img class="result-thumb" src="${f.thumbUrl}" alt="${f.name}" loading="lazy"
         onclick="openPreview(${idx})" title="í´ë¦­í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°">
    <div class="result-info">
      <div class="result-name" title="${f.name}">${f.name}</div>
      <div class="result-meta">
        <span>${formatSize(f.originalSize)}</span>
        <span class="result-arrow">â†’</span>
        <span class="result-size-new">${formatSize(f.newSize)}</span>
        <span class="result-saving ${isGood ? 'good' : 'bad'}">
          ${isGood ? 'â–¼' : 'â–²'} ${Math.abs(saving).toFixed(1)}%
        </span>
        <span class="result-dim">${resized ? f.origW + 'Ã—' + f.origH + ' â†’ ' : ''}${f.newW}Ã—${f.newH}</span>
      </div>
    </div>
    <div class="result-actions">
      <button class="btn btn-primary" onclick="downloadFile(${idx})" aria-label="${f.name} ë‹¤ìš´ë¡œë“œ">ğŸ’¾</button>
      <button class="btn btn-outline" onclick="removeFile(${idx}, this)" title="ì‚­ì œ" aria-label="${f.name} ì‚­ì œ">âœ•</button>
    </div>
  `;
  resultsEl.appendChild(item);
}

// === (#7) ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ===
function openPreview(idx) {
  const f = convertedFiles[idx];
  if (!f) return;
  previewImg.src = f.thumbUrl;
  previewImg.alt = f.name;
  previewInfo.textContent = `${f.name} Â· ${f.newW}Ã—${f.newH} Â· ${formatSize(f.newSize)}`;
  previewOverlay.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closePreview() {
  previewOverlay.classList.remove('show');
  document.body.style.overflow = '';
  previewImg.src = '';
}

previewOverlay.addEventListener('click', (e) => {
  if (e.target === previewOverlay || e.target === $('#previewClose')) closePreview();
});
$('#previewClose').addEventListener('click', closePreview);
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && previewOverlay.classList.contains('show')) closePreview();
});

// === Download single ===
function downloadFile(index) {
  const f = convertedFiles[index];
  if (!f || !f.blob) return;
  const a = document.createElement('a');
  const url = URL.createObjectURL(f.blob);
  a.href = url;
  a.download = f.name;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  // DOM ì œê±° + URL í•´ì œëŠ” ì§€ì—° (ë‹¤ìš´ë¡œë“œ ì‹œì‘ ë³´ì¥)
  setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 1500);
}

// === Remove single ===
function removeFile(index, btnEl) {
  if (convertedFiles[index]) {
    URL.revokeObjectURL(convertedFiles[index].thumbUrl);
    convertedFiles[index] = null;
  }
  const item = btnEl.closest('.result-item');
  if (item) item.remove();
  updateBatchBar();
}

// === Clear all ===
btnClearAll.addEventListener('click', () => {
  convertedFiles.forEach(f => { if (f) URL.revokeObjectURL(f.thumbUrl); });
  convertedFiles = [];
  resultsEl.innerHTML = '';
  updateBatchBar();
  showToast('ì´ˆê¸°í™” ì™„ë£Œ');
});

// === Batch bar ===
function updateBatchBar() {
  const active = convertedFiles.filter(f => f !== null);
  if (active.length < 2) {
    batchBar.classList.remove('show');
    return;
  }
  const totalOriginal = active.reduce((s, f) => s + f.originalSize, 0);
  const totalNew = active.reduce((s, f) => s + f.newSize, 0);
  const totalSaving = ((1 - totalNew / totalOriginal) * 100).toFixed(1);

  batchInfo.innerHTML = `<strong>${active.length}ê°œ íŒŒì¼</strong> Â· ${formatSize(totalOriginal)} â†’ ${formatSize(totalNew)} (${totalSaving}% ì ˆê°)`;
  batchBar.classList.add('show');
}

// === Blob to ArrayBuffer í´ë¦¬í•„ (êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì‘) ===
function blobToArrayBuffer(blob) {
  if (blob.arrayBuffer) return blob.arrayBuffer();
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = () => reject(reader.error);
    reader.readAsArrayBuffer(blob);
  });
}

// === JSZip ë™ì  ë¡œë”© (CDN ì‹¤íŒ¨ ëŒ€ë¹„) ===
function ensureJSZip() {
  return new Promise((resolve, reject) => {
    if (typeof JSZip !== 'undefined') { resolve(); return; }
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
    script.onload = () => resolve();
    script.onerror = () => reject(new Error('JSZip CDN ë¡œë“œ ì‹¤íŒ¨'));
    document.head.appendChild(script);
  });
}

// === (#1) ZIP ë‹¤ìš´ë¡œë“œ ===
btnDownloadAll.addEventListener('click', async () => {
  const active = convertedFiles.filter(f => f !== null);
  if (active.length === 0) return;

  // íŒŒì¼ 1ê°œë©´ ZIP ì—†ì´ ë°”ë¡œ ë‹¤ìš´ë¡œë“œ
  if (active.length === 1) {
    const idx = convertedFiles.indexOf(active[0]);
    downloadFile(idx);
    return;
  }

  btnDownloadAll.disabled = true;
  btnClearAll.disabled = true;
  btnDownloadAll.textContent = 'â³ ZIP ì¤€ë¹„ ì¤‘...';

  try {
    // JSZip ë¡œë“œ í™•ì¸ (ì‹¤íŒ¨ ì‹œ ë™ì  ì¬ë¡œë“œ)
    await ensureJSZip();
  } catch (e) {
    console.error('JSZip load failed:', e);
    showToast('ZIP ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°œë³„ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
    fallbackDownload(active);
    return;
  }

  // GC ì—¬ìœ  ì‹œê°„
  await new Promise(r => setTimeout(r, 100));

  try {
    const zip = new JSZip();

    const usedNames = new Set();
    for (let i = 0; i < active.length; i++) {
      const f = active[i];
      let name = f.name;

      // ì¤‘ë³µ íŒŒì¼ëª… ë°©ì§€
      if (usedNames.has(name)) {
        const dotIdx = name.lastIndexOf('.');
        const base = dotIdx > 0 ? name.substring(0, dotIdx) : name;
        const ext = dotIdx > 0 ? name.substring(dotIdx) : '';
        let counter = 1;
        do { name = `${base} (${counter})${ext}`; counter++; } while (usedNames.has(name));
      }
      usedNames.add(name);

      try {
        const buf = await blobToArrayBuffer(f.blob);
        zip.file(name, new Uint8Array(buf));
      } catch (fileErr) {
        console.warn(`File ${name} skipped:`, fileErr);
      }

      btnDownloadAll.textContent = `â³ ${i + 1}/${active.length} ì²˜ë¦¬ ì¤‘...`;
      if (i % 5 === 4) await new Promise(r => setTimeout(r, 0));
    }

    btnDownloadAll.textContent = 'â³ ZIP ì••ì¶• ì¤‘...';

    const content = await zip.generateAsync({
      type: 'blob',
      compression: 'STORED'
    });

    // DOMì— ì¶”ê°€í•œ ì•µì»¤ë¡œ ë‹¤ìš´ë¡œë“œ (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í–¥ìƒ)
    const a = document.createElement('a');
    const zipUrl = URL.createObjectURL(content);
    a.href = zipUrl;
    a.download = `webtoolbox-images-${active.length}files.zip`;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(zipUrl); }, 5000);

    showToast(`${active.length}ê°œ íŒŒì¼ ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ âœ“`);
  } catch (err) {
    console.error('ZIP generation error:', err);
    showToast('ZIP ìƒì„± ì‹¤íŒ¨ â€” ê°œë³„ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
    fallbackDownload(active);
  } finally {
    btnDownloadAll.disabled = false;
    btnClearAll.disabled = false;
    btnDownloadAll.textContent = 'ğŸ“¥ ZIP ë‹¤ìš´ë¡œë“œ';
  }
});

// === í´ë°±: ìˆœì°¨ ê°œë³„ ë‹¤ìš´ë¡œë“œ ===
async function fallbackDownload(active) {
  btnDownloadAll.disabled = true;
  for (let i = 0; i < active.length; i++) {
    const idx = convertedFiles.indexOf(active[i]);
    if (idx >= 0) downloadFile(idx);
    btnDownloadAll.textContent = `ğŸ“¥ ${i + 1}/${active.length} ë‹¤ìš´ë¡œë“œ ì¤‘...`;
    await new Promise(r => setTimeout(r, 400));
  }
  showToast(`${active.length}ê°œ íŒŒì¼ ê°œë³„ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ âœ“`);
  btnDownloadAll.disabled = false;
  btnClearAll.disabled = false;
  btnDownloadAll.textContent = 'ğŸ“¥ ZIP ë‹¤ìš´ë¡œë“œ';
}

// === Helpers ===
function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
}

function showToast(msg) {
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(() => toastEl.classList.remove('show'), 2500);
}

function toggleFaq(el) { el.parentElement.classList.toggle('open'); }

// === Cleanup on page leave ===
window.addEventListener('beforeunload', () => {
  convertedFiles.forEach(f => { if (f) URL.revokeObjectURL(f.thumbUrl); });
});
</script>
</body>
</html>
