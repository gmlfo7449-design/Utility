<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë„í™”ì‚´ ì‚¬ì£¼ í…ŒìŠ¤íŠ¸ ğŸŒ¸ | íˆ´íˆ´ë²„ìŠ¤</title>
<meta name="description" content="ìƒë…„ì›”ì¼ì‹œë¡œ ë³´ëŠ” ë„í™”ì‚´ ì‚¬ì£¼ í…ŒìŠ¤íŠ¸. ë„í™”ì‚´ ê°•ë„, ìœ í˜•, í™ì—¼ì‚´Â·í•¨ì§€ì‚´ê¹Œì§€ ì •í™•í•˜ê²Œ ë¶„ì„í•©ë‹ˆë‹¤.">
<meta property="og:title" content="ë„í™”ì‚´ ì‚¬ì£¼ í…ŒìŠ¤íŠ¸ ğŸŒ¸ | íˆ´íˆ´ë²„ìŠ¤">
<meta property="og:image" content="https://webtoolbox.kr/dohwa/og_dohwa.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://webtoolbox.kr/dohwa/og_dohwa.png">
<meta property="og:description" content="ìƒë…„ì›”ì¼ì‹œë¡œ ë³´ëŠ” ë„í™”ì‚´ ì‚¬ì£¼ ì •ë°€ ë¶„ì„. ë„í™”ì‚´ ê°•ë„Â·ìœ í˜•, í™ì—¼ì‚´, í•¨ì§€ì‚´ê¹Œì§€. ë¬´ë£Œë¡œ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://webtoolbox.kr/dohwa/">
<link rel="canonical" href="https://webtoolbox.kr/dohwa/">
<!-- íŒŒë¹„ì½˜ -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<link rel="icon" type="image/png" sizes="512x512" href="/favicon_512.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@400;500;700&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#09080f;--s1:#100f1e;--s2:#18172a;
  --border:#2e2c5a;--text:#f0eeff;--sub:#cac8f0;--muted:#a0a0cc;
  --pink:#ff5fa0;--pink-l:rgba(255,95,160,.12);--pink-b:rgba(255,95,160,.3);
  --gold:#ffd166;--purple:#a78bfa;--cyan:#67e8f9;--r:18px;--rs:12px;
}

/* â”€â”€ ì‚´ ë±ƒì§€ íˆ´íŒ â”€â”€ */
.sal-badge{position:relative;cursor:help;}
.sal-badge .sal-tip{
  display:none;
  position:fixed;
  bottom:auto;left:auto;transform:none;
  background:#1e1c36;border:1px solid #3d3a6a;border-radius:10px;
  padding:10px 14px;font-size:12px;color:var(--sub);line-height:1.7;
  z-index:999;pointer-events:none;
  box-shadow:0 6px 24px rgba(0,0,0,.6);
  width:220px;white-space:normal;text-align:center;
  font-weight:400;
}
.sal-badge:hover .sal-tip,.sal-badge:active .sal-tip{display:block;}




  /* ê´‘ê³  ìŠ¬ë¡¯ */
  .ad-slot{max-width:660px;margin:16px auto;padding:0 18px;}
  .ad-banner{
    display:block;overflow:hidden;
    background:rgba(255,255,255,.02);
    border:1px dashed rgba(255,255,255,.08);
    border-radius:12px;min-height:90px;
    display:flex;align-items:center;justify-content:center;
  }
  .ad-banner::after{
    content:'ê´‘ê³  ì˜ì—­';font-size:11px;color:rgba(255,255,255,.12);
    letter-spacing:.5px;
  }
  .ad-banner.adsense-active{background:transparent;border:none;}
  .ad-banner.adsense-active::after{display:none;}
  .ad-banner-large{min-height:120px;}
html{scroll-behavior:smooth;}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased;}

/* ë°°ê²½ */
.cosmos{position:fixed;inset:0;z-index:0;pointer-events:none;}
.cosmos::before{content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse 80% 60% at 20% 0%,rgba(167,139,250,.1),transparent 55%),
             radial-gradient(ellipse 60% 50% at 85% 100%,rgba(255,95,160,.08),transparent 55%);}
.star{position:absolute;border-radius:50%;animation:twink var(--d,3s) var(--dl,0s) infinite alternate;}
@keyframes twink{from{opacity:var(--a,.2);}to{opacity:.05;}}

/* ë„¤ë¹„ */
.nav{background:rgba(9,8,15,.9);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(16px);}
.nav-in{max-width:660px;margin:0 auto;padding:0 18px;height:54px;display:flex;align-items:center;justify-content:space-between;}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--text);}
.logo-box{width:28px;height:28px;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center;}
.logo-t{font-family:'Outfit';font-weight:700;font-size:15px;}
.nav-back{display:flex;align-items:center;gap:4px;text-decoration:none;color:var(--sub);font-size:13px;padding:5px 11px;border-radius:8px;transition:.2s;}
.nav-back:hover{background:var(--s2);color:var(--text);}

/* ìŠ¤í¬ë¦° ê³µí†µ */
.screen{max-width:660px;margin:0 auto;padding:32px 18px 80px;position:relative;z-index:1;}

/* íˆì–´ë¡œ */
.hero{text-align:center;margin-bottom:30px;}
.hero-chibi{height:300px;margin-bottom:0px;display:flex;align-items:flex-end;justify-content:center;}
.hero-chibi svg{height:300px;width:auto;animation:float 3.5s ease-in-out infinite;filter:drop-shadow(0 8px 24px rgba(255,95,160,.3));}
.chibi-custom-img{height:160px;width:auto;object-fit:contain;animation:float 3.5s ease-in-out infinite;filter:drop-shadow(0 8px 24px rgba(255,95,160,.3));border-radius:12px;}
.chibi-custom-img.loading{height:300px;animation:pulse 1s ease-in-out infinite;}
.chibi-custom-img.result{height:360px;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35));animation:float 3.5s ease-in-out infinite;}
.result-chibi-img{animation:float 3.5s ease-in-out infinite !important;}
.upload-chibi-btn{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:700;color:var(--muted);background:rgba(255,255,255,.04);border:1.5px dashed var(--border);border-radius:99px;padding:4px 12px;cursor:pointer;transition:.2s;margin-top:6px;}
.upload-chibi-btn:hover{border-color:var(--pink);color:var(--pink);}
#chibiFileInput{display:none;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
.hero-badge{display:inline-flex;align-items:center;gap:5px;background:var(--pink-l);border:1px solid var(--pink-b);color:var(--pink);font-size:11px;font-weight:700;padding:4px 14px;border-radius:20px;margin-bottom:14px;letter-spacing:.5px;}
.hero h1{font-family:'Noto Serif KR';font-size:32px;font-weight:900;line-height:1.3;letter-spacing:-1px;margin-bottom:10px;background:linear-gradient(135deg,#fff 20%,var(--pink) 60%,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-sub{font-size:13px;color:var(--sub);line-height:1.8;}

/* ì…ë ¥ ì¹´ë“œ */
.card{background:linear-gradient(135deg,var(--s1),var(--s2));border:1px solid var(--border);border-radius:var(--r);padding:22px;margin-bottom:14px;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--pink),var(--gold),var(--purple));}
.lbl{font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;margin-bottom:9px;}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px;margin-bottom:14px;}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:14px;}
.ig{display:flex;flex-direction:column;gap:5px;}
.ig label{font-size:11px;color:var(--sub);font-weight:600;}
.inp{background:rgba(255,255,255,.05);border:1.5px solid var(--border);border-radius:9px;padding:11px 13px;font-size:16px;font-family:'Noto Sans KR';color:var(--text);width:100%;transition:.2s;-webkit-appearance:none;}
.inp:focus{outline:none;border-color:var(--pink);background:rgba(255,95,160,.06);}
.inp::placeholder{color:#8a88b8;}
.inp-full{margin-bottom:16px;}
.gender-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:16px;}
.gbtn{border:1.5px solid var(--border);border-radius:9px;padding:11px;background:rgba(255,255,255,.04);cursor:pointer;color:var(--sub);font-size:14px;font-weight:700;font-family:'Noto Sans KR';transition:.2s;display:flex;align-items:center;justify-content:center;gap:5px;}
.gbtn.on{border-color:var(--pink);background:var(--pink-l);color:var(--pink);}
.time-tip{font-size:11px;color:var(--muted);margin-top:5px;line-height:1.6;}

.start-btn{width:100%;padding:17px;border-radius:var(--rs);font-size:15px;font-weight:700;font-family:'Noto Sans KR';cursor:pointer;border:none;background:linear-gradient(135deg,#ff5fa0,#e047a0,#b83dc8);color:#fff;box-shadow:0 4px 24px rgba(255,95,160,.32);transition:.22s;position:relative;overflow:hidden;letter-spacing:.3px;}
.start-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.14),transparent);}
.start-btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(255,95,160,.48);}
.disclaimer{text-align:center;font-size:11px;color:var(--muted);margin-top:10px;line-height:1.6;}

/* ë¡œë”© */
.loading-wrap{text-align:center;padding:70px 20px;}
.loading-chibi{height:300px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;}
.loading-chibi svg{height:300px;animation:pulse 1s ease-in-out infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.06);}}
.loading-bar-bg{width:220px;height:4px;background:var(--border);border-radius:99px;margin:20px auto 0;overflow:hidden;}
.loading-bar{height:100%;background:linear-gradient(90deg,var(--pink),var(--gold));border-radius:99px;animation:loadW 2.5s ease-in-out forwards;}
@keyframes loadW{from{width:0}to{width:100%}}
.loading-txt{font-size:14px;color:var(--sub);margin-top:12px;font-family:'Noto Serif KR';}

/* ê²°ê³¼ íˆì–´ë¡œ ì¹´ë“œ */
.r-hero{background:linear-gradient(160deg,var(--s1),var(--s2));border:1px solid var(--border);border-radius:var(--r);padding:32px 22px 24px;text-align:center;margin-bottom:12px;position:relative;overflow:hidden;}
.r-hero::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--pink),var(--gold),var(--purple));}
.r-glow{position:absolute;top:-40px;left:50%;transform:translateX(-50%);width:240px;height:240px;border-radius:50%;filter:blur(70px);opacity:.18;pointer-events:none;}
.r-chibi{height:360px;display:flex;align-items:flex-end;justify-content:center;margin-bottom:10px;position:relative;z-index:1;}
.r-chibi svg{height:360px;width:auto;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35));animation:float 3.5s ease-in-out infinite;}
.halo-ring{position:absolute;bottom:-4px;left:50%;transform:translateX(-50%);width:110px;height:18px;border-radius:50%;border:1.5px solid rgba(255,95,160,.4);animation:haloSpin 6s linear infinite;pointer-events:none;}
@keyframes haloSpin{to{transform:translateX(-50%) rotateY(360deg);}}
.sal-badges{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:12px 0 16px;}
.sal-badge{font-size:11px;font-weight:700;padding:4px 13px;border-radius:20px;border:1px solid;}
.r-name{font-size:12px;color:var(--sub);margin-bottom:5px;}
.r-type-lbl{font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:5px;}
.r-title{font-family:'Noto Serif KR';font-size:24px;font-weight:900;letter-spacing:-.5px;margin-bottom:9px;line-height:1.3;}
.r-desc{font-size:13px;color:var(--sub);line-height:1.85;max-width:480px;margin:0 auto;}

/* ì‚¬ì£¼ 8ì */
.saju-card{background:var(--s1);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;margin-bottom:12px;}
.scard-head{padding:14px 20px;border-bottom:1px solid var(--border);font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;display:flex;align-items:center;gap:8px;}
.saju-grid{display:grid;grid-template-columns:repeat(4,1fr);}
.saju-col{border-right:1px solid var(--border);padding:14px 8px;text-align:center;}
.saju-col:last-child{border-right:none;}
.sp-lbl{font-size:10px;color:var(--muted);font-weight:700;margin-bottom:6px;letter-spacing:.4px;}
.sc-ss{font-size:9px;color:var(--muted);height:14px;margin-bottom:2px;}
.sc-han{font-family:'Noto Serif KR';font-size:22px;font-weight:700;line-height:1.1;}
.sc-kr{font-size:10px;color:var(--sub);margin-top:2px;}
.sc-div{height:1px;background:var(--border);margin:5px 4px;}
.sc-sal{font-size:9px;font-weight:700;padding:2px 6px;border-radius:20px;margin-top:5px;display:inline-block;}
.dohwa-sal{background:rgba(255,95,160,.18);color:#ff5fa0;}
.hamji-sal{background:rgba(167,139,250,.18);color:#a78bfa;}
.hong-sal{background:rgba(248,113,113,.18);color:#f87171;}
.sc-na{color:var(--muted);font-size:11px;padding:20px 0;}

/* ë„í™” ê°•ë„ */
.dohwa-card{background:var(--s1);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;margin-bottom:18px;}
.dohwa-body{padding:22px 20px 8px;}
.dg-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;}
.dg-level{font-family:'Noto Serif KR';font-size:20px;font-weight:900;}
.dg-pct{font-family:'Outfit';font-size:26px;font-weight:900;color:var(--pink);}
.dg-bg{height:9px;background:var(--border);border-radius:99px;overflow:hidden;margin-bottom:7px;}
.dg-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--pink),var(--gold));width:0;transition:width 1.2s cubic-bezier(.4,0,.2,1);}
.dg-note{font-size:13px;color:var(--sub);line-height:1.9;margin-top:4px;}
.dg-pills{display:flex;flex-wrap:wrap;gap:6px;margin-top:14px;margin-bottom:4px;}
.dg-pill{font-size:11px;font-weight:700;padding:3px 11px;border-radius:20px;border:1px solid var(--border);color:var(--sub);}
.dg-pill.on{border-color:var(--pink-b);background:var(--pink-l);color:var(--pink);}

/* ì„¹ì…˜ í—¤ë” */
.section-head{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:12px;padding:20px 20px 0;}

/* ì‚´ ì¹´ë“œ */
.sal-card{background:var(--s1);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;margin-bottom:18px;}
.sal-row{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;gap:14px;}
.sal-row:last-child{border-bottom:none;}
.sal-ico{font-size:24px;flex-shrink:0;margin-top:2px;}
.sal-info{flex:1;}
.sal-name-row{display:flex;align-items:center;gap:7px;margin-bottom:5px;flex-wrap:wrap;}
.sal-name{font-size:14px;font-weight:700;font-family:'Noto Serif KR';}
.sal-tag{font-size:11px;font-weight:700;padding:2px 8px;border-radius:20px;}
.sal-txt{font-size:13px;color:var(--sub);line-height:1.8;}

/* ìœ í˜• */
.type-body{padding:16px 20px 22px;}
.type-section-head{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px;}
.type-title{font-family:'Noto Serif KR';font-size:18px;font-weight:700;margin-bottom:10px;}
.type-desc{font-size:13.5px;color:var(--sub);line-height:2.0;}
.trait-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:16px;}
.trait{font-size:11.5px;font-weight:700;padding:6px 14px;border-radius:20px;border:1px solid var(--purple);background:rgba(167,139,250,.09);color:var(--purple);}

/* ë²„íŠ¼ */
.r-btns{display:flex;gap:9px;flex-wrap:wrap;}
.rbtn{flex:1;min-width:calc(50% - 5px);padding:13px;border-radius:var(--rs);font-size:13px;font-weight:700;font-family:'Noto Sans KR';cursor:pointer;border:none;transition:.2s;}
.rbtn-main{background:linear-gradient(135deg,var(--pink),#b83dc8);color:#fff;box-shadow:0 4px 16px rgba(255,95,160,.26);}
.rbtn-main:hover{transform:translateY(-1px);box-shadow:0 7px 24px rgba(255,95,160,.4);}
.rbtn-ghost{background:var(--s1);color:var(--sub);border:1.5px solid var(--border);}
.rbtn-ghost:hover{border-color:var(--sub);color:var(--text);}

/* ëª¨ë‹¬ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s;}
.modal-bg.show{opacity:1;pointer-events:auto;}
.modal{background:var(--s2);border:1px solid var(--border);border-radius:18px 18px 0 0;padding:24px 20px 40px;width:100%;max-width:480px;transform:translateY(100%);transition:transform .32s cubic-bezier(.34,1.1,.64,1);}
.modal-bg.show .modal{transform:translateY(0);}
.modal-title{font-size:12px;font-weight:700;color:var(--muted);letter-spacing:.6px;text-transform:uppercase;text-align:center;margin-bottom:18px;}
.share-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:9px;margin-bottom:14px;}
.si{display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;padding:12px 5px;border-radius:11px;background:rgba(255,255,255,.04);border:1.5px solid var(--border);transition:.2s;}
.si:hover{border-color:var(--pink-b);background:var(--pink-l);}
.si-ico{font-size:24px;}
.si-lbl{font-size:10px;font-weight:700;color:var(--sub);}
.modal-close{width:100%;padding:12px;background:rgba(255,255,255,.05);border:1.5px solid var(--border);border-radius:var(--rs);color:var(--sub);font-size:14px;font-weight:700;font-family:'Noto Sans KR';cursor:pointer;transition:.2s;}
.modal-close:hover{border-color:var(--sub);}

.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--text);color:var(--bg);padding:10px 20px;border-radius:9px;font-size:13px;font-weight:700;opacity:0;transition:.3s;z-index:999;pointer-events:none;white-space:nowrap;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
canvas{display:none;}

/* 12ì‹ ì‚´ */
.sinsal-card{background:linear-gradient(135deg,var(--s1),var(--s2));border:1px solid var(--border);border-radius:var(--r);padding:22px;margin-bottom:14px;position:relative;overflow:hidden;}
.sinsal-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#67e8f9,#a78bfa,#ffd166);}
.sinsal-tabs{display:flex;gap:8px;margin-bottom:18px;flex-wrap:wrap;}
.stab{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:700;cursor:pointer;border:1px solid var(--border);background:var(--s2);color:var(--sub);transition:.2s;}
.stab.on{background:rgba(103,232,249,.15);border-color:#67e8f9;color:#67e8f9;}
.ss-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.ss-col{display:flex;flex-direction:column;}
.ss-head{text-align:center;font-size:11px;font-weight:700;color:var(--muted);padding:8px 4px;background:rgba(255,255,255,.03);border-bottom:1px solid var(--border);}
.ss-cell{padding:10px 6px;text-align:center;border-bottom:1px solid var(--border);border-right:1px solid var(--border);min-height:62px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;}
.ss-col:last-child .ss-cell{border-right:none;}
.ss-col .ss-cell:last-child{border-bottom:none;}
.ss-jj{font-family:'Noto Serif KR';font-size:22px;font-weight:700;}
.ss-name{font-size:10px;font-weight:700;letter-spacing:.3px;}
.ss-empty{color:var(--muted);font-size:10px;}
.ss-legend{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;}
.ss-leg{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--sub);}
.ss-dot{width:8px;height:8px;border-radius:50%;}
.ss-detail-list{margin-top:16px;display:flex;flex-direction:column;gap:10px;}
.ss-detail-item{display:flex;align-items:flex-start;gap:12px;padding:12px;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid var(--border);}
.ss-di-ico{font-size:18px;flex-shrink:0;width:28px;text-align:center;}
.ss-di-body{flex:1;}
.ss-di-title{font-size:13px;font-weight:700;margin-bottom:3px;}
.ss-di-where{font-size:10px;color:var(--sub);margin-bottom:4px;}
.ss-di-desc{font-size:12px;color:var(--sub);line-height:1.7;}

/* ë„í™” ìƒì„¸ */
.dohwa-detail-body{padding:0 20px 20px;}
.dohwa-detail-body .dd-pos{padding:12px 0;border-bottom:1px solid var(--border);}
.dohwa-detail-body .dd-pos:last-child{border-bottom:none;}

@media(max-width:480px){
  /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
  .screen{padding:20px 14px 80px;}
  .nav-in{padding:0 14px;}

  /* íˆì–´ë¡œ */
  .hero h1{font-size:26px;letter-spacing:-.5px;}
  .hero-sub{font-size:12px;}
  .hero-chibi{height:220px;}
  .hero-chibi svg{height:220px;}

  /* ì…ë ¥í¼ */
  .row3{grid-template-columns:1fr 1fr 1fr;gap:6px;}
  .row2{grid-template-columns:1fr 1fr;gap:6px;}
  .gender-row{gap:6px;}
  .gbtn{font-size:13px;padding:9px 6px;}
  .inp{font-size:15px;}
  .card{padding:16px 14px;}

  /* ê²°ê³¼ íˆì–´ë¡œ */
  .r-hero{padding:22px 14px 18px;}
  .r-chibi{height:220px;}
  .r-chibi svg{height:220px;}
  .result-chibi-img{height:220px !important;}
  .chibi-custom-img.result{height:220px;}
  .r-title{font-size:19px;}
  .r-name{font-size:13px;}
  .r-desc{font-size:12px;}

  /* ì‚¬ì£¼ ê·¸ë¦¬ë“œ */
  .saju-grid{grid-template-columns:repeat(4,1fr);}
  .sc-han{font-size:16px;}
  .sc-item{padding:10px 6px;}
  .scard-head{padding:12px 14px;font-size:10px;}

  /* ë„í™” ê°•ë„ */
  .dohwa-body{padding:16px 14px 8px;}
  .dg-level{font-size:17px;}
  .dg-pct{font-size:22px;}
  .dg-note{font-size:12px;}
  .dg-pills{gap:4px;}
  .dg-pill{font-size:10px;padding:2px 8px;}

  /* ì‚´ ì¹´ë“œ */
  .sal-row{padding:13px 14px;gap:10px;}
  .sal-ico{font-size:20px;}
  .sal-name{font-size:13px;}
  .sal-txt{font-size:12px;}
  .section-head{padding:14px 14px 0;font-size:10px;}

  /* ìœ í˜• ì¹´ë“œ */
  .type-body{padding:14px 14px 18px;}
  .type-title{font-size:16px;}

  /* 12ì‹ ì‚´ ê·¸ë¦¬ë“œ â€” 2x2ë¡œ */
  .ss-grid{grid-template-columns:1fr 1fr;}
  .ss-detail-item{padding:10px;}
  .ss-di-title{font-size:12px;}

  /* ê³µìœ  */
  .share-grid{grid-template-columns:repeat(4,1fr);gap:6px;}
  .share-btn{padding:10px 6px;font-size:11px;}

  /* ìš´ìš©ì§€ìˆ˜ ì¹´ë“œ */
  #rSingangCard{padding:12px !important;}
}

/* â”€â”€ ì»¤ìŠ¤í…€ ë„ì‹œ ë“œë¡­ë‹¤ìš´ â”€â”€ */
.city-select-wrap { position:relative; z-index:10; }
.city-btn {
  width:100%; padding:11px 40px 11px 14px; border-radius:9px;
  background:rgba(255,255,255,.05); border:1.5px solid var(--border);
  color:var(--text); font-size:15px; font-family:'Noto Sans KR';
  cursor:pointer; text-align:left; position:relative;
  transition:.2s; display:flex; align-items:center; justify-content:space-between;
}
.city-btn:hover { border-color:var(--pink); background:rgba(255,95,160,.06); }
.city-btn .arrow { font-size:11px; opacity:.6; transition:.2s; flex-shrink:0; }
.city-dropdown {
  display:none; position:absolute; top:calc(100% + 6px); left:0; right:0;
  background:#1e1b2e; border:1.5px solid var(--border); border-radius:12px;
  z-index:9999; box-shadow:0 8px 32px rgba(0,0,0,.6);
  max-height:260px; overflow-y:auto;
}
.city-dropdown.open { display:block; }
.city-group-label {
  padding:8px 14px 4px; font-size:11px; font-weight:700;
  color:#a78bfa; letter-spacing:.8px; background:#16132a;
  border-top:1px solid rgba(255,255,255,.06);
}
.city-group-label:first-child { border-top:none; }
.city-option {
  padding:10px 16px; font-size:14px; color:#d4d0f0;
  cursor:pointer; transition:.15s;
}
.city-option:hover { background:rgba(255,95,160,.15); color:#fff; }
.city-option.selected { background:rgba(168,85,247,.2); color:#e0d0ff; font-weight:700; }
</style>
</head>
<body>
<div class="cosmos" id="cosmos"></div>

<nav class="nav">
  <div class="nav-in">
    <a href="/" class="logo"><div class="logo-box"><img src="/favicon.png" width="28" height="28" alt="íˆ´íˆ´ë²„ìŠ¤" style="display:block;border-radius:6px;"></div><span class="logo-t">íˆ´íˆ´ë²„ìŠ¤</span></a>
    <a href="/" class="nav-back">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>ì „ì²´ ë„êµ¬
    </a>
  </div>
</nav>

<!-- ì…ë ¥ í™”ë©´ -->
<div class="screen" id="inputScreen">
  <div class="hero">
    <div class="hero-chibi" id="heroChibi"></div>
    <div class="hero-badge">âœ¦ ì‚¬ì£¼ ë„í™”ì‚´ ë¶„ì„</div>
    <h1>ë‚´ ë„í™”ì‚´ì€<br>ì–´ëŠ ì •ë„ì¼ê¹Œ?</h1>
    <p class="hero-sub">ì‚¬ì£¼ íŒ”ì(å››æŸ±å…«å­—) ê¸°ë°˜ ë„í™”ì‚´ ì •ë°€ ë¶„ì„<br>ë„í™”ì‚´ ê°•ë„ Â· ìœ í˜• Â· í™ì—¼ì‚´ Â· í•¨ì§€ì‚´ê¹Œì§€</p>
  </div>

  <div class="card" style="overflow:visible">
    <div class="lbl">ì´ë¦„ (ì„ íƒ)</div>
    <input class="inp inp-full" id="inpName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
    <div class="lbl">ì–‘ë ¥ / ìŒë ¥ ì„ íƒ</div>
    <div class="gender-row">
      <button class="gbtn on" id="calSol" onclick="setCal('solar')">â˜€ï¸ ì–‘ë ¥</button>
      <button class="gbtn" id="calLun" onclick="setCal('lunar')">ğŸŒ™ ìŒë ¥</button>
    </div>
    <div id="leapWrap" style="display:none;margin-bottom:12px;">
      <button class="gbtn" id="leapBtn" onclick="toggleLeap()" style="width:100%">ìœ¤ë‹¬ ì•„ë‹˜</button>
    </div>
    <div class="lbl">ì„±ë³„</div>
    <div class="gender-row">
      <button class="gbtn on" id="gF" onclick="setG('f')">ğŸŒ¸ ì—¬ì</button>
      <button class="gbtn" id="gM" onclick="setG('m')">ğŸŒŠ ë‚¨ì</button>
    </div>
    <div class="lbl">ìƒë…„ì›”ì¼</div>
    <div class="row3">
      <div class="ig"><label>ë…„ë„</label><input class="inp" id="iY" type="number" placeholder="1995" min="1930" max="2050"></div>
      <div class="ig"><label>ì›”</label><input class="inp" id="iMo" type="number" placeholder="3" min="1" max="12"></div>
      <div class="ig"><label>ì¼</label><input class="inp" id="iD" type="number" placeholder="15" min="1" max="31"></div>
    </div>
    <div class="lbl">íƒœì–´ë‚œ ì‹œê°„</div>
    <div class="row2">
      <div class="ig"><label>ì‹œ (0~23)</label><input class="inp" id="iH" type="number" placeholder="14" min="0" max="23"></div>
      <div class="ig"><label>ë¶„</label><input class="inp" id="iMin" type="number" placeholder="30" min="0" max="59"></div>
    </div>
    <div class="time-tip">âš¡ ì‹œê°„ ëª¨ë¥´ë©´ ë¹„ì›Œë‘ì„¸ìš”. ë¹„ìš°ë©´ ì‹œì£¼ ë¶„ì„ì´ ì œì™¸ë©ë‹ˆë‹¤.</div>

    <div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border)">
      <div class="lbl">ìì‹œ(å­æ™‚) í•™ì„¤ ì„ íƒ</div>
      <div class="gender-row">
        <button class="gbtn on" id="btnJoJasi" onclick="setJasi('jo')">ğŸŒ™ ì¡°ìì‹œ (ì¼ë°˜)</button>
        <button class="gbtn" id="btnYaJasi" onclick="setJasi('ya')">â­ ì•¼ìì‹œ (ì „í†µ)</button>
      </div>
      <div class="time-tip">ì¡°ìì‹œ: ë°¤ 11ì‹œ~ìƒˆë²½ 1ì‹œë¥¼ ê°™ì€ ë‚  ìì‹œë¡œ ë´„<br>ì•¼ìì‹œ: ë°¤ 11ì‹œë¶€í„°ë¥¼ ë‹¤ìŒë‚ ë¡œ ë´„ (ì „í†µ ì¼ë¶€ í•™ì„¤)</div>
    </div>

    <div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border)">
      <div class="lbl">ì¶œìƒì§€ (ì§€ë°©ì‹œ ë³´ì •)</div>
      <div class="city-select-wrap" id="cityWrap">
        <button class="city-btn" id="cityBtn" onclick="toggleCityDropdown(event)" type="button">
          <span id="cityBtnText">ğŸ“ ì„œìš¸ (âˆ’32ë¶„)</span>
          <span class="arrow" id="cityArrow">â–¼</span>
        </button>
        <div class="city-dropdown" id="cityDropdown">
          <div class="city-option" data-value="0" onclick="selectCity(this)">ğŸ“ ë³´ì • ì—†ìŒ (KST ê¸°ì¤€)</div>
          <div class="city-group-label">ê²½ê¸°Â·ì„œìš¸Â·ì¸ì²œ</div>
          <div class="city-option selected" data-value="-32" onclick="selectCity(this)">ì„œìš¸ (âˆ’32ë¶„)</div>
          <div class="city-option" data-value="-32" onclick="selectCity(this)">ìˆ˜ì› (âˆ’32ë¶„)</div>
          <div class="city-option" data-value="-33" onclick="selectCity(this)">ì¸ì²œ (âˆ’33ë¶„)</div>
          <div class="city-group-label">ì¶©ì²­</div>
          <div class="city-option" data-value="-30" onclick="selectCity(this)">ëŒ€ì „ (âˆ’30ë¶„)</div>
          <div class="city-option" data-value="-30" onclick="selectCity(this)">ì²­ì£¼ (âˆ’30ë¶„)</div>
          <div class="city-option" data-value="-31" onclick="selectCity(this)">ì „ì£¼ (âˆ’31ë¶„)</div>
          <div class="city-group-label">ì „ë¼</div>
          <div class="city-option" data-value="-33" onclick="selectCity(this)">ê´‘ì£¼ (âˆ’33ë¶„)</div>
          <div class="city-option" data-value="-34" onclick="selectCity(this)">ì œì£¼ (âˆ’34ë¶„)</div>
          <div class="city-group-label">ê°•ì›</div>
          <div class="city-option" data-value="-29" onclick="selectCity(this)">ì¶˜ì²œ (âˆ’29ë¶„)</div>
          <div class="city-option" data-value="-25" onclick="selectCity(this)">ê°•ë¦‰ (âˆ’25ë¶„)</div>
          <div class="city-group-label">ê²½ìƒ</div>
          <div class="city-option" data-value="-26" onclick="selectCity(this)">ëŒ€êµ¬ (âˆ’26ë¶„)</div>
          <div class="city-option" data-value="-24" onclick="selectCity(this)">ë¶€ì‚° (âˆ’24ë¶„)</div>
          <div class="city-option" data-value="-23" onclick="selectCity(this)">ìš¸ì‚° (âˆ’23ë¶„)</div>
        </div>
      </div>
      <!-- ìˆ¨ê²¨ì§„ value holder (ê¸°ì¡´ ë¡œì§ í˜¸í™˜) -->
      <input type="hidden" id="selCity" value="-32">
      <div class="time-tip" id="cityTip">ì„œìš¸: ê²½ë„ 126.98Â° â†’ KST(135Â°E)ë³´ë‹¤ 32ë¶„ ëŠë¦° íƒœì–‘ì‹œ ì ìš©</div>
    </div>
  </div>

  <button class="start-btn" onclick="startAnalysis()">ğŸŒ¸ ë§¤ë ¥ ë¶„ì„í•˜ê¸°</button>

  <!-- ê´‘ê³  ìŠ¬ë¡¯ 1: ì…ë ¥í™”ë©´ í•˜ë‹¨ -->
  <div class="ad-slot" style="margin-top:24px;">
    <div class="ad-banner">
      <!-- AdSense ì½”ë“œ ì‚½ì… í›„ class="ad-banner adsense-active" ë¡œ ë³€ê²½ -->
    </div>
  </div>
  <p class="disclaimer">â€» ì¬ë¯¸ì™€ ì˜ê°ì„ ìœ„í•œ ì½˜í…ì¸ ì˜ˆìš”. ì „ë¬¸ ìƒë‹´ì„ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
  <p class="disclaimer" style="margin-top:4px;font-size:10px;color:var(--muted)">ğŸ“¡ ì ˆê¸° ë°ì´í„°: ì²œë¬¸ ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ Â· 1930~2050ë…„ ì§€ì›</p>
</div>

<!-- ë¡œë”© -->
<div class="screen" id="loadingScreen" style="display:none">
  <div class="loading-wrap">
    <div class="loading-chibi" id="loadChar"></div>
    <div style="font-family:'Noto Serif KR';font-size:19px;font-weight:700">ì‚¬ì£¼ë¥¼ ì½ëŠ” ì¤‘...</div>
    <div class="loading-bar-bg"><div class="loading-bar"></div></div>
    <div class="loading-txt" id="loadTxt">ì²œê°„ì§€ì§€ë¥¼ ê³„ì‚°í•˜ê³  ìˆì–´ìš”</div>
  </div>
</div>

<!-- ê²°ê³¼ í™”ë©´ -->
<div class="screen" id="resultScreen" style="display:none">
  <div class="r-hero" id="rHero">
    <div class="r-glow" id="rGlow"></div>
    <div class="r-chibi" id="rChibi">
      <div class="halo-ring" id="haloRing"></div>
    </div>
    <div class="sal-badges" id="salBadges"></div>
    <div class="r-name" id="rName"></div>
    <div id="rLunarDate" style="font-size:11px;color:var(--muted);margin-top:2px"></div>
    <!-- í•œ ì¤„ ìš”ì•½ ì¹´ë“œ -->
    <div id="rSummaryCard" style="margin:12px 4px 4px;border-radius:14px;padding:14px 16px;border:1px solid var(--border);background:rgba(255,255,255,.04);text-align:left"></div>
    <div class="r-type-lbl" id="rTypeLbl"></div>
    <div id="rRankBadge" style="margin:4px 0 8px"></div>
    <div id="rSubtitle" style="font-size:13px;font-weight:700;letter-spacing:.5px;margin-bottom:4px;opacity:.7"></div>
    <div class="r-title" id="rTitle"></div>
    <div id="rShort" style="font-size:14px;font-style:italic;margin:6px 0 10px;line-height:1.6;opacity:.85"></div>
    <div id="rSubTypes" style="margin:0 0 12px;width:100%"></div>
    <div class="r-desc" id="rDesc"></div>
    <div id="rSingangCard" style="margin:14px 4px 0;border-radius:14px;padding:14px 16px;border:1px solid var(--border);background:rgba(255,255,255,.04)"></div>

    <!-- ê´‘ê³  ìŠ¬ë¡¯ 2: ê²°ê³¼ ë¶„ì„ ì§í›„ -->
    <div class="ad-slot" style="padding:0;margin-top:20px;">
      <div class="ad-banner ad-banner-large">
        <!-- AdSense ì½”ë“œ ì‚½ì… í›„ class="ad-banner ad-banner-large adsense-active" ë¡œ ë³€ê²½ -->
      </div>
    </div>
  </div>

  <!-- ì‚¬ì£¼ íŒ”ì -->
  <div class="saju-card">
    <div class="scard-head">
      ì‚¬ì£¼ íŒ”ì (å››æŸ±å…«å­—)
      <span id="jasiModeBadge" style="font-size:10px;font-weight:400;color:var(--muted);margin-left:4px"></span>
    </div>
    <div style="font-size:12px;color:var(--muted);padding:10px 20px 0;line-height:1.6">
      ì—°Â·ì›”Â·ì¼Â·ì‹œ 4ê°œ ê¸°ë‘¥. ê° ê¸°ë‘¥ì˜ ìœ„(ì²œê°„)ì™€ ì•„ë˜(ì§€ì§€)ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.
    </div>
    <div class="saju-grid" id="sajuGrid"></div>
  </div>

  <!-- ë„í™”ì‚´ ë¶„ì„ -->
  <div class="dohwa-card">
    <div class="scard-head">ğŸŒ¸ ë§¤ë ¥ ë¶„ì„</div>
    <div style="font-size:12px;color:var(--muted);padding:10px 20px 0;line-height:1.7">
      ë„í™”ì‚´ì€ ì´ì„±ì„ ëŒì–´ë‹¹ê¸°ëŠ” ë§¤ë ¥ì˜ ê¸°ìš´ì´ì—ìš”. <b style="color:var(--sub)">ê°•ë„</b>ëŠ” ì–¼ë§ˆë‚˜ ê°•í•œì§€, <b style="color:var(--sub)">ìœ í˜•</b>ì€ ì–´ë–¤ ìŠ¤íƒ€ì¼ì˜ ë§¤ë ¥ì¸ì§€, <b style="color:var(--sub)">ìœ„ì¹˜</b>ëŠ” ì–´ëŠ ì˜ì—­(ì§ì—…Â·ì—°ì• Â·ë…¸ë…„)ì—ì„œ ë°œíœ˜ë˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ìš”.
    </div>

    <!-- ê°•ë„ -->
    <div class="dohwa-body">
      <div class="dg-row">
        <div class="dg-level" id="dgLevel"></div>
        <div class="dg-pct" id="dgPct"></div>
      </div>
      <div class="dg-bg"><div class="dg-fill" id="dgFill"></div></div>
      <div class="dg-note" id="dgNote"></div>
      <div class="dg-pills" id="dgPills"></div>
    </div>

    <!-- ìœ í˜• -->
    <div style="border-top:1px solid var(--border)">
      <div class="type-body">
        <div class="type-section-head">âœ¨ ë‚˜ì˜ ë§¤ë ¥ ìœ í˜•</div>
        <div class="type-title" id="typeTitle"></div>
        <div class="type-desc" id="typeDesc"></div>
        <div class="trait-tags" id="typeTraits"></div>
      </div>
    </div>

    <!-- ë„í™” ìœ„ì¹˜ & ì„±ì§ˆ -->
    <div style="border-top:1px solid var(--border)">
      <div class="section-head">ğŸ“ ë‚´ ë§¤ë ¥ì´ ë¹›ë‚˜ëŠ” ì˜ì—­</div>
      <div class="dohwa-detail-body" id="dohwaDetailBody"></div>
    </div>
    <div style="border-top:1px solid var(--border)">
      <div class="section-head">ğŸŒº ë„í™” ìœ í˜• ìƒì„¸ ë¶„ì„</div>
      <div class="dohwa-detail-body" id="specialDohwaBody"></div>
    </div>
  </div>

  <!-- ì‚´ ìƒì„¸ ë¶„ì„ -->
  <div class="sal-card">
    <div class="scard-head">âš¡ ìš´ì„¸ ì—ë„ˆì§€ ìƒì„¸</div>
    <div style="font-size:12px;color:var(--muted);padding:10px 20px 12px;line-height:1.7">
      ì‚´(æ®º)ì€ ë‚˜ìœ ê²ƒì´ ì•„ë‹ˆë¼ íŠ¹ì • ì—ë„ˆì§€ê°€ ê°•í•˜ê²Œ ë°œë™ë˜ëŠ” ê¸°ìš´ì…ë‹ˆë‹¤.
    </div>
    <div id="salRows"></div>
  </div>

  <!-- 12ì‹ ì‚´ -->
  <div class="sinsal-card">
    <div class="scard-head">ë‚˜ì˜ ìš´ì„¸ ì—ë„ˆì§€ ë¶„ì„</div>
    <div style="font-size:12px;color:var(--muted);padding:10px 20px 0;line-height:1.7">
      ë…„ì§€Â·ì¼ì§€Â·ì›”ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³´ëŠ” 12ê°€ì§€ ì‹ ì‚´ì…ë‹ˆë‹¤.
    </div>
    <div class="sinsal-tabs" style="margin-top:14px;">
      <button class="stab on" id="stab-year" onclick="switchSinsalTab('year')">ë…„ì§€ ê¸°ì¤€</button>
      <button class="stab" id="stab-day" onclick="switchSinsalTab('day')">ì¼ì§€ ê¸°ì¤€</button>
      <button class="stab" id="stab-month" onclick="switchSinsalTab('month')">ì›”ì§€ ê¸°ì¤€</button>
      <button class="stab" id="stab-hour" onclick="switchSinsalTab('hour')">ì‹œì§€ ê¸°ì¤€</button>
    </div>
    <div id="ssGrid"></div>
    <div class="ss-legend">
      <div class="ss-leg"><div class="ss-dot" style="background:#34d399"></div>ê¸¸ì„±</div>
      <div class="ss-leg"><div class="ss-dot" style="background:#fbbf24"></div>ì¤‘ì„±</div>
      <div class="ss-leg"><div class="ss-dot" style="background:#f87171"></div>í‰ì„±</div>
      <div class="ss-leg"><div class="ss-dot" style="background:#a78bfa"></div>ì¤‘ë¦½</div>
    </div>
    <div class="ss-detail-list" id="ssDetails"></div>
  </div>

  <div class="r-btns">
    <button class="rbtn rbtn-main" onclick="openShare()">ğŸ“¤ ê³µìœ í•˜ê¸°</button>
    <button class="rbtn rbtn-ghost" onclick="copyTxt()">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
  </div>

  <!-- ê´‘ê³  ìŠ¬ë¡¯ 3: ë²„íŠ¼ ì•„ë˜ ì „ì²´ ë„ˆë¹„ -->
  <div class="ad-slot" style="padding:0;margin:16px 0;">
    <div class="ad-banner ad-banner-large">
      <!-- AdSense ì½”ë“œ ì‚½ì… í›„ class="ad-banner ad-banner-large adsense-active" ë¡œ ë³€ê²½ -->
    </div>
  </div>

  <div class="r-btns">
    <button class="rbtn rbtn-ghost" onclick="restart()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
  </div>
</div>

<div class="modal-bg" id="modalBg" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-title">ê³µìœ í•˜ê¸°</div>
    <div class="share-grid">
      <div class="si" onclick="shareNative()"><div class="si-ico">ğŸ“²</div><div class="si-lbl">ê³µìœ </div></div>
      <div class="si" onclick="shareURL()"><div class="si-ico">ğŸ”—</div><div class="si-lbl">ë§í¬ ë³µì‚¬</div></div>
      <div class="si" onclick="copyTxt();closeModal()"><div class="si-ico">ğŸ“‹</div><div class="si-lbl">í…ìŠ¤íŠ¸</div></div>
    </div>
    <button class="modal-close" onclick="closeModal()">ë‹«ê¸°</button>
  </div>
</div>
<div class="toast" id="toast"></div>

<canvas id="rc"></canvas>

<script>

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìºë¦­í„° ì´ë¯¸ì§€ (ë‹¨ì¼ ì´ë¯¸ì§€, ì„±ë³„ êµ¬ë¶„ ì—†ìŒ)
//  íŒŒì¼ëª…: char_[íƒ€ì…]_f.png / char_[íƒ€ì…]_m.png (7ì¢… Ã— 2 + char_default_f.png + char_default_m.png)
//  íƒ€ì…: none / actor / artist / social / mystery / charisma / pure
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ ì´ë¯¸ì§€ í”„ë¦¬ë¡œë“œ â”€â”€
function prefetchGender(g) {
  ['none','pure','actor','social','artist','mystery','charisma','default'].forEach(t => {
    const link = document.createElement('link');
    link.rel = 'prefetch';
    link.as = 'image';
    link.href = './char_' + t + '_' + g + '.png';
    document.head.appendChild(link);
  });
}
function preloadChar(charType, g) {
  // <link rel="preload"> - ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ
  const src = './char_' + (charType||'none') + '_' + (g||'f') + '.png';
  const existing = document.querySelector(`link[href="${src}"][rel="preload"]`);
  if (existing) return src;
  const link = document.createElement('link');
  link.rel = 'preload';
  link.as = 'image';
  link.href = src;
  document.head.appendChild(link);
  return src;
}

function getChibiSVG(charType, gender) {
  const type = charType || 'none';
  const g = (gender === 'm') ? 'm' : 'f';
  const el = document.createElement('img');
  el.src = './char_' + type + '_' + g + '.png';
  el.className = 'result-chibi-img';
  el.setAttribute('data-type', type);
  el.style.cssText = 'height:360px;width:auto;display:block;object-fit:contain;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35));animation:float 3.5s ease-in-out infinite;';
  // ì„±ë³„ ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ë°˜ëŒ€ ì„±ë³„ â†’ ê¸°ë³¸ ì´ë¯¸ì§€ ìˆœìœ¼ë¡œ í´ë°±
  el.onerror = function() {
    if (this.src.indexOf('_' + g + '.png') !== -1) {
      // í•´ë‹¹ ì„±ë³„ ì—†ìŒ â†’ ë°˜ëŒ€ ì„±ë³„ ì‹œë„
      const opp = g === 'f' ? 'm' : 'f';
      this.src = './char_' + type + '_' + opp + '.png';
    } else if (this.src.indexOf('char_default') === -1) {
      // íƒ€ì… ì´ë¯¸ì§€ ì—†ìŒ â†’ default_f í´ë°±
      this.src = './char_default_f.png';
    } else {
      this.style.display = 'none';
    }
  };
  return el.outerHTML;
}

function getDefaultChibi() {
  const g = (selGender === 'm') ? 'm' : 'f';
  const el = document.createElement('img');
  el.src = './char_default_' + g + '.png';
  el.style.cssText = 'height:inherit;width:auto;object-fit:contain;filter:drop-shadow(0 8px 24px rgba(255,95,160,.3));animation:float 3.5s ease-in-out infinite;';
  el.onerror = function() {
    if (this.src.indexOf('char_default_m') !== -1) {
      this.src = './char_default_f.png'; // m ì—†ìœ¼ë©´ fë¡œ í´ë°±
    } else {
      this.style.display = 'none';
    }
  };
  return el.outerHTML;
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìœ í˜•ë³„ ì¹˜ë¹„ ìƒ‰ìƒ

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìŒë ¥ â†’ ì–‘ë ¥ ë³€í™˜ í…Œì´ë¸”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LUNAR_MONTH1 = {
1930:[[1,30],[2,28],[3,30],[4,29],[5,28],[6,26],[7,26],[8,24],[9,22],[10,22],[11,20],[12,20],[1,19]],
1931:[[2,17],[3,19],[4,18],[5,17],[6,16],[7,15],[8,14],[9,12],[10,11],[11,10],[12,9],[1,8]],
1932:[[2,6],[3,7],[4,6],[5,6],[6,4],[7,4],[8,2],[9,1],[9,30],[10,29],[11,28],[12,27]],
1933:[[1,26],[2,24],[3,26],[4,25],[5,24],[6,23],[7,22],[8,21],[9,20],[10,19],[11,18],[12,17],[1,15]],
1934:[[2,14],[3,15],[4,14],[5,13],[6,12],[7,12],[8,10],[9,9],[10,8],[11,7],[12,7],[1,5]],
1935:[[2,4],[3,5],[4,3],[5,3],[6,1],[7,1],[7,30],[8,29],[9,28],[10,27],[11,26],[12,26]],
1936:[[1,24],[2,23],[3,23],[4,21],[5,21],[6,19],[7,18],[8,17],[9,16],[10,15],[11,14],[12,14],[1,13]],
1937:[[2,11],[3,13],[4,11],[5,10],[6,9],[7,8],[8,6],[9,5],[10,4],[11,3],[12,3],[1,2]],
1938:[[1,31],[3,2],[4,1],[4,30],[5,29],[6,28],[7,27],[8,25],[9,24],[10,23],[11,22],[12,22],[1,20]],
1939:[[2,19],[3,21],[4,20],[5,19],[6,17],[7,17],[8,15],[9,13],[10,13],[11,11],[12,11],[1,9]],
1940:[[2,8],[3,9],[4,8],[5,7],[6,6],[7,5],[8,4],[9,2],[10,1],[10,31],[11,29],[12,29]],
1941:[[1,27],[2,26],[3,28],[4,26],[5,26],[6,25],[7,24],[8,23],[9,21],[10,20],[11,19],[12,18],[1,17]],
1942:[[2,15],[3,17],[4,15],[5,15],[6,14],[7,13],[8,12],[9,10],[10,10],[11,8],[12,8],[1,6]],
1943:[[2,5],[3,6],[4,5],[5,4],[6,3],[7,2],[8,1],[8,31],[9,29],[10,29],[11,27],[12,27]],
1944:[[1,25],[2,24],[3,24],[4,23],[5,22],[6,21],[7,20],[8,19],[9,17],[10,17],[11,16],[12,15],[1,14]],
1945:[[2,13],[3,14],[4,12],[5,12],[6,10],[7,9],[8,8],[9,6],[10,6],[11,5],[12,5],[1,3]],
1946:[[2,2],[3,4],[4,2],[5,1],[5,31],[6,29],[7,28],[8,27],[9,25],[10,25],[11,24],[12,23]],
1947:[[1,22],[2,21],[3,23],[4,21],[5,20],[6,19],[7,18],[8,16],[9,15],[10,14],[11,13],[12,12],[1,11]],
1948:[[2,10],[3,11],[4,9],[5,9],[6,7],[7,7],[8,5],[9,3],[10,3],[11,1],[12,1],[12,30]],
1949:[[1,29],[2,28],[3,29],[4,28],[5,28],[6,26],[7,26],[8,24],[9,22],[10,22],[11,20],[12,20],[1,18]],
1950:[[2,17],[3,18],[4,17],[5,17],[6,15],[7,15],[8,14],[9,12],[10,11],[11,10],[12,9],[1,8]],
1951:[[2,6],[3,8],[4,6],[5,6],[6,5],[7,4],[8,3],[9,1],[10,1],[10,30],[11,29],[12,28]],
1952:[[1,27],[2,25],[3,26],[4,24],[5,24],[6,22],[7,22],[8,20],[9,19],[10,19],[11,17],[12,17],[1,15]],
1953:[[2,14],[3,15],[4,14],[5,13],[6,11],[7,11],[8,10],[9,8],[10,8],[11,7],[12,6],[1,5]],
1954:[[2,3],[3,5],[4,3],[5,3],[6,1],[6,30],[7,30],[8,28],[9,27],[10,27],[11,25],[12,25]],
1955:[[1,24],[2,22],[3,24],[4,22],[5,22],[6,20],[7,19],[8,18],[9,16],[10,16],[11,14],[12,14],[1,13]],
1956:[[2,12],[3,12],[4,11],[5,10],[6,9],[7,8],[8,6],[9,5],[10,4],[11,3],[12,2],[1,1]],
1957:[[1,31],[3,2],[3,31],[4,30],[5,29],[6,28],[7,27],[8,25],[9,24],[10,23],[11,22],[12,21],[1,20]],
1958:[[2,18],[3,20],[4,19],[5,19],[6,17],[7,17],[8,15],[9,13],[10,13],[11,11],[12,11],[1,9]],
1959:[[2,8],[3,9],[4,8],[5,8],[6,6],[7,6],[8,4],[9,3],[10,2],[11,1],[11,30],[12,30]],
1960:[[1,28],[2,27],[3,27],[4,26],[5,25],[6,24],[7,24],[8,22],[9,21],[10,20],[11,19],[12,18],[1,17]],
1961:[[2,15],[3,17],[4,15],[5,15],[6,13],[7,13],[8,11],[9,10],[10,10],[11,8],[12,8],[1,6]],
1962:[[2,5],[3,6],[4,5],[5,4],[6,2],[7,2],[7,31],[8,30],[9,29],[10,28],[11,27],[12,27]],
1963:[[1,25],[2,24],[3,25],[4,24],[5,23],[6,21],[7,21],[8,19],[9,18],[10,17],[11,16],[12,16],[1,15]],
1964:[[2,13],[3,14],[4,12],[5,12],[6,10],[7,9],[8,8],[9,6],[10,6],[11,4],[12,4],[1,3]],
1965:[[2,2],[3,3],[4,2],[5,1],[5,31],[6,29],[7,28],[8,27],[9,25],[10,24],[11,23],[12,23]],
1966:[[1,21],[2,20],[3,22],[4,21],[5,20],[6,19],[7,18],[8,16],[9,15],[10,14],[11,12],[12,12],[1,11]],
1967:[[2,9],[3,11],[4,10],[5,9],[6,8],[7,8],[8,6],[9,4],[10,4],[11,2],[12,2],[12,31]],
1968:[[1,30],[2,28],[3,29],[4,27],[5,27],[6,26],[7,25],[8,24],[9,22],[10,22],[11,20],[12,20],[1,18]],
1969:[[2,17],[3,18],[4,17],[5,16],[6,15],[7,14],[8,13],[9,12],[10,11],[11,10],[12,9],[1,8]],
1970:[[2,6],[3,8],[4,6],[5,5],[6,4],[7,3],[8,2],[9,1],[9,30],[10,30],[11,29],[12,28]],
1971:[[1,27],[2,25],[3,27],[4,25],[5,24],[6,23],[7,22],[8,21],[9,19],[10,19],[11,18],[12,18],[1,16]],
1972:[[2,15],[3,15],[4,14],[5,13],[6,11],[7,11],[8,9],[9,8],[10,7],[11,6],[12,6],[1,4]],
1973:[[2,3],[3,5],[4,3],[5,3],[6,1],[6,30],[7,30],[8,28],[9,26],[10,26],[11,25],[12,24]],
1974:[[1,23],[2,22],[3,24],[4,22],[5,22],[6,20],[7,19],[8,18],[9,16],[10,15],[11,14],[12,14],[1,12]],
1975:[[2,11],[3,13],[4,12],[5,11],[6,10],[7,9],[8,7],[9,6],[10,5],[11,3],[12,3],[1,1]],
1976:[[1,31],[3,1],[3,31],[4,29],[5,29],[6,27],[7,27],[8,25],[9,24],[10,23],[11,21],[12,21],[1,19]],
1977:[[2,18],[3,20],[4,18],[5,18],[6,17],[7,16],[8,15],[9,13],[10,13],[11,11],[12,11],[1,9]],
1978:[[2,7],[3,9],[4,7],[5,7],[6,6],[7,5],[8,4],[9,3],[10,2],[11,1],[11,30],[12,30]],
1979:[[1,28],[2,27],[3,28],[4,26],[5,26],[6,24],[7,24],[8,23],[9,21],[10,21],[11,20],[12,19],[1,18]],
1980:[[2,16],[3,17],[4,15],[5,14],[6,13],[7,12],[8,11],[9,9],[10,9],[11,8],[12,7],[1,6]],
1981:[[2,5],[3,6],[4,5],[5,4],[6,2],[7,2],[7,31],[8,29],[9,28],[10,28],[11,26],[12,26]],
1982:[[1,25],[2,24],[3,25],[4,24],[5,23],[6,21],[7,21],[8,19],[9,17],[10,17],[11,15],[12,15],[1,14]],
1983:[[2,13],[3,15],[4,13],[5,13],[6,11],[7,10],[8,9],[9,7],[10,6],[11,5],[12,4],[1,3]],
1984:[[2,2],[3,3],[4,1],[5,1],[5,31],[6,29],[7,28],[8,27],[9,25],[10,24],[11,23],[12,22],[1,21]],
1985:[[2,20],[3,21],[4,20],[5,20],[6,18],[7,18],[8,16],[9,15],[10,14],[11,12],[12,12],[1,10]],
1986:[[2,9],[3,10],[4,9],[5,9],[6,7],[7,7],[8,6],[9,4],[10,4],[11,2],[12,2],[12,31]],
1987:[[1,29],[2,28],[3,29],[4,28],[5,27],[6,26],[7,26],[8,24],[9,23],[10,23],[11,21],[12,21],[1,19]],
1988:[[2,17],[3,18],[4,16],[5,16],[6,14],[7,14],[8,12],[9,11],[10,11],[11,9],[12,9],[1,8]],
1989:[[2,6],[3,8],[4,6],[5,5],[6,4],[7,3],[8,2],[8,31],[9,30],[10,29],[11,28],[12,28]],
1990:[[1,27],[2,25],[3,27],[4,25],[5,24],[6,23],[7,22],[8,20],[9,19],[10,18],[11,17],[12,17],[1,16]],
1991:[[2,15],[3,16],[4,15],[5,14],[6,12],[7,12],[8,10],[9,8],[10,8],[11,6],[12,6],[1,5]],
1992:[[2,4],[3,4],[4,3],[5,3],[6,1],[6,30],[7,30],[8,28],[9,26],[10,26],[11,24],[12,24]],
1993:[[1,23],[2,21],[3,23],[4,22],[5,21],[6,20],[7,19],[8,18],[9,16],[10,15],[11,14],[12,13],[1,12]],
1994:[[2,10],[3,12],[4,11],[5,11],[6,9],[7,9],[8,7],[9,6],[10,5],[11,3],[12,3],[1,1]],
1995:[[1,31],[3,1],[3,31],[4,30],[5,29],[6,28],[7,27],[8,26],[9,25],[10,24],[11,22],[12,22],[1,20]],
1996:[[2,19],[3,19],[4,18],[5,17],[6,16],[7,15],[8,14],[9,12],[10,12],[11,11],[12,11],[1,9]],
1997:[[2,7],[3,9],[4,7],[5,7],[6,5],[7,5],[8,3],[9,2],[10,2],[10,31],[11,30],[12,30]],
1998:[[1,28],[2,27],[3,28],[4,26],[5,26],[6,24],[7,23],[8,22],[9,21],[10,20],[11,19],[12,19],[1,17]],
1999:[[2,16],[3,18],[4,16],[5,15],[6,14],[7,13],[8,11],[9,10],[10,9],[11,8],[12,8],[1,7]],
2000:[[2,5],[3,6],[4,5],[5,4],[6,2],[7,2],[7,31],[8,29],[9,28],[10,27],[11,26],[12,26]],
2001:[[1,24],[2,23],[3,25],[4,23],[5,23],[6,21],[7,21],[8,19],[9,17],[10,17],[11,15],[12,15],[1,13]],
2002:[[2,12],[3,14],[4,13],[5,12],[6,11],[7,10],[8,9],[9,7],[10,6],[11,5],[12,4],[1,3]],
2003:[[2,1],[3,3],[4,2],[5,1],[5,31],[6,30],[7,29],[8,28],[9,26],[10,25],[11,24],[12,23]],
2004:[[1,22],[2,20],[3,21],[4,19],[5,19],[6,18],[7,17],[8,16],[9,14],[10,14],[11,12],[12,12],[1,10]],
2005:[[2,9],[3,10],[4,9],[5,8],[6,7],[7,6],[8,5],[9,4],[10,3],[11,2],[12,1],[12,31]],
2006:[[1,29],[2,28],[3,29],[4,28],[5,27],[6,26],[7,25],[8,24],[9,22],[10,22],[11,21],[12,20],[1,19]],
2007:[[2,18],[3,19],[4,17],[5,17],[6,15],[7,14],[8,13],[9,11],[10,11],[11,10],[12,10],[1,8]],
2008:[[2,7],[3,8],[4,6],[5,5],[6,4],[7,3],[8,1],[8,31],[9,29],[10,29],[11,28],[12,27]],
2009:[[1,26],[2,25],[3,27],[4,25],[5,24],[6,23],[7,22],[8,20],[9,19],[10,18],[11,17],[12,16],[1,15]],
2010:[[2,14],[3,16],[4,14],[5,14],[6,12],[7,12],[8,10],[9,8],[10,8],[11,6],[12,6],[1,4]],
2011:[[2,3],[3,5],[4,3],[5,3],[6,2],[7,1],[7,31],[8,29],[9,27],[10,27],[11,25],[12,25]],
2012:[[1,23],[2,22],[3,22],[4,21],[5,21],[6,19],[7,19],[8,17],[9,16],[10,15],[11,14],[12,13],[1,12]],
2013:[[2,10],[3,12],[4,10],[5,10],[6,8],[7,8],[8,7],[9,5],[10,5],[11,3],[12,3],[1,1]],
2014:[[1,31],[3,1],[3,31],[4,29],[5,29],[6,27],[7,27],[8,25],[9,24],[10,24],[11,22],[12,22],[1,20]],
2015:[[2,19],[3,20],[4,19],[5,18],[6,16],[7,16],[8,14],[9,13],[10,13],[11,12],[12,11],[1,10]],
2016:[[2,8],[3,9],[4,7],[5,7],[6,5],[7,4],[8,3],[9,1],[10,1],[10,31],[11,29],[12,29]],
2017:[[1,28],[2,26],[3,28],[4,26],[5,26],[6,24],[7,23],[8,22],[9,20],[10,20],[11,18],[12,18],[1,17]],
2018:[[2,16],[3,17],[4,16],[5,15],[6,14],[7,13],[8,11],[9,10],[10,9],[11,8],[12,7],[1,6]],
2019:[[2,5],[3,7],[4,5],[5,5],[6,3],[7,3],[8,1],[8,30],[9,29],[10,28],[11,26],[12,26]],
2020:[[1,25],[2,23],[3,24],[4,23],[5,23],[6,21],[7,21],[8,19],[9,17],[10,17],[11,15],[12,15],[1,13]],
2021:[[2,12],[3,13],[4,12],[5,12],[6,10],[7,10],[8,8],[9,7],[10,6],[11,5],[12,4],[1,3]],
2022:[[2,1],[3,3],[4,1],[5,1],[5,30],[6,29],[7,29],[8,27],[9,26],[10,25],[11,24],[12,23]],
2023:[[1,22],[2,20],[3,22],[4,20],[5,19],[6,18],[7,18],[8,16],[9,15],[10,15],[11,13],[12,13],[1,11]],
2024:[[2,10],[3,10],[4,9],[5,8],[6,6],[7,6],[8,4],[9,3],[10,3],[11,1],[12,1],[12,31]],
2025:[[1,29],[2,28],[3,29],[4,28],[5,27],[6,25],[7,25],[8,23],[9,22],[10,21],[11,20],[12,20],[1,19]],
2026:[[2,17],[3,19],[4,17],[5,17],[6,15],[7,14],[8,13],[9,11],[10,10],[11,9],[12,9],[1,8]],
2027:[[2,6],[3,8],[4,7],[5,6],[6,5],[7,4],[8,2],[9,1],[9,30],[10,29],[11,28],[12,28]],
2028:[[1,26],[2,25],[3,26],[4,25],[5,24],[6,23],[7,22],[8,20],[9,19],[10,18],[11,16],[12,16],[1,15]],
2029:[[2,13],[3,15],[4,14],[5,13],[6,12],[7,11],[8,10],[9,8],[10,8],[11,6],[12,5],[1,4]],
2030:[[2,3],[3,4],[4,3],[5,2],[6,1],[7,1],[7,30],[8,29],[9,27],[10,27],[11,25],[12,25]],
2031:[[1,23],[2,21],[3,23],[4,22],[5,21],[6,20],[7,19],[8,18],[9,17],[10,16],[11,15],[12,14],[1,13]],
2032:[[2,11],[3,12],[4,10],[5,9],[6,8],[7,7],[8,6],[9,5],[10,4],[11,3],[12,3],[1,1]],
2033:[[1,31],[3,1],[3,31],[4,29],[5,28],[6,27],[7,26],[8,25],[9,23],[10,23],[11,22],[12,22],[1,20]],
2034:[[2,19],[3,20],[4,19],[5,18],[6,16],[7,16],[8,14],[9,13],[10,12],[11,11],[12,11],[1,9]],
2035:[[2,8],[3,10],[4,8],[5,8],[6,6],[7,5],[8,4],[9,2],[10,1],[10,31],[11,30],[12,29]],
2036:[[1,28],[2,27],[3,28],[4,26],[5,26],[6,24],[7,23],[8,22],[9,20],[10,19],[11,18],[12,17],[1,16]],
2037:[[2,15],[3,17],[4,16],[5,15],[6,14],[7,13],[8,11],[9,10],[10,9],[11,7],[12,7],[1,5]],
2038:[[2,4],[3,6],[4,5],[5,4],[6,3],[7,2],[8,1],[8,30],[9,29],[10,28],[11,26],[12,26]],
2039:[[1,24],[2,23],[3,25],[4,23],[5,23],[6,22],[7,21],[8,20],[9,18],[10,18],[11,16],[12,16],[1,14]],
2040:[[2,12],[3,13],[4,11],[5,11],[6,10],[7,9],[8,8],[9,6],[10,6],[11,5],[12,4],[1,3]],
2041:[[2,1],[3,2],[4,1],[4,30],[5,30],[6,28],[7,28],[8,27],[9,25],[10,25],[11,24],[12,23]],
2042:[[1,22],[2,20],[3,22],[4,20],[5,19],[6,18],[7,17],[8,16],[9,14],[10,14],[11,13],[12,12],[1,11]],
2043:[[2,10],[3,11],[4,10],[5,9],[6,7],[7,7],[8,5],[9,3],[10,3],[11,2],[12,1],[12,31]],
2044:[[1,30],[2,29],[3,29],[4,28],[5,27],[6,25],[7,25],[8,23],[9,21],[10,21],[11,19],[12,19],[1,18]],
2045:[[2,17],[3,19],[4,17],[5,17],[6,15],[7,14],[8,13],[9,11],[10,10],[11,9],[12,8],[1,7]],
2046:[[2,6],[3,8],[4,6],[5,6],[6,4],[7,4],[8,2],[9,1],[9,30],[10,29],[11,28],[12,27]],
2047:[[1,26],[2,25],[3,26],[4,25],[5,25],[6,23],[7,23],[8,21],[9,20],[10,19],[11,17],[12,17],[1,15]],
2048:[[2,14],[3,14],[4,13],[5,13],[6,11],[7,11],[8,10],[9,8],[10,8],[11,6],[12,5],[1,4]],
2049:[[2,2],[3,4],[4,2],[5,2],[5,31],[6,30],[7,30],[8,28],[9,27],[10,27],[11,25],[12,25]],
2050:[[1,23],[2,21],[3,23],[4,21],[5,21],[6,19],[7,19],[8,17],[9,16],[10,16],[11,14],[12,14],[1,13]]
};
const LEAP_MONTH = {
1930:6,1933:5,1936:3,1938:7,1941:6,1944:4,1947:2,1949:7,1952:5,1955:3,1957:8,1960:6,1963:4,1966:3,1968:7,1971:5,1974:4,1976:8,1979:6,1982:4,1984:10,1987:6,1990:5,1993:3,1995:8,1998:5,2001:4,2004:2,2006:7,2009:5,2012:4,2014:9,2017:6,2020:4,2023:2,2025:6,2028:5,2031:3,2033:11,2036:6,2039:5,2042:2,2044:7,2047:5,2050:3
};

function lunarToSolar(lunarYear, lunarMonth, lunarDay, isLeap) {
  const mData = LUNAR_MONTH1[lunarYear];
  if (!mData) return null;
  const leapM = LEAP_MONTH[lunarYear] || 0;
  let idx = lunarMonth - 1;
  if (leapM > 0 && leapM < lunarMonth) idx++;
  if (isLeap && leapM === lunarMonth) idx = lunarMonth;
  if (idx >= mData.length) return null;
  const [sm, sd] = mData[idx];
  const dt = new Date(lunarYear, sm - 1, sd + lunarDay - 1);
  return { year: dt.getFullYear(), month: dt.getMonth() + 1, day: dt.getDate() };
}
function solarToLunar(sy, sm, sd) {
  const LUNAR_DATA = [
    0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,0x04ae0,
    0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,0x04970,0x0a4b0,
    0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,0x06566,0x0d4a0,0x0ea50,
    0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,0x0d4a0,0x1d8a6,0x0b550,0x056a0,
    0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,
    0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,
    0x0f263,0x0d950,0x05b57,0x056a0,0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,
    0x0b540,0x0b6a0,0x195a6,0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,
    0x0ab60,0x09570,0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,
    0x092e0,0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
    0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,0x07954,
    0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,0x05aa0,0x076a3,
    0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,0x0b5a0,0x056d0,0x055b2,
    0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,0x14b63,0x09370,0x049f8,0x04970,
    0x064b0,0x168a6,0x0ea50,0x06b20,0x1a6c4,0x0aae0,0x0a2e0,0x0d2e3,0x0c960,0x0d557,0x0d4a0,
  ];
  const BASE = Date.UTC(1900,0,31);
  const gLeap = y => LUNAR_DATA[y-1900] & 0xf;
  const gLD   = y => { const l=gLeap(y); return l?(LUNAR_DATA[y-1900]&0x10000?30:29):0; };
  const gMD   = (y,m) => LUNAR_DATA[y-1900]&(0x10000>>m)?30:29;
  const gYD   = y => { let s=348; for(let i=0x8000;i>0x8;i>>=1)s+=LUNAR_DATA[y-1900]&i?1:0; return s+gLD(y); };

  let off = Math.floor((Date.UTC(sy,sm-1,sd)-BASE)/86400000);
  let ly = 1900;
  for(let y=1900;y<=2050;y++){ const yd=gYD(y); if(off<yd){ly=y;break;} off-=yd; }
  const leapM=gLeap(ly);
  let lm=1, isLeap=false, rem=off;
  for(let m=1;m<=12;m++){
    const md=gMD(ly,m); if(rem<md){lm=m;break;} rem-=md;
    if(leapM>0&&m===leapM){ const ld=gLD(ly); if(rem<ld){lm=m;isLeap=true;break;} rem-=ld; }
  }
  return { year:ly, month:lm, day:rem+1, isLeap };
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  24ì ˆê¸° ë°ì´í„° (í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ë°˜)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const JEOLGI = {
1930:[[1,6,16,26],[2,5,4,29],[3,6,22,31],[4,6,9,57],[5,6,23,34],[6,7,8,9],[7,8,1,56],[8,8,16,24],[9,8,6,41],[10,8,21,30],[11,8,7,16],[12,8,8,6]],
1931:[[1,6,22,24],[2,5,10,28],[3,7,4,27],[4,6,15,50],[5,7,5,26],[6,7,13,58],[7,8,7,46],[8,8,22,15],[9,9,12,31],[10,9,3,19],[11,8,13,7],[12,8,14,0]],
1932:[[1,6,3,58],[2,5,15,58],[3,6,10,2],[4,5,21,27],[5,6,11,5],[6,6,19,40],[7,7,13,26],[8,8,3,56],[9,8,18,14],[10,8,9,2],[11,7,18,51],[12,7,19,44]],
1933:[[1,6,9,50],[2,4,21,52],[3,6,16,0],[4,6,3,24],[5,6,17,1],[6,7,1,34],[7,7,19,20],[8,8,9,48],[9,8,0,3],[10,8,14,52],[11,8,0,40],[12,8,1,33]],
1934:[[1,6,15,47],[2,5,3,50],[3,6,21,58],[4,6,9,22],[5,6,22,59],[6,7,7,31],[7,8,1,16],[8,8,15,44],[9,8,5,59],[10,8,20,48],[11,8,6,35],[12,8,7,28]],
1935:[[1,6,21,35],[2,5,9,37],[3,6,3,47],[4,6,15,12],[5,7,4,50],[6,7,13,23],[7,8,7,10],[8,8,21,39],[9,8,11,55],[10,9,2,44],[11,8,12,33],[12,8,13,27]],
1936:[[1,6,3,27],[2,5,15,31],[3,6,9,40],[4,5,21,5],[5,6,10,43],[6,6,19,17],[7,7,13,3],[8,8,3,32],[9,8,17,49],[10,8,8,37],[11,7,18,26],[12,7,19,20]],
1937:[[1,6,9,14],[2,4,21,17],[3,6,15,27],[4,6,2,52],[5,6,16,30],[6,7,1,3],[7,7,18,50],[8,8,9,18],[9,8,23,35],[10,8,14,23],[11,8,0,11],[12,8,1,5]],
1938:[[1,6,15,4],[2,5,3,7],[3,6,21,17],[4,6,8,42],[5,6,22,20],[6,7,6,54],[7,8,0,42],[8,8,15,11],[9,8,5,29],[10,8,20,18],[11,8,6,7],[12,8,7,1]],
1939:[[1,6,20,59],[2,5,9,2],[3,6,3,12],[4,6,14,37],[5,7,4,15],[6,7,12,50],[7,8,6,37],[8,8,21,6],[9,8,11,23],[10,9,2,12],[11,8,12,1],[12,8,12,55]],
1940:[[1,6,2,47],[2,5,14,52],[3,6,9,0],[4,5,20,25],[5,6,10,3],[6,6,18,37],[7,7,12,23],[8,8,2,51],[9,8,17,9],[10,8,7,57],[11,7,17,45],[12,7,18,38]],
1941:[[1,6,8,35],[2,4,20,37],[3,6,14,47],[4,6,2,11],[5,6,15,49],[6,7,0,22],[7,7,18,9],[8,8,8,37],[9,8,22,53],[10,8,13,41],[11,7,23,29],[12,7,23,22]],
1942:[[1,6,14,24],[2,5,2,27],[3,6,20,36],[4,6,8,1],[5,6,21,39],[6,7,6,13],[7,8,0,0],[8,8,14,29],[9,8,4,47],[10,8,19,36],[11,8,5,26],[12,8,6,20]],
1943:[[1,6,20,15],[2,5,8,17],[3,6,2,28],[4,6,13,53],[5,7,3,32],[6,7,12,6],[7,8,5,53],[8,8,20,23],[9,8,10,39],[10,9,1,29],[11,8,11,18],[12,8,12,12]],
1944:[[1,6,2,5],[2,5,14,8],[3,6,8,18],[4,5,19,43],[5,6,9,22],[6,6,17,57],[7,7,11,44],[8,8,2,13],[9,8,16,31],[10,8,7,20],[11,7,17,9],[12,7,18,3]],
1945:[[1,6,7,55],[2,4,19,58],[3,6,14,8],[4,6,1,33],[5,6,15,12],[6,6,23,46],[7,7,17,34],[8,8,8,3],[9,8,22,20],[10,8,13,9],[11,7,22,58],[12,7,23,52]],
1946:[[1,6,13,44],[2,5,1,47],[3,6,19,57],[4,6,7,22],[5,6,21,1],[6,7,5,35],[7,7,23,23],[8,8,13,52],[9,8,4,10],[10,8,18,59],[11,8,4,49],[12,8,5,43]],
1947:[[1,6,19,34],[2,5,7,37],[3,6,1,47],[4,6,13,12],[5,7,2,51],[6,7,11,25],[7,8,5,12],[8,8,19,42],[9,8,9,58],[10,9,0,48],[11,8,10,37],[12,8,11,32]],
1948:[[1,6,1,23],[2,5,13,26],[3,6,7,36],[4,5,19,1],[5,6,8,40],[6,6,17,14],[7,7,11,2],[8,8,1,32],[9,8,15,49],[10,8,6,38],[11,7,16,27],[12,7,17,21]],
1949:[[1,6,7,12],[2,4,19,15],[3,6,13,25],[4,6,0,50],[5,6,14,29],[6,6,23,3],[7,7,16,50],[8,8,7,19],[9,8,21,36],[10,8,12,24],[11,7,22,13],[12,7,23,7]],
1950:[[1,6,13,1],[2,5,1,4],[3,6,19,14],[4,6,6,39],[5,6,20,18],[6,7,4,52],[7,7,22,39],[8,8,13,9],[9,8,3,26],[10,8,18,15],[11,8,4,4],[12,8,4,57]],
1951:[[1,6,18,50],[2,5,6,52],[3,6,1,2],[4,6,12,27],[5,7,2,6],[6,7,10,40],[7,8,4,27],[8,8,18,57],[9,8,9,13],[10,8,24,2],[11,8,9,52],[12,8,10,46]],
1952:[[1,6,0,38],[2,5,12,41],[3,6,6,51],[4,5,18,16],[5,6,7,55],[6,6,16,29],[7,7,10,16],[8,8,0,46],[9,8,15,3],[10,8,5,52],[11,7,15,41],[12,7,16,35]],
1953:[[1,6,6,27],[2,4,18,30],[3,6,12,40],[4,6,0,5],[5,6,13,44],[6,6,22,18],[7,7,16,5],[8,8,6,35],[9,8,20,51],[10,8,11,40],[11,7,21,29],[12,7,22,23]],
1954:[[1,6,12,17],[2,5,0,20],[3,6,18,30],[4,6,5,55],[5,6,19,34],[6,7,4,8],[7,7,21,55],[8,8,12,25],[9,8,2,41],[10,8,17,30],[11,8,3,19],[12,8,4,12]],
1955:[[1,6,18,8],[2,5,6,11],[3,6,0,21],[4,6,11,46],[5,7,1,25],[6,7,9,59],[7,8,3,46],[8,8,18,15],[9,8,8,31],[10,8,23,20],[11,8,9,9],[12,8,10,2]],
1956:[[1,5,23,57],[2,5,12,0],[3,6,6,10],[4,5,17,35],[5,6,7,14],[6,6,15,48],[7,7,9,35],[8,8,0,5],[9,8,14,22],[10,8,5,11],[11,7,15,0],[12,7,15,54]],
1957:[[1,6,5,47],[2,4,17,50],[3,6,12,0],[4,5,23,25],[5,6,13,4],[6,6,21,38],[7,7,15,25],[8,8,5,55],[9,8,20,11],[10,8,11,0],[11,7,20,49],[12,7,21,43]],
1958:[[1,6,11,39],[2,5,23,42],[3,6,17,52],[4,6,5,17],[5,6,18,56],[6,7,3,30],[7,7,21,17],[8,8,11,47],[9,8,2,3],[10,8,16,52],[11,8,2,41],[12,8,3,35]],
1959:[[1,6,17,31],[2,5,5,33],[3,6,23,43],[4,6,11,8],[5,7,0,47],[6,7,9,21],[7,8,3,8],[8,8,17,38],[9,8,7,54],[10,8,22,43],[11,8,8,32],[12,8,9,26]],
1960:[[1,5,23,22],[2,4,11,25],[3,5,5,35],[4,5,17,0],[5,6,6,39],[6,6,15,13],[7,7,9,0],[8,7,23,30],[9,8,13,47],[10,8,4,36],[11,7,14,25],[12,7,15,19]],
1961:[[1,6,5,14],[2,4,17,16],[3,6,11,27],[4,5,22,52],[5,6,12,31],[6,6,21,5],[7,7,14,52],[8,8,5,22],[9,8,19,38],[10,8,10,27],[11,7,20,16],[12,7,21,10]],
1962:[[1,6,11,6],[2,4,23,10],[3,6,17,20],[4,6,4,45],[5,6,18,24],[6,7,2,58],[7,7,20,45],[8,8,11,14],[9,8,1,31],[10,8,16,20],[11,8,2,9],[12,8,3,2]],
1963:[[1,6,17,1],[2,5,5,4],[3,6,23,14],[4,6,10,39],[5,7,0,18],[6,7,8,52],[7,8,2,39],[8,8,17,8],[9,8,7,25],[10,8,22,13],[11,8,8,2],[12,8,8,56]],
1964:[[1,5,22,54],[2,4,11,0],[3,5,5,10],[4,5,16,35],[5,6,6,14],[6,6,14,48],[7,7,8,35],[8,7,23,5],[9,8,13,22],[10,8,4,11],[11,7,14,0],[12,7,14,54]],
1965:[[1,6,4,46],[2,4,16,46],[3,6,10,57],[4,5,22,22],[5,6,12,1],[6,6,20,35],[7,7,14,22],[8,8,4,52],[9,8,19,8],[10,8,9,57],[11,7,19,46],[12,7,20,40]],
1966:[[1,6,10,38],[2,4,22,39],[3,6,16,49],[4,6,4,14],[5,6,17,53],[6,7,2,27],[7,7,20,14],[8,8,10,43],[9,8,1,0],[10,8,15,49],[11,8,1,38],[12,8,2,32]],
1967:[[1,6,16,30],[2,5,4,33],[3,6,22,43],[4,6,10,8],[5,6,23,47],[6,7,8,21],[7,8,2,8],[8,8,16,38],[9,8,6,54],[10,8,21,43],[11,8,7,32],[12,8,8,26]],
1968:[[1,5,22,23],[2,4,10,26],[3,5,4,36],[4,5,16,1],[5,6,5,40],[6,6,14,14],[7,7,8,1],[8,7,22,31],[9,8,12,48],[10,8,3,37],[11,7,13,26],[12,7,14,20]],
1969:[[1,6,4,16],[2,4,16,19],[3,6,10,29],[4,5,21,54],[5,6,11,33],[6,6,20,7],[7,7,13,54],[8,8,4,24],[9,8,18,40],[10,8,9,29],[11,7,19,18],[12,7,20,12]],
1970:[[1,6,10,7],[2,4,22,10],[3,6,16,20],[4,6,3,45],[5,6,17,24],[6,7,1,58],[7,7,19,45],[8,8,10,15],[9,8,0,31],[10,8,15,20],[11,8,1,9],[12,8,2,3]],
1971:[[1,6,15,59],[2,5,4,2],[3,6,22,12],[4,6,9,37],[5,6,23,16],[6,7,7,50],[7,8,1,37],[8,8,16,7],[9,8,6,23],[10,8,21,12],[11,8,7,1],[12,8,7,55]],
1972:[[1,5,21,48],[2,4,9,51],[3,5,4,1],[4,5,15,26],[5,6,5,5],[6,6,13,39],[7,7,7,26],[8,7,21,56],[9,8,12,12],[10,8,3,1],[11,7,12,50],[12,7,13,44]],
1973:[[1,6,3,38],[2,4,15,41],[3,6,9,51],[4,5,21,16],[5,6,10,55],[6,6,19,29],[7,7,13,16],[8,8,3,46],[9,8,18,2],[10,8,8,51],[11,7,18,40],[12,7,19,34]],
1974:[[1,6,9,30],[2,4,21,33],[3,6,15,43],[4,6,3,8],[5,6,16,47],[6,7,1,21],[7,7,19,8],[8,8,9,38],[9,7,23,54],[10,8,14,43],[11,8,0,32],[12,8,1,26]],
1975:[[1,6,15,22],[2,5,3,25],[3,6,21,35],[4,6,9,0],[5,6,22,39],[6,7,7,13],[7,8,1,0],[8,8,15,30],[9,8,5,46],[10,8,20,35],[11,8,6,24],[12,8,7,18]],
1976:[[1,5,21,12],[2,4,9,15],[3,5,3,25],[4,5,14,50],[5,6,4,29],[6,6,13,3],[7,7,6,50],[8,7,21,20],[9,8,11,36],[10,8,2,25],[11,7,12,14],[12,7,13,8]],
1977:[[1,6,3,2],[2,4,15,5],[3,6,9,15],[4,5,20,40],[5,6,10,19],[6,6,18,53],[7,7,12,40],[8,8,3,10],[9,8,17,26],[10,8,8,15],[11,7,18,4],[12,7,18,58]],
1978:[[1,6,8,53],[2,4,20,57],[3,6,15,7],[4,6,2,32],[5,6,16,11],[6,7,0,45],[7,7,18,32],[8,8,9,2],[9,7,23,18],[10,8,14,7],[11,7,23,56],[12,8,0,49]],
1979:[[1,6,14,44],[2,5,2,47],[3,6,20,57],[4,6,8,22],[5,6,22,1],[6,7,6,35],[7,8,0,22],[8,8,14,51],[9,8,5,7],[10,8,19,56],[11,8,5,45],[12,8,6,39]],
1980:[[1,5,20,34],[2,4,8,37],[3,5,2,47],[4,5,14,12],[5,6,3,51],[6,6,12,25],[7,7,6,12],[8,7,20,42],[9,8,10,58],[10,8,1,47],[11,7,11,36],[12,7,12,30]],
1981:[[1,6,2,25],[2,4,14,28],[3,6,8,38],[4,5,20,3],[5,6,9,42],[6,6,18,16],[7,7,12,3],[8,8,2,33],[9,8,16,49],[10,8,7,38],[11,7,17,27],[12,7,18,21]],
1982:[[1,6,8,17],[2,4,20,20],[3,6,14,30],[4,6,1,55],[5,6,15,34],[6,7,0,8],[7,7,17,55],[8,8,8,25],[9,7,22,41],[10,8,13,30],[11,7,23,19],[12,8,0,13]],
1983:[[1,6,14,7],[2,5,2,10],[3,6,20,20],[4,6,7,45],[5,6,21,24],[6,7,5,58],[7,7,23,45],[8,8,14,15],[9,8,4,31],[10,8,19,20],[11,8,5,9],[12,8,6,3]],
1984:[[1,5,19,57],[2,4,8,0],[3,5,2,10],[4,5,13,35],[5,6,3,14],[6,6,11,48],[7,7,5,35],[8,7,20,5],[9,8,10,21],[10,8,1,10],[11,7,10,59],[12,7,11,53]],
1985:[[1,6,1,48],[2,4,13,51],[3,6,8,1],[4,5,19,26],[5,6,9,5],[6,6,17,39],[7,7,11,26],[8,8,1,56],[9,8,16,12],[10,8,7,1],[11,7,16,50],[12,7,17,44]],
1986:[[1,6,7,40],[2,4,19,43],[3,6,13,53],[4,6,1,18],[5,6,14,57],[6,6,23,31],[7,7,17,18],[8,8,7,48],[9,7,22,4],[10,8,12,53],[11,7,22,42],[12,7,23,36]],
1987:[[1,6,13,30],[2,5,1,33],[3,6,19,43],[4,6,7,8],[5,6,20,47],[6,7,5,21],[7,7,23,8],[8,8,13,38],[9,8,3,54],[10,8,18,43],[11,8,4,32],[12,8,5,26]],
1988:[[1,5,19,20],[2,4,7,23],[3,5,1,33],[4,5,12,58],[5,6,2,37],[6,6,11,11],[7,7,4,58],[8,7,19,28],[9,8,9,44],[10,8,0,33],[11,7,10,22],[12,7,11,16]],
1989:[[1,6,1,11],[2,4,13,14],[3,6,7,24],[4,5,18,49],[5,6,8,28],[6,6,17,2],[7,7,10,49],[8,8,1,19],[9,8,15,35],[10,8,6,24],[11,7,16,13],[12,7,17,7]],
1990:[[1,6,7,1],[2,4,19,4],[3,6,13,14],[4,6,0,39],[5,6,14,18],[6,6,22,52],[7,7,16,39],[8,8,7,9],[9,7,21,25],[10,8,12,14],[11,7,22,3],[12,7,22,57]],
1991:[[1,6,12,51],[2,5,1,0],[3,6,19,2],[4,6,6,27],[5,6,20,6],[6,7,4,40],[7,7,22,27],[8,8,12,57],[9,8,3,13],[10,8,18,2],[11,8,3,51],[12,8,4,45]],
1992:[[1,5,18,40],[2,4,6,43],[3,5,0,53],[4,5,12,18],[5,6,1,57],[6,6,10,31],[7,7,4,18],[8,7,18,48],[9,8,9,4],[10,7,23,53],[11,7,9,42],[12,7,10,36]],
1993:[[1,6,0,30],[2,4,12,33],[3,6,6,43],[4,5,18,8],[5,6,7,47],[6,6,16,21],[7,7,10,8],[8,8,0,38],[9,8,14,54],[10,8,5,43],[11,7,15,32],[12,7,16,26]],
1994:[[1,6,6,20],[2,4,18,23],[3,6,12,33],[4,5,23,58],[5,6,13,37],[6,6,22,11],[7,7,15,58],[8,8,6,28],[9,7,20,44],[10,8,11,33],[11,7,21,22],[12,7,22,16]],
1995:[[1,6,12,10],[2,5,0,13],[3,6,18,23],[4,6,5,48],[5,6,19,27],[6,7,4,1],[7,7,21,48],[8,8,12,18],[9,8,2,34],[10,8,17,23],[11,8,3,12],[12,8,4,6]],
1996:[[1,5,18,0],[2,4,6,3],[3,5,0,13],[4,5,11,38],[5,6,1,17],[6,6,9,51],[7,7,3,38],[8,7,18,8],[9,8,8,24],[10,7,23,13],[11,7,9,2],[12,7,9,56]],
1997:[[1,5,23,50],[2,4,11,53],[3,6,6,3],[4,5,17,28],[5,6,7,7],[6,6,15,41],[7,7,9,28],[8,7,23,58],[9,8,14,14],[10,8,5,3],[11,7,14,52],[12,7,15,46]],
1998:[[1,6,5,40],[2,4,17,43],[3,6,11,53],[4,5,23,18],[5,6,12,57],[6,6,21,31],[7,7,15,18],[8,8,5,48],[9,7,20,4],[10,8,10,53],[11,7,20,42],[12,7,21,36]],
1999:[[1,6,11,30],[2,4,23,33],[3,6,17,43],[4,6,5,8],[5,6,18,47],[6,7,3,21],[7,7,21,8],[8,8,11,38],[9,8,1,54],[10,8,16,43],[11,8,2,32],[12,8,3,26]],
2000:[[1,6,17,20],[2,4,5,30],[3,5,23,35],[4,5,11,0],[5,6,0,39],[6,6,9,13],[7,7,3,0],[8,7,17,30],[9,8,7,46],[10,7,22,35],[11,7,8,24],[12,7,9,18]],
2001:[[1,5,23,10],[2,4,11,13],[3,6,5,23],[4,5,16,48],[5,6,6,27],[6,6,15,1],[7,7,8,48],[8,7,23,18],[9,8,13,34],[10,8,4,23],[11,7,14,12],[12,7,15,6]],
2002:[[1,6,5,0],[2,4,17,3],[3,6,11,13],[4,5,22,38],[5,6,12,17],[6,6,20,51],[7,7,14,38],[8,8,5,8],[9,7,19,24],[10,8,10,13],[11,7,20,2],[12,7,20,56]],
2003:[[1,6,10,50],[2,4,22,59],[3,6,17,0],[4,6,4,25],[5,6,18,4],[6,7,2,38],[7,7,20,25],[8,8,10,55],[9,8,1,11],[10,8,16,0],[11,8,1,49],[12,8,2,43]],
2004:[[1,5,16,39],[2,4,4,42],[3,4,22,52],[4,4,10,17],[5,5,23,56],[6,5,8,30],[7,6,2,17],[8,6,16,47],[9,7,7,3],[10,7,21,52],[11,6,7,41],[12,6,8,35]],
2005:[[1,5,22,29],[2,4,10,32],[3,5,4,42],[4,4,15,7],[5,5,4,46],[6,5,13,20],[7,6,7,7],[8,6,21,37],[9,7,11,53],[10,7,2,42],[11,6,12,31],[12,6,13,25]],
2006:[[1,5,4,19],[2,3,16,22],[3,5,10,32],[4,4,21,57],[5,5,11,36],[6,5,20,10],[7,6,13,57],[8,6,4,27],[9,6,18,43],[10,7,9,32],[11,6,19,21],[12,6,20,15]],
2007:[[1,5,10,9],[2,3,22,15],[3,5,16,7],[4,4,3,32],[5,5,17,11],[6,5,1,45],[7,6,19,32],[8,6,10,2],[9,6,0,18],[10,7,15,7],[11,6,0,56],[12,6,1,50]],
2008:[[1,5,15,59],[2,4,4,2],[3,4,22,12],[4,4,9,37],[5,4,23,16],[6,5,7,50],[7,6,1,37],[8,6,16,7],[9,6,6,23],[10,7,21,12],[11,6,7,1],[12,6,7,55]],
2009:[[1,5,21,49],[2,3,9,59],[3,5,4,1],[4,4,15,26],[5,5,5,5],[6,5,13,39],[7,6,7,26],[8,6,21,56],[9,6,12,12],[10,7,3,1],[11,6,12,50],[12,6,13,44]],
2010:[[1,5,3,39],[2,3,15,48],[3,5,10,0],[4,4,21,25],[5,5,11,4],[6,5,19,38],[7,6,13,25],[8,6,3,55],[9,5,18,11],[10,7,9,0],[11,6,18,49],[12,6,19,43]],
2011:[[1,5,21,58],[2,3,22,2],[3,5,16,17],[4,5,3,34],[5,5,17,10],[6,6,1,38],[7,6,19,31],[8,6,22,0],[9,6,12,19],[10,7,15,17],[11,7,1,6],[12,7,1,55]],
2012:[[1,6,4,6],[2,4,4,10],[3,4,22,27],[4,4,9,47],[5,4,23,26],[6,5,7,56],[7,6,1,50],[8,6,4,17],[9,5,18,34],[10,6,21,30],[11,6,7,17],[12,6,8,4]],
2013:[[1,5,10,15],[2,3,10,20],[3,5,4,40],[4,4,16,3],[5,5,5,44],[6,5,14,14],[7,6,8,4],[8,6,10,28],[9,6,0,42],[10,7,3,36],[11,6,13,23],[12,6,14,12]],
2014:[[1,5,16,24],[2,3,16,28],[3,5,10,46],[4,4,22,6],[5,5,11,45],[6,5,20,12],[7,6,14,3],[8,6,16,28],[9,6,6,44],[10,7,9,42],[11,6,19,33],[12,6,20,24]],
2015:[[1,5,22,38],[2,3,22,41],[3,5,16,57],[4,5,4,17],[5,5,17,56],[6,6,2,26],[7,6,20,19],[8,6,22,46],[9,6,13,1],[10,7,15,57],[11,7,1,44],[12,7,2,32]],
2016:[[1,6,4,43],[2,4,4,46],[3,4,23,3],[4,4,10,23],[5,5,0,4],[6,5,8,35],[7,6,2,29],[8,6,4,57],[9,5,19,11],[10,6,22,5],[11,6,7,50],[12,6,8,37]],
2017:[[1,5,10,48],[2,3,10,51],[3,5,5,10],[4,4,16,31],[5,5,6,11],[6,5,14,42],[7,6,8,34],[8,6,11,1],[9,6,1,16],[10,7,4,11],[11,6,13,58],[12,6,14,46]],
2018:[[1,5,16,59],[2,3,17,4],[3,5,11,23],[4,4,22,45],[5,5,12,24],[6,5,20,54],[7,6,14,45],[8,6,17,12],[9,6,7,28],[10,7,10,24],[11,6,20,11],[12,6,20,58]],
2019:[[1,5,23,7],[2,3,23,9],[3,5,17,24],[4,5,4,43],[5,5,18,22],[6,6,2,51],[7,6,20,44],[8,6,23,14],[9,6,13,34],[10,7,16,33],[11,7,2,23],[12,7,3,9]],
2020:[[1,6,5,17],[2,4,5,16],[3,4,23,30],[4,4,10,50],[5,5,0,30],[6,5,9,3],[7,6,2,58],[8,6,5,27],[9,5,19,45],[10,6,22,43],[11,6,8,32],[12,6,9,21]],
2021:[[1,5,11,31],[2,3,11,32],[3,5,5,48],[4,4,17,7],[5,5,6,48],[6,5,15,19],[7,6,9,12],[8,6,11,38],[9,6,1,53],[10,7,4,49],[11,6,14,38],[12,6,15,29]],
2022:[[1,5,17,42],[2,3,17,45],[3,5,11,59],[4,4,23,14],[5,5,12,48],[6,5,21,15],[7,6,15,6],[8,6,17,34],[9,6,7,53],[10,7,10,53],[11,6,20,45],[12,6,21,39]],
2023:[[1,5,23,54],[2,3,23,58],[3,5,18,13],[4,5,5,29],[5,5,19,3],[6,6,3,30],[7,6,21,22],[8,6,23,51],[9,6,14,10],[10,7,17,9],[11,7,2,58],[12,7,3,48]],
2024:[[1,6,6,0],[2,4,6,4],[3,5,0,22],[4,4,11,41],[5,5,1,18],[6,5,9,45],[7,6,3,35],[8,6,6,2],[9,5,20,19],[10,6,23,16],[11,6,9,5],[12,6,9,54]],
2025:[[1,5,12,5],[2,3,12,10],[3,5,6,28],[4,4,17,50],[5,5,7,28],[6,5,15,55],[7,6,9,43],[8,6,12,6],[9,6,2,21],[10,7,5,19],[11,6,15,11],[12,6,16,3]],
2026:[[1,5,18,18],[2,3,18,23],[3,5,12,42],[4,5,0,3],[5,5,13,42],[6,5,22,10],[7,6,15,58],[8,6,18,21],[9,6,8,35],[10,7,11,31],[11,6,21,22],[12,6,22,13]],
2027:[[1,6,0,26],[2,4,0,29],[3,5,18,45],[4,5,6,4],[5,5,19,42],[6,6,4,10],[7,6,22,2],[8,7,0,28],[9,6,14,44],[10,7,17,40],[11,7,3,30],[12,7,4,19]],
2028:[[1,6,6,32],[2,4,6,35],[3,5,0,52],[4,4,12,11],[5,5,1,51],[6,5,10,23],[7,6,4,17],[8,6,6,44],[9,5,20,59],[10,6,23,53],[11,6,9,39],[12,6,10,27]],
2029:[[1,5,12,40],[2,3,12,46],[3,5,7,5],[4,4,18,28],[5,5,8,8],[6,5,16,39],[7,6,10,31],[8,6,12,57],[9,6,3,11],[10,7,6,4],[11,6,15,50],[12,6,16,37]],
2030:[[1,5,18,49],[2,3,18,54],[3,5,13,12],[4,5,0,31],[5,5,14,7],[6,5,22,34],[7,6,16,25],[8,6,18,53],[9,6,9,11],[10,7,12,11],[11,6,22,0],[12,6,22,49]],
2031:[[1,6,1,0],[2,4,1,2],[3,5,19,19],[4,5,6,38],[5,5,20,16],[6,6,4,45],[7,6,22,38],[8,7,1,8],[9,6,15,28],[10,7,18,28],[11,7,4,17],[12,7,5,4]],
2032:[[1,6,7,12],[2,4,7,12],[3,5,1,26],[4,4,12,46],[5,5,2,26],[6,5,10,57],[7,6,4,50],[8,6,7,18],[9,5,21,36],[10,7,0,34],[11,6,10,24],[12,6,11,12]],
2033:[[1,5,13,22],[2,3,13,22],[3,5,7,37],[4,4,18,55],[5,5,8,33],[6,5,17,1],[7,6,10,53],[8,6,13,19],[9,6,3,36],[10,7,6,35],[11,6,16,28],[12,6,17,21]],
2034:[[1,5,19,36],[2,3,19,39],[3,5,13,55],[4,5,1,11],[5,5,14,46],[6,5,23,13],[7,6,17,4],[8,6,19,31],[9,6,9,49],[10,7,12,47],[11,6,22,39],[12,6,23,31]],
2035:[[1,6,1,44],[2,4,1,47],[3,5,20,2],[4,5,7,17],[5,5,20,50],[6,6,5,16],[7,6,23,7],[8,7,1,36],[9,6,15,55],[10,7,18,56],[11,7,4,47],[12,7,5,37]],
2036:[[1,6,7,50],[2,4,7,53],[3,5,2,10],[4,4,13,27],[5,5,3,3],[6,5,11,31],[7,6,5,22],[8,6,7,48],[9,5,22,6],[10,7,1,5],[11,6,10,55],[12,6,11,45]],
2037:[[1,5,13,58],[2,3,14,3],[3,5,8,22],[4,4,19,44],[5,5,9,23],[6,5,17,50],[7,6,11,39],[8,6,14,3],[9,6,4,17],[10,7,7,14],[11,6,17,4],[12,6,17,56]],
2038:[[1,5,20,10],[2,3,20,14],[3,5,14,31],[4,5,1,49],[5,5,15,24],[6,5,23,49],[7,6,17,37],[8,6,20,1],[9,6,10,17],[10,7,13,17],[11,6,23,10],[12,7,0,4]],
2039:[[1,6,2,19],[2,4,2,23],[3,5,20,38],[4,5,7,55],[5,5,21,32],[6,6,6,0],[7,6,23,51],[8,7,2,19],[9,6,16,35],[10,7,19,33],[11,7,5,22],[12,7,6,13]],
2040:[[1,6,8,26],[2,4,8,30],[3,5,2,47],[4,4,14,6],[5,5,3,45],[6,5,12,14],[7,6,6,7],[8,6,8,33],[9,5,22,49],[10,7,1,43],[11,6,11,30],[12,6,12,19]],
2041:[[1,5,14,31],[2,3,14,37],[3,5,8,55],[4,4,20,15],[5,5,9,52],[6,5,18,19],[7,6,12,9],[8,6,14,34],[9,6,4,49],[10,7,7,46],[11,6,17,35],[12,6,18,26]],
2042:[[1,5,20,40],[2,3,20,46],[3,5,15,5],[4,5,2,25],[5,5,16,3],[6,6,0,30],[7,6,18,20],[8,6,20,47],[9,6,11,4],[10,7,14,2],[11,6,23,52],[12,7,0,41]],
2043:[[1,6,2,52],[2,4,2,54],[3,5,21,9],[4,5,8,28],[5,5,22,5],[6,6,6,33],[7,7,0,25],[8,7,2,53],[9,6,17,12],[10,7,20,12],[11,7,6,3],[12,7,6,52]],
2044:[[1,6,9,1],[2,4,9,1],[3,5,3,15],[4,4,14,33],[5,5,4,12],[6,5,12,42],[7,6,6,36],[8,6,9,3],[9,5,23,21],[10,7,2,20],[11,6,12,11],[12,6,13,1]],
2045:[[1,5,15,13],[2,3,15,15],[3,5,9,31],[4,4,20,50],[5,5,10,29],[6,5,18,59],[7,6,12,51],[8,6,15,18],[9,6,5,34],[10,7,8,30],[11,6,18,21],[12,6,19,13]],
2046:[[1,5,21,28],[2,3,21,32],[3,5,15,46],[4,5,3,0],[5,5,16,32],[6,6,0,57],[7,6,18,47],[8,6,21,14],[9,6,11,33],[10,7,14,34],[11,7,0,27],[12,7,1,20]],
2047:[[1,6,3,35],[2,4,3,40],[3,5,21,54],[4,5,9,9],[5,5,22,42],[6,6,7,7],[7,7,0,59],[8,7,3,28],[9,6,17,49],[10,7,20,50],[11,7,6,41],[12,7,7,31]],
2048:[[1,6,9,43],[2,4,9,47],[3,5,4,4],[4,4,15,23],[5,5,4,59],[6,5,13,26],[7,6,7,17],[8,6,9,43],[9,6,0,1],[10,7,3,0],[11,6,12,51],[12,6,13,40]],
2049:[[1,5,15,52],[2,3,15,55],[3,5,10,13],[4,4,21,32],[5,5,11,8],[6,5,19,32],[7,6,13,19],[8,6,15,42],[9,6,5,58],[10,7,8,57],[11,6,18,51],[12,6,19,45]],
2050:[[1,5,22,0],[2,3,22,5],[3,5,16,22],[4,5,3,40],[5,5,17,17],[6,6,1,43],[7,6,19,32],[8,6,21,57],[9,6,12,12],[10,7,15,12],[11,7,1,5],[12,7,1,59]],
2051:[[1,6,4,12],[2,4,4,15],[3,5,22,29],[4,5,9,45],[5,5,23,21],[6,6,7,48],[7,7,1,39],[8,7,4,6],[9,6,18,23],[10,7,21,21],[11,7,7,12],[12,7,8,3]],
2052:[[1,6,10,17],[2,4,10,20],[3,5,4,35],[4,4,15,51],[5,5,5,27],[6,5,13,56],[7,6,7,48],[8,6,10,15],[9,6,0,31],[10,7,3,28],[11,6,13,17],[12,6,14,8]],
2053:[[1,5,16,22],[2,3,16,28],[3,5,10,46],[4,4,22,7],[5,5,11,44],[6,5,20,13],[7,6,14,4],[8,6,16,30],[9,6,6,46],[10,7,9,43],[11,6,19,32],[12,6,20,22]],
2054:[[1,5,22,35],[2,3,22,40],[3,5,16,57],[4,5,4,13],[5,5,17,47],[6,6,2,11],[7,6,20,0],[8,6,22,27],[9,6,12,46],[10,7,15,47],[11,7,1,40],[12,7,2,31]],
2055:[[1,6,4,43],[2,4,4,46],[3,5,23,0],[4,5,10,17],[5,5,23,52],[6,6,8,19],[7,7,2,10],[8,7,4,39],[9,6,19,0],[10,7,22,2],[11,7,7,54],[12,7,8,44]],
2056:[[1,6,10,55],[2,4,10,56],[3,5,5,10],[4,4,16,28],[5,5,6,6],[6,5,14,35],[7,6,8,27],[8,6,10,55],[9,6,1,13],[10,7,4,12],[11,6,14,4],[12,6,14,56]],
2057:[[1,5,17,8],[2,3,17,10],[3,5,11,24],[4,4,22,40],[5,5,12,14],[6,5,20,39],[7,6,14,28],[8,6,16,53],[9,6,7,9],[10,7,10,9],[11,6,20,3],[12,6,20,59]],
2058:[[1,5,23,16],[2,3,23,22],[3,5,17,37],[4,5,4,52],[5,5,18,25],[6,6,2,49],[7,6,20,38],[8,6,23,5],[9,6,13,24],[10,7,16,25],[11,7,2,18],[12,7,3,12]],
2059:[[1,6,5,28],[2,4,5,32],[3,5,23,47],[4,5,11,2],[5,6,0,35],[6,6,8,59],[7,7,2,48],[8,7,5,16],[9,6,19,36],[10,7,22,36],[11,7,8,28],[12,7,9,20]],
2060:[[1,6,11,33],[2,4,11,37],[3,5,5,54],[4,4,17,11],[5,5,6,46],[6,5,15,11],[7,6,8,59],[8,6,11,24],[9,6,1,41],[10,7,4,41],[11,6,14,33],[12,6,15,25]],
2061:[[1,5,17,40],[2,3,17,45],[3,5,12,4],[4,4,23,24],[5,5,13,2],[6,5,21,29],[7,6,15,18],[8,6,17,41],[9,6,7,56],[10,7,10,55],[11,6,20,47],[12,6,21,40]],
2062:[[1,5,23,55],[2,4,0,0],[3,5,18,16],[4,5,5,32],[5,5,19,6],[6,6,3,30],[7,6,21,18],[8,6,23,41],[9,6,13,58],[10,7,16,58],[11,7,2,52],[12,7,3,47]],
2063:[[1,6,6,2],[2,4,6,6],[3,6,0,21],[4,5,11,36],[5,6,1,10],[6,6,9,37],[7,7,3,28],[8,7,5,55],[9,6,20,13],[10,7,23,12],[11,7,9,3],[12,7,9,55]],
2064:[[1,6,12,8],[2,4,12,12],[3,5,6,28],[4,4,17,46],[5,5,7,23],[6,5,15,53],[7,6,9,45],[8,6,12,13],[9,6,2,29],[10,7,5,26],[11,6,15,15],[12,6,16,5]],
2065:[[1,5,18,17],[2,3,18,22],[3,5,12,40],[4,4,23,58],[5,5,13,32],[6,5,21,57],[7,6,15,45],[8,6,18,10],[9,6,8,27],[10,7,11,26],[11,6,21,17],[12,6,22,9]],
2066:[[1,6,0,24],[2,4,0,29],[3,5,18,46],[4,5,6,3],[5,5,19,38],[6,6,4,3],[7,6,21,52],[8,7,0,19],[9,6,14,39],[10,7,17,41],[11,7,3,34],[12,7,4,25]],
2067:[[1,6,6,36],[2,4,6,37],[3,6,0,50],[4,5,12,7],[5,6,1,42],[6,6,10,9],[7,7,4,0],[8,7,6,29],[9,6,20,50],[10,7,23,52],[11,7,9,45],[12,7,10,37]],
2068:[[1,6,12,48],[2,4,12,48],[3,5,7,0],[4,4,18,15],[5,5,7,50],[6,5,16,18],[7,6,10,9],[8,6,12,35],[9,6,2,52],[10,7,5,53],[11,6,15,47],[12,6,16,41]],
2069:[[1,5,18,56],[2,3,18,59],[3,5,13,13],[4,5,0,29],[5,5,14,4],[6,5,22,31],[7,6,16,22],[8,6,18,49],[9,6,9,6],[10,7,12,6],[11,6,22,0],[12,6,22,56]],
2070:[[1,6,1,13],[2,4,1,18],[3,5,19,31],[4,5,6,43],[5,5,20,13],[6,6,4,34],[7,6,22,22],[8,7,0,49],[9,6,15,9],[10,7,18,11],[11,7,4,6],[12,7,5,2]],
2071:[[1,6,7,19],[2,4,7,24],[3,6,1,39],[4,5,12,52],[5,6,2,22],[6,6,10,43],[7,7,4,32],[8,7,7,0],[9,6,21,20],[10,8,0,23],[11,7,10,17],[12,7,11,9]],
2072:[[1,6,13,24],[2,4,13,28],[3,5,7,45],[4,4,19,4],[5,5,8,39],[6,5,17,4],[7,6,10,53],[8,6,13,19],[9,6,3,36],[10,7,6,37],[11,6,16,30],[12,6,17,23]],
2073:[[1,5,19,36],[2,3,19,41],[3,5,13,59],[4,5,1,17],[5,5,14,51],[6,5,23,13],[7,6,16,58],[8,6,19,19],[9,6,9,34],[10,7,12,33],[11,6,22,28],[12,6,23,25]],
2074:[[1,6,1,42],[2,4,1,48],[3,5,20,5],[4,5,7,22],[5,5,20,56],[6,6,5,20],[7,6,23,7],[8,7,1,31],[9,6,15,47],[10,7,18,48],[11,7,4,42],[12,7,5,37]],
2075:[[1,6,7,53],[2,4,7,56],[3,6,2,11],[4,5,13,27],[5,6,3,2],[6,6,11,29],[7,7,5,20],[8,7,7,46],[9,6,22,4],[10,8,1,2],[11,7,10,54],[12,7,11,46]],
2076:[[1,6,14,0],[2,4,14,5],[3,5,8,20],[4,4,19,36],[5,5,9,11],[6,5,17,37],[7,6,11,28],[8,6,13,53],[9,6,4,9],[10,7,7,6],[11,6,16,56],[12,6,17,48]],
2077:[[1,5,20,2],[2,3,20,8],[3,5,14,27],[4,5,1,46],[5,5,15,22],[6,5,23,49],[7,6,17,40],[8,6,20,7],[9,6,10,24],[10,7,13,23],[11,6,23,14],[12,7,0,5]],
2078:[[1,6,2,19],[2,4,2,23],[3,5,20,39],[4,5,7,55],[5,5,21,28],[6,6,5,51],[7,6,23,40],[8,7,2,7],[9,6,16,28],[10,7,19,30],[11,7,5,25],[12,7,6,17]],
2079:[[1,6,8,29],[2,4,8,30],[3,6,2,43],[4,5,13,58],[5,6,3,31],[6,6,11,56],[7,7,5,46],[8,7,8,15],[9,6,22,36],[10,8,1,40],[11,7,11,34],[12,7,12,26]],
2080:[[1,6,14,37],[2,4,14,37],[3,5,8,50],[4,4,20,6],[5,5,9,43],[6,5,18,11],[7,6,12,4],[8,6,14,32],[9,6,4,52],[10,7,7,54],[11,6,17,48],[12,6,18,42]],
2081:[[1,5,20,55],[2,3,20,57],[3,5,15,10],[4,5,2,23],[5,5,15,55],[6,6,0,17],[7,6,18,5],[8,6,20,30],[9,6,10,48],[10,7,13,49],[11,6,23,45],[12,7,0,42]],
2082:[[1,6,3,0],[2,4,3,5],[3,5,21,19],[4,5,8,32],[5,5,22,1],[6,6,6,22],[7,7,0,10],[8,7,2,37],[9,6,16,58],[10,7,20,2],[11,7,5,58],[12,7,6,54]],
2083:[[1,6,9,10],[2,4,9,14],[3,6,3,28],[4,5,14,41],[5,6,4,12],[6,6,12,35],[7,7,6,24],[8,7,8,52],[9,6,23,13],[10,8,2,16],[11,7,12,11],[12,7,13,5]],
2084:[[1,6,15,19],[2,4,15,23],[3,5,9,38],[4,4,20,53],[5,5,10,25],[6,5,18,47],[7,6,12,34],[8,6,14,57],[9,6,5,14],[10,7,8,15],[11,6,18,10],[12,6,19,5]],
2085:[[1,5,21,22],[2,3,21,27],[3,5,15,45],[4,5,3,3],[5,5,16,37],[6,6,1,1],[7,6,18,48],[8,6,21,12],[9,6,11,28],[10,7,14,29],[11,7,0,25],[12,7,1,21]],
2086:[[1,6,3,39],[2,4,3,44],[3,5,21,58],[4,5,9,12],[5,5,22,44],[6,6,7,6],[7,7,0,53],[8,7,3,17],[9,6,17,34],[10,7,20,36],[11,7,6,32],[12,7,7,29]],
2087:[[1,6,9,46],[2,4,9,51],[3,6,4,5],[4,5,15,18],[5,6,4,49],[6,6,13,12],[7,7,7,1],[8,7,9,27],[9,6,23,45],[10,8,2,45],[11,7,12,39],[12,7,13,32]],
2088:[[1,6,15,48],[2,4,15,53],[3,5,10,9],[4,4,21,26],[5,5,11,1],[6,5,19,27],[7,6,13,18],[8,6,15,46],[9,6,6,4],[10,7,9,3],[11,6,18,54],[12,6,19,47]],
2089:[[1,5,22,1],[2,3,22,7],[3,5,16,25],[4,5,3,42],[5,5,17,14],[6,6,1,36],[7,6,19,22],[8,6,21,46],[9,6,12,3],[10,7,15,3],[11,7,0,56],[12,7,1,51]],
2090:[[1,6,4,6],[2,4,4,12],[3,5,22,29],[4,5,9,45],[5,5,23,17],[6,6,7,39],[7,7,1,26],[8,7,3,52],[9,6,18,12],[10,7,21,16],[11,7,7,12],[12,7,8,5]],
2091:[[1,6,10,18],[2,4,10,19],[3,6,4,32],[4,5,15,48],[5,6,5,23],[6,6,13,49],[7,7,7,39],[8,7,10,8],[9,7,0,29],[10,8,3,32],[11,7,13,28],[12,7,14,21]],
2092:[[1,6,16,33],[2,4,16,34],[3,5,10,46],[4,4,22,0],[5,5,11,34],[6,5,19,59],[7,6,13,49],[8,6,16,13],[9,6,6,31],[10,7,9,31],[11,6,19,26],[12,6,20,22]],
2093:[[1,5,22,38],[2,3,22,42],[3,5,16,57],[4,5,4,11],[5,5,17,44],[6,6,2,8],[7,6,19,58],[8,6,22,25],[9,6,12,43],[10,7,15,45],[11,7,1,40],[12,7,2,37]],
2094:[[1,6,4,56],[2,4,5,0],[3,5,23,13],[4,5,10,24],[5,5,23,53],[6,6,8,14],[7,7,2,2],[8,7,4,29],[9,6,18,50],[10,7,21,54],[11,7,7,51],[12,7,8,47]],
2095:[[1,6,11,4],[2,4,11,9],[3,6,5,23],[4,5,16,35],[5,6,6,3],[6,6,14,23],[7,7,8,10],[8,7,10,37],[9,7,0,58],[10,8,4,2],[11,7,13,57],[12,7,14,51]],
2096:[[1,6,17,6],[2,4,17,10],[3,5,11,26],[4,4,22,42],[5,5,12,16],[6,5,20,40],[7,6,14,28],[8,6,16,54],[9,6,7,14],[10,7,10,17],[11,6,20,12],[12,6,21,7]],
2097:[[1,5,23,22],[2,3,23,26],[3,5,17,42],[4,5,4,58],[5,5,18,30],[6,6,2,51],[7,6,20,35],[8,6,22,57],[9,6,13,13],[10,7,16,14],[11,7,2,12],[12,7,3,10]],
2098:[[1,6,5,29],[2,4,5,35],[3,5,23,49],[4,5,11,3],[5,6,0,33],[6,6,8,54],[7,7,2,40],[8,7,5,3],[9,6,19,21],[10,7,22,24],[11,7,8,21],[12,7,9,17]],
2099:[[1,6,11,34],[2,4,11,38],[3,6,5,51],[4,5,17,5],[5,6,6,37],[6,6,15,2],[7,7,8,53],[8,7,11,20],[9,7,1,39],[10,8,4,41],[11,7,14,35],[12,7,15,30]],
2100:[[1,6,17,45],[2,4,17,50],[3,6,12,5],[4,5,23,19],[5,6,12,51],[6,6,21,15],[7,7,15,3],[8,7,17,28],[9,7,7,44],[10,8,10,43],[11,7,20,35],[12,7,21,29]],
};

const JEOLGI_JJ_MAP = [1,2,3,4,5,6,7,8,9,10,11,0];
const MONTH_CG_BASE = [2,4,6,8,0];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì‚¬ì£¼ ê³„ì‚° ì—”ì§„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CG   = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
const JJ   = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
const CGKR = ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
const JJKR = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];

function jdn(y, m, d) {
  const a = Math.floor((14 - m) / 12);
  const Y = y + 4800 - a;
  const M = m + 12 * a - 3;
  return d + Math.floor((153*M+2)/5) + 365*Y + Math.floor(Y/4) - Math.floor(Y/100) + Math.floor(Y/400) - 32045;
}

function getYearPillar(y, m, d, h) {
  let saju_year = y;
  const jData = JEOLGI[y];
  if (jData) {
    const [ibm, ibd, ibh] = jData[1];
    if (m < ibm || (m === ibm && d < ibd) || (m === ibm && d === ibd && h < ibh)) {
      saju_year = y - 1;
    }
  } else {
    if (m < 2 || (m === 2 && d < 4)) saju_year = y - 1;
  }
  return { cg: ((saju_year - 4) % 10 + 10) % 10, jj: ((saju_year - 4) % 12 + 12) % 12 };
}

function getMonthPillar(yearCg, y, m, d, h) {
  const jData = JEOLGI[y];
  let jeolgiIdx = -1;
  if (jData) {
    for (let i = jData.length - 1; i >= 0; i--) {
      const [jm, jd, jh] = jData[i];
      if (m > jm || (m === jm && d > jd) || (m === jm && d === jd && h >= jh)) {
        jeolgiIdx = i; break;
      }
    }
  }
  if (jeolgiIdx === -1) jeolgiIdx = 11;
  const mJj = JEOLGI_JJ_MAP[jeolgiIdx];
  const mOrder = (mJj + 10) % 12;
  const mCg = (MONTH_CG_BASE[yearCg % 5] + mOrder) % 10;
  return { cg: mCg, jj: mJj };
}

function getDayPillar(y, m, d, hour, jasiMode) {
  let calcY = y, calcM = m, calcD = d;
  if (jasiMode === 'ya' && hour === 23) {
    const dt = new Date(y, m-1, d+1);
    calcY = dt.getFullYear(); calcM = dt.getMonth()+1; calcD = dt.getDate();
  }
  const j = jdn(calcY, calcM, calcD);
  const idx60 = ((j % 60 + 49) % 60 + 60) % 60;
  return { cg: idx60 % 10, jj: idx60 % 12 };
}

function getHourJjFromMin(totalMin, corrMin) {
  let m = totalMin + corrMin;
  if (m < 0) m += 24 * 60;
  if (m >= 24 * 60) m -= 24 * 60;
  if (m >= 23*60 || m < 60)  return 0;
  if (m < 3*60)   return 1;
  if (m < 5*60)   return 2;
  if (m < 7*60)   return 3;
  if (m < 9*60)   return 4;
  if (m < 11*60)  return 5;
  if (m < 13*60)  return 6;
  if (m < 15*60)  return 7;
  if (m < 17*60)  return 8;
  if (m < 19*60)  return 9;
  if (m < 21*60)  return 10;
  return 11;
}

function getHourPillar(dayCg, hour, min, corrMin) {
  const hJj = getHourJjFromMin(hour * 60 + (min || 0), corrMin || 0);
  const hCg = ([0,2,4,6,8][dayCg % 5] + hJj) % 10;
  return { cg: hCg, jj: hJj };
}

function applyKSTCorrection(year, month, day, hour, min) {
  let h = hour, m = min || 0;
  const isUTC830 = (year === 1954 && (month > 3 || (month === 3 && day >= 21))) ||
    (year > 1954 && year < 1961) ||
    (year === 1961 && (month < 8 || (month === 8 && day <= 9)));
  if (isUTC830) { m += 30; if (m >= 60) { h++; m -= 60; } if (h >= 24) h -= 24; }
  return { hour: h, min: m };
}

// ë„í™”ì‚´ í…Œì´ë¸”
const DOHWA_JJI = { 8:9,0:9,4:9, 2:3,6:3,10:3, 11:0,3:0,7:0, 5:6,9:6,1:6 };
function getDohwaJji(jjIdx) { return DOHWA_JJI[jjIdx]; }

// í™ì—¼ì‚´
const HONGYEOM = { 0:6,1:8,2:2,3:7,4:4,5:4,6:10,7:9,8:0,9:8 };

// ì‹­ì„±
const OHENG_CG = ['æœ¨','æœ¨','ç«','ç«','åœŸ','åœŸ','é‡‘','é‡‘','æ°´','æ°´'];
const OHENG_JJ = ['æ°´','åœŸ','æœ¨','æœ¨','åœŸ','ç«','ç«','åœŸ','é‡‘','é‡‘','åœŸ','æ°´'];
const YY_CG = [1,0,1,0,1,0,1,0,1,0];
const YY_JJ = [0,0,1,0,1,1,1,0,1,0,1,0];
const SENG_TO = {'æœ¨':'ç«','ç«':'åœŸ','åœŸ':'é‡‘','é‡‘':'æ°´','æ°´':'æœ¨'};
const KYEK_TO = {'æœ¨':'åœŸ','ç«':'é‡‘','åœŸ':'æ°´','é‡‘':'æœ¨','æ°´':'ç«'};
const SIBSUNG_COLOR = {
  'ë¹„ê²¬':'#60a5fa','ê²ì¬':'#3b82f6','ì‹ì‹ ':'#34d399','ìƒê´€':'#10b981',
  'í¸ì¬':'#fbbf24','ì •ì¬':'#f59e0b','í¸ê´€':'#f87171','ì •ê´€':'#ef4444',
  'í¸ì¸':'#c084fc','ì •ì¸':'#a855f7',
};

function getSibsung(ilganIdx, targetOhe, targetYY) {
  const myOhe = OHENG_CG[ilganIdx], myYY = YY_CG[ilganIdx];
  const sameYY = (targetYY === myYY);
  if (targetOhe === myOhe) return sameYY ? 'ë¹„ê²¬' : 'ê²ì¬';
  if (SENG_TO[targetOhe] === myOhe) return sameYY ? 'í¸ì¸' : 'ì •ì¸';
  if (SENG_TO[myOhe] === targetOhe) return sameYY ? 'ìƒê´€' : 'ì‹ì‹ ';
  if (KYEK_TO[myOhe] === targetOhe) return sameYY ? 'í¸ì¬' : 'ì •ì¬';
  if (KYEK_TO[targetOhe] === myOhe) return sameYY ? 'í¸ê´€' : 'ì •ê´€';
  return '';
}
function getSibsungByCg(ilganIdx, cgIdx) { return getSibsung(ilganIdx, OHENG_CG[cgIdx], YY_CG[cgIdx]); }
function getSibsungByJj(ilganIdx, jjIdx) { return getSibsung(ilganIdx, OHENG_JJ[jjIdx], YY_JJ[jjIdx]); }

// 12ì‹ ì‚´
const SINSAL_NAMES = ['ê²ì‚´','ì¬ì‚´','ì²œì‚´','ì§€ì‚´','ë„í™”ì‚´','ì›”ì‚´','ë§ì‹ ì‚´','ì¥ì„±ì‚´','ë°˜ì•ˆì‚´','ì—­ë§ˆì‚´','ìœ¡í•´ì‚´','í™”ê°œì‚´'];
const SS_SANHAP_LAST = { A:4, B:10, C:1, D:7 };
const SS_SANHAP_GRP  = { A:[8,0,4], B:[2,6,10], C:[5,9,1], D:[11,3,7] };
const SINSAL_INFO = {
  'ê²ì‚´':   { type:'bad',  ico:'âš¡', short:'ê°‘ì‘ìŠ¤ëŸ¬ìš´ ë³€í™”Â·ê°•í•œ ëŒíŒŒë ¥',
    desc:'ê²ì‚´ì€ ì™¸ë¶€ì—ì„œ ê°‘ì‘ìŠ¤ëŸ½ê²Œ ìƒí™©ì´ ë’¤ì§‘íˆëŠ” ì—ë„ˆì§€ì˜ˆìš”. ì˜ˆìƒì¹˜ ëª»í•œ ë³€ìˆ˜ê°€ í„°ì§€ê¸° ì‰½ì§€ë§Œ, ì´ ì—ë„ˆì§€ë¥¼ ì˜ ì“°ë©´ ëˆ„êµ¬ë³´ë‹¤ ê°•í•œ ëŒíŒŒë ¥ê³¼ ì¶”ì§„ë ¥ì´ ë©ë‹ˆë‹¤. ì‚¬ì—…Â·íˆ¬ìí•  ë•Œ ì¶©ë™ì  ê²°ì •ë§Œ ì¡°ì‹¬í•˜ë©´ ì˜¤íˆë ¤ ê°œì²™í˜• ë¦¬ë”ë¡œ ë¹›ë‚  ìˆ˜ ìˆì–´ìš”.' },
  'ì¬ì‚´':   { type:'bad',  ico:'ğŸ”’', short:'ì˜ˆìƒì¹˜ ëª»í•œ ìœ„ê¸°Â·ìœ„ê¸° ëŒ€ì²˜ ëŠ¥ë ¥',
    desc:'ì¬ì‚´ì€ ë²•ì  ë¶„ìŸì´ë‚˜ ê°‘ì‘ìŠ¤ëŸ¬ìš´ ìœ„ê¸°ê°€ ìƒê¸°ê¸° ì‰¬ìš´ ì—ë„ˆì§€ì˜ˆìš”. í•˜ì§€ë§Œ ì´ê±¸ ê°€ì§„ ì‚¬ëŒì€ ìœ„ê¸° ìƒí™©ì—ì„œ ì„ê¸°ì‘ë³€ê³¼ ìˆœë°œë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. ì—­ê²½ì„ ë°œíŒìœ¼ë¡œ ì‚¼ëŠ” í˜ì´ ê°•í•˜ê³ , ë²•Â·ì œë„Â·ìœ„ê¸°ê´€ë¦¬ ë¶„ì•¼ì—ì„œ ëŠ¥ë ¥ì„ ë°œíœ˜í•´ìš”.' },
  'ì²œì‚´':   { type:'warn', ico:'ğŸŒ©ï¸', short:'ë‚´ ì˜ì§€ë¡œ ì•ˆ ë˜ëŠ” ì¼Â·íë¦„ì— ë§¡ê¸°ê¸°',
    desc:'ì²œì‚´ì€ ë‚´ ì˜ì§€ì™€ ìƒê´€ì—†ì´ ì˜ˆì¸¡ ë¶ˆê°€í•œ ìƒí™©ì´ ì°¾ì•„ì˜¤ëŠ” ì—ë„ˆì§€ì˜ˆìš”. ìì—°ì¬í•´Â·ì‚¬ê³ Â·ê°‘ì‘ìŠ¤ëŸ¬ìš´ í™˜ê²½ ë³€í™”ê°€ ë§ì§€ë§Œ, ì´ ê³¼ì •ì—ì„œ ê°•í•œ ì¸ë‚´ì‹¬ê³¼ ë„“ì€ ì‹œì•¼ê°€ ê¸¸ëŸ¬ì§‘ë‹ˆë‹¤. íë¦„ì— ì €í•­í•˜ê¸°ë³´ë‹¤ ë°›ì•„ë“¤ì´ëŠ” ë²•ì„ ìµíˆë©´ ì˜¤íˆë ¤ í¬ê²Œ ì„±ì¥í•´ìš”.' },
  'ì§€ì‚´':   { type:'neut', ico:'ğŸŒ', short:'ì ê·¹ì  í™œë™Â·ë„¤íŠ¸ì›Œí‚¹Â·í™•ì¥',
    desc:'ì§€ì‚´ì€ ìŠ¤ìŠ¤ë¡œ í™œë°œí•˜ê²Œ ì›€ì§ì´ê³  í™œë™ ë°˜ê²½ì„ ë„“íˆëŠ” ì—ë„ˆì§€ì˜ˆìš”. í•œ ê³³ì— ê°€ë§ŒìˆëŠ” ê²Œ ì²´ì§ˆì ìœ¼ë¡œ ì•ˆ ë§ê³ , ì‚¬ëŒê³¼ ê³µê°„ì„ ì—°ê²°í•˜ëŠ” ì—­í• ì—ì„œ íƒì›”í•©ë‹ˆë‹¤. ë§ˆì¼€íŒ…Â·ì˜ì—…Â·ë„¤íŠ¸ì›Œí‚¹Â·ëŒ€ì™¸ í™œë™ì—ì„œ íŠ¹íˆ ë¹›ì„ ë°œí•´ìš”.' },
  'ë„í™”ì‚´': { type:'good', ico:'ğŸŒ¸', short:'ìì—°ìŠ¤ëŸ¬ìš´ ì¸ê¸°Â·ëŒì–´ë‹¹ê¸°ëŠ” ë§¤ë ¥',
    desc:'ë„í™”ì‚´ì€ ê°€ë§Œìˆì–´ë„ ì‚¬ëŒì´ ëª¨ì´ëŠ” íƒ€ê³ ë‚œ ë§¤ë ¥ ì—ë„ˆì§€ì˜ˆìš”. ì´ì„±ì—ê²Œ ìì—°ìŠ¤ëŸ½ê²Œ ì–´í•„ë˜ê³  ëŒ€ì¤‘ì  ì¸ê¸°ë¥¼ ì–»ê¸° ì‰¬ì›Œ ì—°ì˜ˆÂ·ë·°í‹°Â·ì„œë¹„ìŠ¤Â·í¬ë¦¬ì—ì´í„° ë¶„ì•¼ì— ìœ ë¦¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ ì¸ê¸°ê°€ ë§ì€ ë§Œí¼ êµ¬ì„¤ì´ë‚˜ ìŠ¤ìº”ë“¤ì— ë…¸ì¶œë  ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜ê°€ í•„ìš”í•´ìš”.' },
  'ì›”ì‚´':   { type:'bad',  ico:'ğŸ¥€', short:'í˜ë“  ì‹œê¸°Â·ë²„í‹°ë©´ ì—­ì „',
    desc:'ì›”ì‚´ì€ ì•„ë¬´ë¦¬ ë…¸ë ¥í•´ë„ ë§‰íˆëŠ” ëŠë‚Œì´ ë“œëŠ” ì—ë„ˆì§€ì˜ˆìš”. ë‹µë‹µí•˜ê³  ì¢Œì ˆìŠ¤ëŸ¬ìš´ ì‹œê¸°ê°€ ì˜¬ ìˆ˜ ìˆì§€ë§Œ, ë²„í…¨ë‚¸ ì‚¬ëŒì—ê²Œ ëœ»ë°–ì˜ ë°˜ì „ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. ê²°ê³¼ë¥¼ ì„œë‘ë¥´ì§€ ì•Šê³  ê¾¸ì¤€íˆ ê°€ëŠ” ê²ƒì´ ì´ ì—ë„ˆì§€ë¥¼ ì˜ ì“°ëŠ” ë°©ë²•ì´ì—ìš”.' },
  'ë§ì‹ ì‚´': { type:'warn', ico:'ğŸ˜³', short:'ì£¼ëª©ë°›ëŠ” ê¸°ìš´Â·ì–‘ë‚ ì˜ ê²€',
    desc:'ë§ì‹ ì‚´ì€ ë‚´ í–‰ë™ì´ ì™¸ë¶€ë¡œ ë“œëŸ¬ë‚˜ëŠ” ì—ë„ˆì§€ì˜ˆìš”. ì¢‹ì€ ì¼ë„, ë‚˜ìœ ì¼ë„ ë‹¤ ë³´ì´ê²Œ ë©ë‹ˆë‹¤. ìœ íŠœë²„Â·ì¸í”Œë£¨ì–¸ì„œÂ·ì—°ì˜ˆì¸ì²˜ëŸ¼ ëŒ€ì¤‘ ì•ì— ì„œëŠ” ì§ì—…ì´ë¼ë©´ ì˜¤íˆë ¤ ì£¼ëª©ë°›ëŠ” ëª…ì˜ˆë¡œ ì‘ìš©í•˜ì§€ë§Œ, ì‚¬ìƒí™œ ë…¸ì¶œì´ë‚˜ ìŠ¤ìº”ë“¤ì— ì·¨ì•½í•´ì§ˆ ìˆ˜ ìˆì–´ìš”. ë‚´ í–‰ë™ í•˜ë‚˜í•˜ë‚˜ê°€ ê¸°ë¡ëœë‹¤ëŠ” ì¸ì‹ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.' },
  'ì¥ì„±ì‚´': { type:'good', ico:'âš”ï¸', short:'íƒ€ê³ ë‚œ ë¦¬ë”ì‹­Â·ì¡´ì¬ê°',
    desc:'ì¥ì„±ì‚´ì€ ì–´ëŠ ê·¸ë£¹ì—ì„œë“  ìì—°ìŠ¤ëŸ½ê²Œ ì¤‘ì‹¬ì´ ë˜ëŠ” íƒ€ê³ ë‚œ ë¦¬ë”ì‹­ ì—ë„ˆì§€ì˜ˆìš”. ê°•í•œ ì£¼ê´€ê³¼ ì¹´ë¦¬ìŠ¤ë§ˆê°€ íŠ¹ì§•ì´ë©°, íŒ€ ë¦¬ë”Â·ê²½ì˜ìÂ·í¬ë¦¬ì—ì´í„°ì²˜ëŸ¼ ì‚¬ëŒë“¤ì„ ì´ë„ëŠ” ì—­í• ì—ì„œ ë¹›ì„ ë°œí•©ë‹ˆë‹¤. ë‹¤ë§Œ ê³ ì§‘ì´ ê°•í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ìœ ì—°ì„±ì„ í•¨ê»˜ ê¸°ë¥´ë©´ ì¢‹ì•„ìš”.' },
  'ë°˜ì•ˆì‚´': { type:'good', ico:'ğŸª‘', short:'ì°©ì‹¤í•œ ì„±ì¥Â·ì‹¤ë ¥ìœ¼ë¡œ ì˜¬ë¼ê°€ê¸°',
    desc:'ë°˜ì•ˆì‚´ì€ ì°©ì‹¤í•˜ê²Œ ì‹¤ë ¥ì„ ìŒ“ì•„ ì•ˆì •ì ì¸ ìë¦¬ë¥¼ ì¡ëŠ” ì—ë„ˆì§€ì˜ˆìš”. ìê²©ì¦Â·ì‹œí—˜Â·ìŠ¹ì§„ì²˜ëŸ¼ ë‹¨ê³„ì ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ” ì„±ì·¨ì— ìœ ë¦¬í•˜ê³ , ê¾¸ì¤€íˆ ê³µë¶€í•˜ëŠ” ì‚¬ëŒì—ê²Œ ì¢‹ì€ ê²°ê³¼ê°€ ë”°ë¼ì˜µë‹ˆë‹¤. ê¸‰í•˜ê²Œ ì˜¬ë¼ê°€ê¸°ë³´ë‹¤ ì°¨ê·¼ì°¨ê·¼ ìŒ“ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.' },
  'ì—­ë§ˆì‚´': { type:'neut', ico:'ğŸ', short:'ëŠì„ì—†ëŠ” ì´ë™Â·ê¸€ë¡œë²Œ í™œë™',
    desc:'ì—­ë§ˆì‚´ì€ ëŠì„ì—†ì´ ì›€ì§ì´ëŠ” ì—ë„ˆì§€ì˜ˆìš”. í•œìë¦¬ì— ì˜¤ë˜ ìˆìœ¼ë©´ ë‹µë‹µí•˜ê³ , ì´ë™ê³¼ ë³€í™”ê°€ ë§ì€ ì‚¶ì„ ì‚´ê²Œ ë©ë‹ˆë‹¤. í•´ì™¸ ì¶œì¥Â·ì´ë¯¼Â·ë¬´ì—­Â·ë””ì§€í„¸ ë…¸ë§ˆë“œì²˜ëŸ¼ ê¸€ë¡œë²Œí•˜ê²Œ í™œë™í•˜ë©´ ì˜¤íˆë ¤ ì´ ì—ë„ˆì§€ê°€ í° ê¸°íšŒê°€ ë¼ìš”.' },
  'ìœ¡í•´ì‚´': { type:'warn', ico:'ğŸŒ€', short:'ì˜ˆë¯¼í•œ ê°ê°Â·ì¹´ë¥´ë§ˆì  ì¸ì—°',
    desc:'ìœ¡í•´ì‚´ì€ ì¸ê°„ê´€ê³„ì—ì„œ ì˜ˆìƒì¹˜ ëª»í•œ ë°©í•´ë‚˜ ê°ˆë“±ì´ ìƒê¸°ê¸° ì‰¬ìš´ ì—ë„ˆì§€ì˜ˆìš”. ì§€ë¦„ê¸¸ì„ ì°¾ìœ¼ë ¤ë‹¤ ì˜¤íˆë ¤ ë³µì¡í•´ì§€ëŠ” ìƒí™©ì´ ìƒê¸°ê¸°ë„ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì˜ˆë¯¼í•˜ê³  ì„¬ì„¸í•œ ê°ê°ì´ ê°•ì ì´ë¼, ìƒí™©ì˜ ì´ë©´ì„ ê¿°ëš«ëŠ” í†µì°°ë ¥ì´ ë›°ì–´ë‚˜ìš”.' },
  'í™”ê°œì‚´': { type:'neut', ico:'ğŸ¨', short:'ë…ì°½ì  ì¬ëŠ¥Â·ë‚˜ë§Œì˜ ì„¸ê³„',
    desc:'í™”ê°œì‚´ì€ ë‚˜ë§Œì˜ ì„¸ê³„ë¥¼ ê¹Šì´ íŒŒê³ ë“œëŠ” ì—ë„ˆì§€ì˜ˆìš”. ì°½ì‘Â·ì˜ˆìˆ Â·í•™ë¬¸ì—ì„œ ë…ë³´ì ì¸ ì¬ëŠ¥ì„ ë°œíœ˜í•˜ì§€ë§Œ í˜¼ì ìˆëŠ” ì‹œê°„ì´ í•„ìš”í•˜ê³  ê³ ë…ê°ì„ ëŠë¼ê¸° ì‰½ìŠµë‹ˆë‹¤. í¬ë¦¬ì—ì´í„°Â·ì˜ˆìˆ ê°€Â·ì—°êµ¬ìì²˜ëŸ¼ ìì‹ ë§Œì˜ ì˜ì—­ì„ êµ¬ì¶•í•˜ëŠ” ì‚¶ì—ì„œ ë¹›ì„ ë°œí•´ìš”.' },
};
const CHUNEUL = {
  0:[1,7], 1:[0,8], 2:[11,9], 3:[11,9], 4:[1,7],
  5:[0,8], 6:[1,7], 7:[2,6], 8:[3,5], 9:[3,5]
};

function getSinsalGroup(jj) {
  for (const [g, members] of Object.entries(SS_SANHAP_GRP))
    if (members.includes(jj)) return g;
  return null;
}
function buildSinsalMap(baseJj) {
  const g = getSinsalGroup(baseJj);
  const last = SS_SANHAP_LAST[g];
  const map = {};
  for (let i = 0; i < 12; i++) map[(last + 1 + i) % 12] = SINSAL_NAMES[i];
  return { group: g, map };
}
function checkChunEul(ilganCg, jjIdx) { return (CHUNEUL[ilganCg] || []).includes(jjIdx); }

// ë„í™” ìœ„ì¹˜/ì„±ì§ˆ
const JIJANGGAN_BONGI = [8,5,0,1,4,2,3,5,6,7,4,8];
const DOHWA_POSITION_NAME = {
  year:'ë…„ì‚´ë„í™”(å¹´æ®ºæ¡ƒèŠ±)', month:'ì›”ì¥ë„í™”(æœˆå°‡æ¡ƒèŠ±)', day:'í•¨ì§€ë„í™”(å’¸æ± æ¡ƒèŠ±)', hour:'ì‹œì‚´ë„í™”(æ™‚æ®ºæ¡ƒèŠ±)'
};
const DOHWA_POSITION_DESC = {
  year:'íƒ€ê³ ë‚œ í™˜ê²½ì—ì„œ ë„í™” ê¸°ìš´ì´ ë‚˜ì˜µë‹ˆë‹¤. ì–´ë¦´ ë•Œë¶€í„° ìì—°ìŠ¤ëŸ½ê²Œ ì£¼ëª©ë°›ê³ , ì‚¬íšŒì ìœ¼ë¡œ ì¸ê¸°ë¥¼ ì–»ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.',
  month:'ì‚¬íšŒí™œë™Â·ì§ì¥ì—ì„œ ë„í™”ê°€ ë°œíœ˜ë©ë‹ˆë‹¤. ë‹´ì„ ë„˜ì„ ë§Œí¼ ê°•ë ¬í•œ ë§¤ë ¥ì´ ìˆì–´ êµ¬ì„¤ì— ì˜¤ë¥¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.',
  day:'ë‚˜ ìì‹ ê³¼ ë°°ìš°ì ìë¦¬ì—ì„œ ë„í™” ê¸°ìš´ì´ íë¦…ë‹ˆë‹¤. ì¼ìƒ ì†ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ë§¤ë ¥ì´ ë°œì‚°ë©ë‹ˆë‹¤.',
  hour:'ë§ë…„Â·ìë…€ ìë¦¬ì—ì„œ ë„í™”ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤. ëŠ¦ì€ ì‹œê°„ëŒ€ì— ë§¤ë ¥ì´ ë”ìš± ë¹›ë‚©ë‹ˆë‹¤.',
};
const DOHWA_TYPE_DESC = {
  'ë¹„ê²¬': { desc:'ë‚´ í˜ì´ìŠ¤ëŒ€ë¡œ ì‚¬ëŒì„ ëŒì–´ë‹¹ê¸°ëŠ” ì£¼ë„ì  ë§¤ë ¥. ë™ë“±í•œ ê´€ê³„ì—ì„œ ë¹›ë‚©ë‹ˆë‹¤.' },
  'ê²ì¬': { desc:'ê²½ìŸ ì†ì—ì„œ ë§¤ë ¥ì´ 200% ë°œíœ˜ë©ë‹ˆë‹¤. ì§ˆì‹œì™€ ë¶€ëŸ¬ì›€ì„ ë°›ê¸°ë„ í•©ë‹ˆë‹¤.' },
  'ì‹ì‹ ': { desc:'ìì—°ìŠ¤ëŸ½ê²Œ ë„˜ì¹˜ëŠ” ì¬ëŠ¥ê³¼ ì—¬ìœ ë¡œ ì‚¬ëŒì„ ëŒì–´ë‹¹ê¹ë‹ˆë‹¤. í¸ì•ˆí•˜ê³  ì¹œê·¼í•œ ë§¤ë ¥.' },
  'ìƒê´€': { desc:'ë…ì°½ì ì´ê³  ì˜ˆìˆ ì ì¸ ëŒë¦¼ì´ ìˆìœ¼ë©°, ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë§¤ë ¥ìœ¼ë¡œ ìƒëŒ€ë¥¼ ì„¤ë ˆê²Œ í•©ë‹ˆë‹¤.' },
  'í¸ì¬': { desc:'ì‚¬êµ ëª¨ì„ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì¤‘ì‹¬ì´ ë˜ë©°, ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ì—ê²Œ ë§¤ë ¥ì„ ë°œì‚°í•©ë‹ˆë‹¤.' },
  'ì •ì¬': { desc:'ì˜¤ë˜ ì•Œìˆ˜ë¡ ë” ë§¤ë ¥ì ìœ¼ë¡œ ë³´ì´ëŠ” íƒ€ì…. ì§„ì‹¤í•˜ê³  ì„±ì‹¤í•œ ëª¨ìŠµìœ¼ë¡œ ë§ˆìŒì„ ì‚¬ë¡œì¡ìŠµë‹ˆë‹¤.' },
  'í¸ê´€': { desc:'ê°•í•œ ì¹´ë¦¬ìŠ¤ë§ˆë¡œ ìœ„ê¸° ìƒí™©ì—ì„œ ë¦¬ë”ì‹­ì´ ë¹›ë‚©ë‹ˆë‹¤. ë‘ë ¤ì›€ê³¼ ë§¤ë ¥ì´ ê³µì¡´í•©ë‹ˆë‹¤.' },
  'ì •ê´€': { desc:'ë‹¨ì •í•˜ê³  í’ˆìœ„ ìˆëŠ” ì•ˆì •ì  ë§¤ë ¥. ëˆ„êµ¬ì—ê²Œë‚˜ ì¸ì •ë°›ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.' },
  'í¸ì¸': { desc:'ì•Œ ë“¯ ëª¨ë¥¼ ë“¯í•œ ì‹ ë¹„ë¡œìš´ ë¶„ìœ„ê¸°ë¡œ ìƒëŒ€ë¥¼ ê¶ê¸ˆí•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.' },
  'ì •ì¸': { desc:'ë”°ëœ»í•˜ê³  ì§€ì ì¸ ë§¤ë ¥ìœ¼ë¡œ, ì˜¤ë˜ ê³ì— ìˆê³  ì‹¶ê³  ì˜ì§€í•˜ê³  ì‹¶ê²Œ ë§Œë“œëŠ” íƒ€ì…ì…ë‹ˆë‹¤.' },
};

// â”€â”€â”€ ë©”ì¸ ë¶„ì„ â”€â”€â”€
function analyzeSaju(year, month, day, hour, min, hasTime, gender, jasiMode='jo', cityCorr=0) {
  const yp = getYearPillar(year, month, day, hour);
  const { hour: ch, min: cm } = applyKSTCorrection(year, month, day, hasTime ? hour : 12, 0);
  const mp = getMonthPillar(yp.cg, year, month, day, hasTime ? ch : 12);
  const dp = getDayPillar(year, month, day, hasTime ? hour : null, jasiMode);
  const hp = hasTime ? getHourPillar(dp.cg, hour, min || 0, cityCorr) : null;

  const active = [
    { role:'hour', label:'ì‹œì£¼', p: hp },
    { role:'day',  label:'ì¼ì£¼', p: dp },
    { role:'month',label:'ì›”ì£¼', p: mp },
    { role:'year', label:'ì—°ì£¼', p: yp },
  ].filter(x => x.p);

  // â”€â”€ ë„í™”ì‚´ ê³„ì‚° (ì˜¬ë°”ë¥¸ ê¸°ì¤€) â”€â”€
  // í•µì‹¬: ì¼ì§€(æ—¥æ”¯) ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ ì–´ëŠ ì£¼(æŸ±)ì— ìˆëŠëƒë¡œ ë„í™” ì´ë¦„ ê²°ì •
  //   â†’ ì—°ì£¼: å¹´æ®ºæ¡ƒèŠ±, ì›”ì£¼: æœˆå°‡æ¡ƒèŠ±, ì‹œì£¼: æ™‚æ®ºæ¡ƒèŠ±
  // ì—°ì§€(å¹´æ”¯) ê¸°ì¤€ë„ ë³„ë„ ì²´í¬ (ì—°ì‚´ë„í™”)

  const dohwaJjiByDay   = getDohwaJji(dp.jj);   // ì¼ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ (í•µì‹¬)
  const dohwaJjiByYear  = getDohwaJji(yp.jj);   // ì—°ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ (ë³´ì¡°)
  const dohwaJjiByMonth = getDohwaJji(mp.jj);
  const dohwaJjiByHour  = hp ? getDohwaJji(hp.jj) : -1;

  // ì¼ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ ê° ì£¼ì— ìˆëŠ”ì§€ í™•ì¸
  const dohwaByDayAtYear  = yp.jj === dohwaJjiByDay;   // ì—°ì£¼ì— ìˆìœ¼ë©´ å¹´æ®ºæ¡ƒèŠ±
  const dohwaByDayAtMonth = mp.jj === dohwaJjiByDay;   // ì›”ì£¼ì— ìˆìœ¼ë©´ æœˆå°‡æ¡ƒèŠ±
  const dohwaByDayAtHour  = hp && hp.jj === dohwaJjiByDay; // ì‹œì£¼ì— ìˆìœ¼ë©´ æ™‚æ®ºæ¡ƒèŠ±

  // hamjiSal: ì¼ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ íƒ€ì£¼ì— í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ì„±ë¦½ (ê¸°ì¡´ í˜¸í™˜)
  const hamjiSal = dohwaByDayAtYear || dohwaByDayAtMonth || dohwaByDayAtHour;

  // ì—°ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ íƒ€ì£¼ì— ìˆëŠ” ê²½ìš° (ì—°ì‚´ë„í™”, ë³´ì¡°)
  const dohwaPillars = active.filter(p => p.role !== 'year' && p.p.jj === dohwaJjiByYear).map(p => p.role);
  const dohwaByMonthPos = active.filter(p => p.role !== 'month' && p.p.jj === dohwaJjiByMonth).map(p => p.role);
  const dohwaByHourPos  = (hp && dohwaJjiByHour >= 0)
    ? active.filter(p => p.role !== 'hour' && p.p.jj === dohwaJjiByHour).map(p => p.role) : [];

  // ì „ì²´ ë„í™” í•­ëª© (ìœ„ì¹˜ & ì„±ì§ˆ í‘œì‹œìš©)
  // ë„í™” ì´ë¦„ì€ "ì—°ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ ì–´ëŠ ì£¼ì— ìˆëŠëƒ"ë¡œ ê²°ì • (ì „í†µ ëª…ë¦¬ ê¸°ì¤€)
  //   ì—°ì§€ê¸°ì¤€ ë„í™”ì§€ì§€ â†’ ì›”ì£¼ì— ìˆìœ¼ë©´: ì›”ì¥ë„í™”, ì¼ì£¼: í•¨ì§€ë„í™”, ì‹œì£¼: ì‹œì‚´ë„í™”
  const DOHWA_POS_TO_NAME = {
    year:  'ì—°ì‚´ë„í™”(å¹´æ®ºæ¡ƒèŠ±)',
    month: 'ì›”ì¥ë„í™”(æœˆå°‡æ¡ƒèŠ±)',
    hour:  'ì‹œì‚´ë„í™”(æ™‚æ®ºæ¡ƒèŠ±)',
  };
  const DOHWA_POS_TO_DESC = {
    year:  'ì—°ì£¼(ë¿Œë¦¬Â·í™˜ê²½ ì˜ì—­)ì— ë„í™”ê¸°ìš´ì´ ê¹ƒë“¤ì—ˆìŠµë‹ˆë‹¤. ì–´ë¦´ ë•Œë¶€í„° ìì—°ìŠ¤ëŸ½ê²Œ ì£¼ëª©ë°›ê³ , íƒ€ê³ ë‚œ ë§¤ë ¥ì´ ì‚¬íšŒÂ·í™˜ê²½ ì „ë°˜ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.',
    month: 'ì›”ì£¼(ì‚¬íšŒÂ·ì§ì—… ì˜ì—­)ì— ë„í™”ê¸°ìš´ì´ ê¹ƒë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ì„±ì´ ë‹´ì„ ë„˜ì„ ë§Œí¼ ê°•ë ¬í•œ ë§¤ë ¥ì´ ìˆì–´ ë“œë¼ë§ˆí‹±í•œ ì‚¬ë‘ì— ë¹ ì§€ê¸° ì‰½ìŠµë‹ˆë‹¤. ë­‡ì‚¬ëŒì˜ ì‹œì„ ì„ ëŒì–´ êµ¬ì„¤ì— ì˜¤ë¥¼ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
    hour:  'ì‹œì£¼(ë§ë…„Â·ìë…€ ì˜ì—­)ì— ë„í™”ê¸°ìš´ì´ ê¹ƒë“¤ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì´ ë“¤ìˆ˜ë¡ ë§¤ë ¥ì´ ë”ìš± ë¹›ë‚˜ë©°, ëŠ¦ê²Œ ê½ƒ í”¼ìš°ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.',
  };
  const allDohwaEntries = [];
  // â˜… í•µì‹¬: ì¼ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ê°€ ì–´ëŠ ì£¼ì— ìˆëŠëƒë¡œ ì´ë¦„ ê²°ì •
  // ë„í™”ì§€ì§€ê°€ íƒ€ì£¼ì— í•˜ë‚˜ë¼ë„ ë°œê²¬ë˜ë©´ â†’ ê¸°ì¤€ì´ ëœ ì¼ì£¼(day) ìì²´ì—ë„ í‘œì‹œ (í¬ìŠ¤í…”ëŸ¬ ê¸°ì¤€)
  const dayDohwaFound = dohwaByDayAtYear || dohwaByDayAtMonth || dohwaByDayAtHour;
  if (dayDohwaFound)
    allDohwaEntries.push({ pos:'day', foundAt:['day'], name:'í•¨ì§€ë„í™”(å’¸æ± æ¡ƒèŠ±)', desc:'ë‚˜ ìì‹ ì—ì„œ ì‹œì‘ë˜ëŠ” ë³¸ëŠ¥ì  ë§¤ë ¥ì´ì—ìš”. ì¼ìƒ ì†ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ë§¤ë ¥ì´ ë°œì‚°ë˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.', basisJji:dohwaJjiByDay, basisLabel:'ì¼ì§€', isBasis:true });
  if (dohwaByDayAtYear)
    allDohwaEntries.push({ pos:'year',  foundAt:['year'],  name:DOHWA_POS_TO_NAME['year'],  desc:DOHWA_POS_TO_DESC['year'],  basisJji:dohwaJjiByDay, basisLabel:'ì¼ì§€' });
  if (dohwaByDayAtMonth)
    allDohwaEntries.push({ pos:'month', foundAt:['month'], name:DOHWA_POS_TO_NAME['month'], desc:DOHWA_POS_TO_DESC['month'], basisJji:dohwaJjiByDay, basisLabel:'ì¼ì§€' });
  if (dohwaByDayAtHour)
    allDohwaEntries.push({ pos:'hour',  foundAt:['hour'],  name:DOHWA_POS_TO_NAME['hour'],  desc:DOHWA_POS_TO_DESC['hour'],  basisJji:dohwaJjiByDay, basisLabel:'ì¼ì§€' });
  // ì—°ì§€ ê¸°ì¤€ ì¶”ê°€ ë„í™” (ìœ„ ëª©ë¡ì— ì—†ëŠ” ìœ„ì¹˜ë§Œ)
  for (const pos of dohwaPillars) {
    if (!allDohwaEntries.some(e => e.pos === pos) && DOHWA_POS_TO_NAME[pos]) {
      allDohwaEntries.push({ pos, foundAt:[pos], name:DOHWA_POS_TO_NAME[pos], desc:DOHWA_POS_TO_DESC[pos], basisJji:dohwaJjiByYear, basisLabel:'ì—°ì§€' });
    }
  }

  // í™ì—¼ì‚´ (ì¼ê°„ ê¸°ì¤€)
  const hongyeomJji = HONGYEOM[dp.cg];
  let hongyeomSal = false, hongyeomPillar = '';
  for (const p of active) {
    if (p.p.jj === hongyeomJji) { hongyeomSal = true; hongyeomPillar = p.label; }
  }


  // 12ì‹ ì‚´
  const ssByYear  = buildSinsalMap(yp.jj);
  const ssByDay   = buildSinsalMap(dp.jj);
  const ssByMonth = buildSinsalMap(mp.jj);
  const chuneulJjList = CHUNEUL[dp.cg] || [];

  function getPillarSinsal(jjIdx, byY, byD, byM, ilganCg) {
    const arr = [];
    if (byY.map[jjIdx]) arr.push({ name: byY.map[jjIdx], basis: 'year' });
    if (byD.map[jjIdx]) arr.push({ name: byD.map[jjIdx], basis: 'day' });
    if (byM.map[jjIdx]) arr.push({ name: byM.map[jjIdx], basis: 'month' });
    if (checkChunEul(ilganCg, jjIdx)) arr.push({ name: 'ì²œì„ê·€ì¸', basis: 'chuneul' });
    return arr;
  }
  const ssByHourCalc = hp ? buildSinsalMap(hp.jj) : null;

  function getPillarSinsalFull(jjIdx, byY, byD, byM, byH, ilganCg) {
    const arr = [];
    if (byY.map[jjIdx]) arr.push({ name: byY.map[jjIdx], basis: 'year' });
    if (byD.map[jjIdx]) arr.push({ name: byD.map[jjIdx], basis: 'day' });
    if (byM.map[jjIdx]) arr.push({ name: byM.map[jjIdx], basis: 'month' });
    if (byH && byH.map[jjIdx]) arr.push({ name: byH.map[jjIdx], basis: 'hour' });
    if (checkChunEul(ilganCg, jjIdx)) arr.push({ name: 'ì²œì„ê·€ì¸', basis: 'chuneul' });
    return arr;
  }

  const sinsalResult = {
    byYear: ssByYear, byDay: ssByDay, byMonth: ssByMonth,
    byHour: ssByHourCalc, chuneulJjList,
    pillars: {
      year:  { jj: yp.jj, sinsal: getPillarSinsalFull(yp.jj, ssByYear, ssByDay, ssByMonth, ssByHourCalc, dp.cg) },
      month: { jj: mp.jj, sinsal: getPillarSinsalFull(mp.jj, ssByYear, ssByDay, ssByMonth, ssByHourCalc, dp.cg) },
      day:   { jj: dp.jj, sinsal: getPillarSinsalFull(dp.jj, ssByYear, ssByDay, ssByMonth, ssByHourCalc, dp.cg) },
      hour:  hp ? { jj: hp.jj, sinsal: getPillarSinsalFull(hp.jj, ssByYear, ssByDay, ssByMonth, ssByHourCalc, dp.cg) } : null,
    }
  };

  // ì‹­ì„±
  const ilganIdx = dp.cg;
  function pillarSS(p) {
    if (!p) return { cg:'', jj:'', cgCol:'#666', jjCol:'#666' };
    const cgSS = getSibsungByCg(ilganIdx, p.cg);
    const jjSS = getSibsungByJj(ilganIdx, p.jj);
    return { cg:cgSS, jj:jjSS, cgCol:SIBSUNG_COLOR[cgSS]||'#666', jjCol:SIBSUNG_COLOR[jjSS]||'#666' };
  }
  const ypSS = pillarSS(yp), mpSS = pillarSS(mp);
  const dpSS = { cg:'ì¼ê°„', jj:getSibsungByJj(ilganIdx, dp.jj), cgCol:'#fbbf24', jjCol:SIBSUNG_COLOR[getSibsungByJj(ilganIdx, dp.jj)]||'#666' };
  const hpSS = hp ? pillarSS(hp) : null;

  // â”€â”€ íŠ¹ìˆ˜ ë„í™” ê³„ì‚° (12ì¢…) â”€â”€
  const DOHWA_JJI_SET = new Set([0,3,6,9]); // å­åˆå¯é…‰ = ë„í™”ì§€ì§€
  const allJjListFull = [yp.jj, mp.jj, dp.jj, ...(hp ? [hp.jj] : [])];

  // ê±´ë¡ì§€(å»ºç¥¿æ”¯): ì¼ê°„ ê¸°ì¤€ í•´ë‹¹ ì˜¤í–‰ì˜ ì œì™•ì§€
  const GUNROK_JJ = {0:3,1:4,2:6,3:6,4:9,5:10,6:9,7:10,8:0,9:1}; // ç”²â†’å¯, ä¹™â†’è¾°... ì‹¤ì œ ê±´ë¡
  // ì •í™•í•œ ê±´ë¡: ç”²â†’å¯…(2), ä¹™â†’å¯(3), ä¸™æˆŠâ†’å·³(5), ä¸å·±â†’åˆ(6), åºšâ†’ç”³(8), è¾›â†’é…‰(9), å£¬â†’äº¥(11), ç™¸â†’å­(0)
  const GUNROK_CORRECT = {0:2,1:3,2:5,3:6,4:5,5:6,6:8,7:9,8:11,9:0};

  // ë„í™”ì§€ì§€ê°€ ë°œê²¬ëœ ì£¼ë“¤(ì—° ì œì™¸)
  const dohwaFoundPillars = allDohwaEntries.filter(e=>!e.isBasis).map(e=>e.pos);
  const dohwaFoundCount = dohwaFoundPillars.length;

  // 1. ë‚˜ì²´ë„í™”: ì¼ì§€ ìì²´ê°€ ë„í™”ì§€ì§€(å­åˆå¯é…‰)
  const nakeDohwa = DOHWA_JJI_SET.has(dp.jj);

  // 2. ê³¤ë‘ë„í™”: ë°œê²¬ëœ ë„í™”ê°€ 3ê°œ ì´ìƒ ê¸°ë‘¥ì— (ë‚˜ì²´ë„í™” ë³„ë„, í¬í•¨ ì•ˆ í•¨)
  const golangDohwa = dohwaFoundCount >= 3;

  // 3. í¸ì•¼ë„í™”: ì—°Â·ì›”Â·ì¼Â·ì‹œ 4ê°œ ê¸°ë‘¥ ì „ë¶€ì— ë„í™” (ì—°+ì›”+ì‹œ ë°œê²¬ + ì¼ì§€ ë‚˜ì²´)
  const hasYearDohwa = allDohwaEntries.some(e => e.pos === 'year' && !e.isBasis);
  const pyeonyaDohwa = hasYearDohwa && dohwaFoundCount >= 3 && nakeDohwa;

  // 4. ì›”ë ¹ë„í™”: ì›”ì§€ ìì²´ê°€ ë„í™”ì§€ì§€
  const wollyeongDohwa = DOHWA_JJI_SET.has(mp.jj);

  // 5. ì‹­ì„± ê¸°ë°˜ ë„í™”: ë„í™”ì§€ì§€ê°€ ë°œê²¬ëœ ì£¼ì˜ ì²œê°„ ì‹­ì„± í™•ì¸
  const SIBSUNG_BY_POS = { year: ypSS.cg, month: mpSS.cg, hour: hpSS?.cg };
  const GWAN_SET = new Set(['ì •ê´€','í¸ê´€']);
  const IN_SET   = new Set(['ì •ì¸','í¸ì¸']);
  const BIJEP_SET= new Set(['ë¹„ê²¬','ê²ì¬']);
  const SIKS_SET = new Set(['ì‹ì‹ ','ìƒê´€']);

  let gwanDohwa=false, inDohwa=false, bijepDohwa=false, siksDohwa=false;
  for (const pos of dohwaFoundPillars) {
    const ss = SIBSUNG_BY_POS[pos];
    if (!ss) continue;
    if (GWAN_SET.has(ss))  gwanDohwa  = true;
    if (IN_SET.has(ss))    inDohwa    = true;
    if (BIJEP_SET.has(ss)) bijepDohwa = true;
    if (SIKS_SET.has(ss))  siksDohwa  = true;
  }

  // 6. ë…¹ë°©ë„í™”: ë„í™”ì§€ì§€ ì˜† ê¸°ë‘¥ì— ì¼ê°„ì˜ ê±´ë¡ì§€ê°€ ìˆìŒ
  const gunrokJj = GUNROK_CORRECT[dp.cg];
  const nokbangDohwa = allJjListFull.some(j => j === gunrokJj) && dohwaFoundCount > 0;

  // ì¥ë‚´/ì¥ì™¸ ë¶„ë¥˜
  const jangnae = dohwaFoundPillars.some(p => p==='year' || p==='month');
  const jangwoe = dohwaFoundPillars.some(p => p==='day' || p==='hour') || nakeDohwa;

  // ë„ì‚½ë„í™”(å€’æ’æ¡ƒèŠ±): ì¼ì§€ ì‚¼í•©ê·¸ë£¹ ê¸°ì¤€ â†’ ì—°ì§€ì— ë„í™”ì§€ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
  // ì‹ ìì§„â†’é…‰(9), ì¸ì˜¤ìˆ â†’å¯(3), ì‚¬ìœ ì¶•â†’åˆ(6), í•´ë¬˜ë¯¸â†’å­(0)
  const DOSAP_MAP = { 8:9, 0:9, 4:9,  2:3, 6:3, 10:3,  5:6, 9:6, 1:6,  11:0, 3:0, 7:0 };
  const dosapDohwaJji = DOSAP_MAP[dp.jj]; // ì¼ì§€ ê¸°ì¤€ ë„ì‚½ ë„í™”ì§€ì§€
  const dosapDohwa = (yp.jj === dosapDohwaJji);  // ì—°ì§€ì— í•´ë‹¹ ì§€ì§€ê°€ ìˆìœ¼ë©´ ì„±ë¦½

  const specialDohwa = {
    nake: nakeDohwa, golang: golangDohwa, pyeonya: pyeonyaDohwa,
    wollyeong: wollyeongDohwa, gwan: gwanDohwa, in: inDohwa,
    bijep: bijepDohwa, siks: siksDohwa, nokbang: nokbangDohwa,
    jangnae, jangwoe, dosap: dosapDohwa, dosapDohwaJji
  };

  // â”€â”€ 4ì¶• ì ìˆ˜ ê³„ì‚°: ê°•ë„(40) + ì„±ì§ˆ(25) + ìœ„ì¹˜(20) + íŠ¹ìˆ˜(15) = 100ì  â”€â”€
  const SD2 = specialDohwa;

  // [ê°•ë„] ë„í™” ìœ í˜•ë³„ ì„¸ê¸° (40ì  max)
  let scoreKangdo = 0;
  if (hamjiSal) scoreKangdo += 20;
  for (const e of allDohwaEntries) {
    if (e.isBasis) continue;
    if      (e.pos === 'month') scoreKangdo += 16;
    else if (e.pos === 'hour')  scoreKangdo += 8;
    else if (e.pos === 'year')  scoreKangdo += 5;
  }
  scoreKangdo = Math.min(scoreKangdo, 40);

  // [ì„±ì§ˆ] ë„í™”ì˜ ì§ˆì  íŠ¹ì„± (25ì  max)
  let scoreSeongji = 0;
  if (hongyeomSal) scoreSeongji += 12;
  if (SD2.gwan)    scoreSeongji += 5;
  if (SD2.in)      scoreSeongji += 4;
  if (SD2.siks)    scoreSeongji += 4;
  if (SD2.bijep)   scoreSeongji += 3;
  scoreSeongji = Math.min(scoreSeongji, 25);

  // [ìœ„ì¹˜] ë„í™”ì˜ ë°œí˜„ ìœ„ì¹˜ (20ì  max)
  let scoreWichi = 0;
  if (SD2.nake)     scoreWichi += 10;
  if (SD2.wollyeong) scoreWichi += 7;
  if (SD2.jangnae && SD2.jangwoe) scoreWichi += 4;
  else if (SD2.jangwoe) scoreWichi += 2;
  else if (SD2.jangnae) scoreWichi += 1;
  scoreWichi = Math.min(scoreWichi, 20);

  // [íŠ¹ìˆ˜] í¬ê·€ ë„í™” ì¡°í•© + ì²œê°„íˆ¬ì¶œ ë³´ë„ˆìŠ¤ + í˜•ì¶©íŒŒí•´ ê°ì 
  let scoreTeuksu = 0;
  if (SD2.pyeonya) scoreTeuksu += 8;
  if (SD2.golang)  scoreTeuksu += 5;
  if (SD2.nokbang) scoreTeuksu += 3;
  if (SD2.dosap)   scoreTeuksu += 2;
  scoreTeuksu = Math.min(scoreTeuksu, 15);

  // â”€â”€ ì²œê°„ íˆ¬ì¶œ ë³´ë„ˆìŠ¤ (ì§€ì¥ê°„ ê¸°ë°˜ ì •êµí™”) â”€â”€
  // ì •ê¸° íˆ¬ì¶œ: +3ì  / ì´ˆê¸° íˆ¬ì¶œ: +1ì  / åˆ ì¤‘ê¸° å·±: +2ì 
  // ì¼ê°„ = ì •ê¸°ì™€ ë™ì¼í•˜ë©´ +5ì  (1íšŒ í•œì •)
  const JIZG = { // {cho, jung, jeong}
    0:{cho:8, jung:null, jeong:9}, // å­: å£¬/ç™¸
    3:{cho:0, jung:null, jeong:1}, // å¯: ç”²/ä¹™
    6:{cho:2, jung:5,    jeong:3}, // åˆ: ä¸™/å·±/ä¸
    9:{cho:6, jung:null, jeong:7}, // é…‰: åºš/è¾›
  };
  let touchuBonus = 0;
  const touchuPillars = [];
  let ilganTouchuUsed = false;
  for (const e of allDohwaEntries) {
    if (e.isBasis) continue;
    let pillar = null;
    if (e.pos==='year') pillar = yp;
    else if (e.pos==='month') pillar = mp;
    else if (e.pos==='hour' && hp) pillar = hp;
    if (!pillar) continue;
    const jzg = JIZG[pillar.jj];
    if (!jzg) continue;
    const cg = pillar.cg;
    const pn = {year:'ì—°ì£¼',month:'ì›”ì£¼',hour:'ì‹œì£¼'}[e.pos];
    if (cg === jzg.jeong) {
      if (!ilganTouchuUsed && dp.cg === jzg.jeong) {
        touchuBonus += 5; ilganTouchuUsed = true;
        touchuPillars.push(pn+'(ì¼ê°„Â·ì •ê¸°íˆ¬ì¶œâ­)');
      } else {
        touchuBonus += 3;
        touchuPillars.push(pn+'(ì •ê¸°íˆ¬ì¶œ)');
      }
    } else if (jzg.jung !== null && cg === jzg.jung) {
      touchuBonus += 2;
      touchuPillars.push(pn+'(ì¤‘ê¸°íˆ¬ì¶œ)');
    } else if (cg === jzg.cho) {
      touchuBonus += 1;
      touchuPillars.push(pn+'(ì´ˆê¸°íˆ¬ì¶œ)');
    }
  }
  touchuBonus = Math.min(touchuBonus, 12);

  // â”€â”€ í•©(åˆ) ê°€ì‚° â”€â”€
  const JJ_KR3 = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
  // ë„í™”ë³„ ì‚¼í•©/ë°©í•© (ì •í™•í•œ ë°ì´í„°)
  const DOHWA_HAP = {
    0: {sam:[8,0,4],  bang:[11,0,1]},  // å­: ç”³å­è¾°ì‚¼í•© / äº¥å­ä¸‘ë°©í•©
    3: {sam:[11,3,7], bang:[2,3,4]},   // å¯: äº¥å¯æœªì‚¼í•© / å¯…å¯è¾°ë°©í•©
    6: {sam:[2,6,10], bang:[5,6,7]},   // åˆ: å¯…åˆæˆŒì‚¼í•© / å·³åˆæœªë°©í•©
    9: {sam:[5,9,1],  bang:[8,9,10]},  // é…‰: å·³é…‰ä¸‘ì‚¼í•© / ç”³é…‰æˆŒë°©í•©
  };
  const YUKHAP = [[0,1],[2,11],[3,10],[4,9],[5,8],[6,7]];
  let hapBonus = 0;
  const hapNotes = [];
  const allJjForHap = [yp.jj, mp.jj, dp.jj];
  if (hp) allJjForHap.push(hp.jj);

  for (const [dj, hap] of Object.entries(DOHWA_HAP)) {
    const djNum = parseInt(dj);
    if (!allJjForHap.includes(djNum)) continue;
    // ì‚¼í•© ì™„ì„± (+7)
    if (hap.sam.every(x => allJjForHap.includes(x))) {
      hapBonus += 7;
      hapNotes.push(hap.sam.map(x=>JJ_KR3[x]).join('')+' ì‚¼í•©(ë„í™” ì„¸ë ¥ ê°•í™”)');
    }
    // ë°©í•© ì™„ì„± (+5)
    else if (hap.bang.every(x => allJjForHap.includes(x))) {
      hapBonus += 5;
      hapNotes.push(hap.bang.map(x=>JJ_KR3[x]).join('')+' ë°©í•©(ë„í™” ì„¸ë ¥ í™•ì¥)');
    }
    // ì‚¼í•©/ë°©í•© 2ê°œ (ì¤€í•© +3)
    else if (hap.sam.filter(x => allJjForHap.includes(x)).length >= 2) {
      hapBonus += 3;
      hapNotes.push(JJ_KR3[djNum]+' ì¤€í•©(ë„í™” ê¸°ìš´ ê°•í™”)');
    }
  }
  // ìœ¡í•©
  for (const [a,b] of YUKHAP) {
    if (allJjForHap.includes(a) && allJjForHap.includes(b) && (DOHWA_JJI_SET.has(a)||DOHWA_JJI_SET.has(b))) {
      hapBonus += 4;
      hapNotes.push(JJ_KR3[a]+JJ_KR3[b]+' ìœ¡í•©(ë„í™” ì§€ì†ì„± ê°•í™”)');
    }
  }
  hapBonus = Math.min(hapBonus, 12);

  // â”€â”€ ì•”í•©(æš—åˆ) +2ì  â”€â”€
  // ì§€ì¥ê°„ë¼ë¦¬ ì²œê°„í•© â†’ ì€ë°€í•œ ë„í™” ì—ë„ˆì§€
  const JIZG_ALL = { // ì£¼ìš” ì§€ì§€ ì§€ì¥ê°„ (ì •ê¸° ìœ„ì£¼)
    0:[8,9], 1:[5,9,8], 2:[4,2,0], 3:[0,1], 4:[4,9,1],
    5:[4,6,3], 6:[2,5,3], 7:[3,1,5], 8:[4,5,6], 9:[6,7],
    10:[4,7,5], 11:[4,0,9]
  };
  const CHEONGAN_HAP_PAIRS = new Set(['0,5','1,6','2,7','3,8','4,9','5,0','6,1','7,2','8,3','9,4']);
  let amhapBonus = 0;
  const amhapNotes = [];
  const allPillarsJj = [yp.jj, mp.jj, dp.jj];
  if (hp) allPillarsJj.push(hp.jj);

  for (let i = 0; i < allPillarsJj.length; i++) {
    const jj_a = allPillarsJj[i];
    if (!DOHWA_JJI_SET.has(jj_a)) continue; // ë„í™”ì§€ì§€ë§Œ ì²´í¬
    for (let j = 0; j < allPillarsJj.length; j++) {
      if (i === j) continue;
      const jj_b = allPillarsJj[j];
      if (DOHWA_JJI_SET.has(jj_b)) continue; // ë¹„ë„í™”ì™€ë§Œ
      const cgs_a = JIZG_ALL[jj_a] || [];
      const cgs_b = JIZG_ALL[jj_b] || [];
      for (const ca of cgs_a) {
        for (const cb of cgs_b) {
          if (CHEONGAN_HAP_PAIRS.has(ca+','+cb)) {
            const key = Math.min(i,j)+'-'+Math.max(i,j)+'-'+ca+'-'+cb;
            if (!amhapNotes.find(n => n.includes(JJ_KR3[jj_a]+JJ_KR3[jj_b]))) {
              amhapBonus = Math.min(amhapBonus + 2, 4);
              amhapNotes.push(`${JJ_KR3[jj_a]}â†”${JJ_KR3[jj_b]} ì€ë°€í•œ ëŒë¦¼`);
            }
          }
        }
      }
    }
  }

  // â”€â”€ ê³µë§(ç©ºäº¡) ê°ì  â”€â”€
  // ì¼ì£¼ ê¸°ì¤€ ê³µë§ 2ì§€ì§€ ê³„ì‚°, ë„í™”ì§€ì§€ì™€ ê²¹ì¹˜ë©´ -3ì /ê¸€ì
  const gongmangStart = (dp.jj - dp.cg + 12) % 12;
  const gongmang1 = (gongmangStart + 10) % 12;
  const gongmang2 = (gongmangStart + 11) % 12;
  let gongmangPenalty = 0;
  const gongmangWarnings = [];
  const JJ_KR2 = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
  for (const gm of [gongmang1, gongmang2]) {
    if (DOHWA_JJI_SET.has(gm)) {
      gongmangPenalty += 3;
      gongmangWarnings.push(`${JJ_KR2[gm]} ê³µë§(ë³´ì¼ë“¯ë§ë“¯ ë„í™”)`);
    }
  }

  // â”€â”€ í˜•Â·ì¶©Â·íŒŒÂ·í•´ ê°ì  â”€â”€
  const allJj = [yp.jj, mp.jj, dp.jj];
  if (hp) allJj.push(hp.jj);
  const DOHWA_JJI_ARR = [0, 3, 6, 9];
  const JJ_KR = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];

  let chungPenalty = 0;
  const chungWarnings = [];
  for (let i = 0; i < allJj.length; i++) {
    for (let j = i+1; j < allJj.length; j++) {
      const a = allJj[i], b = allJj[j];
      if (Math.abs(a-b) === 6) {
        const aDohwa = DOHWA_JJI_ARR.includes(a), bDohwa = DOHWA_JJI_ARR.includes(b);
        if (aDohwa && bDohwa) { chungPenalty += 8; chungWarnings.push(JJ_KR[a]+'â†”'+JJ_KR[b]+' ì¶©(ë„í™” ì¶©ëŒ)'); }
        else if (aDohwa || bDohwa) { chungPenalty += 4; chungWarnings.push(JJ_KR[a]+'â†”'+JJ_KR[b]+' ì¶©(ë„í™” ì•½í™”)'); }
      }
    }
  }

  let hyeongPenalty = 0;
  const hyeongWarnings = [];
  const HYEONG_PAIRS = [[0,3],[1,10],[10,7],[7,1],[2,5],[5,8],[8,2]];
  for (const [a,b] of HYEONG_PAIRS) {
    if (allJj.includes(a) && allJj.includes(b)) {
      const aDohwa = DOHWA_JJI_ARR.includes(a), bDohwa = DOHWA_JJI_ARR.includes(b);
      if (aDohwa && bDohwa) { hyeongPenalty += 6; hyeongWarnings.push(JJ_KR[a]+JJ_KR[b]+' í˜•(êµ¬ì„¤Â·ì‚¬ê³  ìœ„í—˜)'); }
      else if (aDohwa || bDohwa) { hyeongPenalty += 3; hyeongWarnings.push(JJ_KR[a]+JJ_KR[b]+' í˜•(ë„í™” ë³€ì§ˆ)'); }
    }
  }

  let pahaPenalty = 0;
  const PA_PAIRS = [[0,9],[6,3],[1,4],[10,7],[2,11],[5,8]];
  const HAE_PAIRS = [[0,7],[1,6],[2,5],[3,4],[8,11],[9,10]];
  for (const [a,b] of PA_PAIRS) {
    if (allJj.includes(a) && allJj.includes(b) && (DOHWA_JJI_ARR.includes(a)||DOHWA_JJI_ARR.includes(b))) pahaPenalty += 2;
  }
  for (const [a,b] of HAE_PAIRS) {
    if (allJj.includes(a) && allJj.includes(b) && (DOHWA_JJI_ARR.includes(a)||DOHWA_JJI_ARR.includes(b))) pahaPenalty += 1;
  }

  const totalPenalty = chungPenalty + hyeongPenalty + pahaPenalty + gongmangPenalty;
  scoreTeuksu = scoreTeuksu + touchuBonus + hapBonus + amhapBonus - totalPenalty;

  const score = Math.max(Math.min(scoreKangdo + scoreSeongji + scoreWichi + scoreTeuksu, 100), 0);
  const strength = score;
  const scoreBreakdown = {
    kangdo: scoreKangdo, seongji: scoreSeongji, wichi: scoreWichi, teuksu: scoreTeuksu,
    touchuBonus, hapBonus, amhapBonus, gongmangPenalty, totalPenalty,
    touchuPillars,
    bonusNotes: [...hapNotes, ...amhapNotes],
    warnings: [...chungWarnings, ...hyeongWarnings, ...gongmangWarnings],
  };

  // â”€â”€ ë„í™” ìš´ìš© ì§€ìˆ˜ (ì‹ ê°•/ì‹ ì•½ ê°„ëµ ê³„ì‚°) â”€â”€
  // ì§€ì¥ê°„ ì—†ì´ ì²œê°„Â·ì§€ì§€ ì˜¤í–‰ ê¸°ë°˜ ê·¼ì‚¬ì¹˜. ì›”ì§€ ë“ë ¹ 2ë°° ê°€ì¤‘.
  // ì²œê°„ ì¸ë±ìŠ¤â†’ì˜¤í–‰: 0ç”²1ä¹™=æœ¨, 2ä¸™3ä¸=ç«, 4æˆŠ5å·±=åœŸ, 6åºš7è¾›=é‡‘, 8å£¬9ç™¸=æ°´
  const CG_OH = [0,0,1,1,2,2,3,3,4,4]; // 0æœ¨1ç«2åœŸ3é‡‘4æ°´
  const JJ_OH = [4,2,0,0,2,1,1,2,3,3,2,4]; // å­æ°´ä¸‘åœŸå¯…æœ¨å¯æœ¨è¾°åœŸå·³ç«åˆç«æœªåœŸç”³é‡‘é…‰é‡‘æˆŒåœŸäº¥æ°´
  // ì¼ê°„ ì˜¤í–‰ ê¸°ì¤€ ì‹­ì„± íŒë³„
  const ilOh = CG_OH[dp.cg];
  // ì‹ ê°• ìš”ì†Œ: ë¹„ê²(ê°™ì€ì˜¤í–‰), ì¸ì„±(ìƒí•´ì£¼ëŠ”ì˜¤í–‰)
  // ì‹ ì•½ ìš”ì†Œ: ê´€ì„±(ê·¹í•˜ëŠ”ì˜¤í–‰), ì‹ìƒ(ì„¤ê¸°ì˜¤í–‰), ì¬ì„±(ë‚´ê°€ê·¹í•˜ëŠ”ì˜¤í–‰)
  // ì˜¤í–‰ ìƒ: æœ¨â†’ç«â†’åœŸâ†’é‡‘â†’æ°´â†’æœ¨
  // ì˜¤í–‰ ê·¹: æœ¨â†’åœŸ, åœŸâ†’æ°´, æ°´â†’ç«, ç«â†’é‡‘, é‡‘â†’æœ¨
  const SAENG = [1,2,3,4,0]; // æœ¨(0)ì´ ç«(1)ë¥¼ ìƒ
  const GEUK  = [2,3,4,0,1]; // æœ¨(0)ì´ åœŸ(2)ë¥¼ ê·¹
  function isBigyep(oh){ return oh === ilOh; }
  function isInseong(oh){ return SAENG[oh] === ilOh; } // ohê°€ ilOhë¥¼ ìƒ
  function isGwanseong(oh){ return GEUK[ilOh] === oh; } // ilOhê°€ ohë¥¼ ê·¹? ì•„ë‹ˆê³  ohê°€ ilOhë¥¼ ê·¹
  // ìˆ˜ì •: ê´€ì„± = ë‚˜ë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰
  function isGwanseong2(oh){ return GEUK[oh] === ilOh; }
  function isSiksang(oh){ return SAENG[ilOh] === oh; } // ë‚´ê°€ ìƒí•˜ëŠ” ì˜¤í–‰
  function isJaeseong(oh){ return GEUK[ilOh] === oh; } // ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰... ì•„ë‹ˆê³ 
  // ì¬ì„± = ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰
  function isJaeseong2(oh){ return GEUK[ilOh] === oh; }
  
  // ì‹¤ì œ ì •í™•í•œ ê´€ê³„:
  // ë¹„ê²: ì¼ê°„ê³¼ ê°™ì€ ì˜¤í–‰
  // ì¸ì„±: ì¼ê°„ì„ ìƒí•´ì£¼ëŠ” ì˜¤í–‰ (SAENG[ì¸ì„±ì˜¤í–‰] = ì¼ê°„ì˜¤í–‰)
  // ê´€ì„±: ì¼ê°„ì„ ê·¹í•˜ëŠ” ì˜¤í–‰ (GEUK[ê´€ì„±ì˜¤í–‰] = ì¼ê°„ì˜¤í–‰)
  // ì‹ìƒ: ì¼ê°„ì´ ìƒí•˜ëŠ” ì˜¤í–‰ (SAENG[ì¼ê°„ì˜¤í–‰] = ì‹ìƒì˜¤í–‰)
  // ì¬ì„±: ì¼ê°„ì´ ê·¹í•˜ëŠ” ì˜¤í–‰ (GEUK[ì¼ê°„ì˜¤í–‰] = ì¬ì„±ì˜¤í–‰)
  
  let singangScore = 0;
  const allPillarsForSG = [{p:yp,isMol:false},{p:mp,isMol:true},{p:dp,isMol:false}];
  if(hp) allPillarsForSG.push({p:hp,isMol:false});
  
  for(const {p, isMol} of allPillarsForSG){
    if(p === dp) continue; // ì¼ê°„ ìì‹  ì œì™¸
    const cgOh = CG_OH[p.cg];
    const jjOh = JJ_OH[p.jj];
    const molWeight = isMol ? 2 : 1; // ì›”ì£¼ ë“ë ¹ 2ë°°

    // ì²œê°„
    if(isBigyep(cgOh) || SAENG[cgOh]===ilOh) singangScore += 3 * molWeight; // ë¹„ê²Â·ì¸ì„±
    else if(GEUK[cgOh]===ilOh || SAENG[ilOh]===cgOh || GEUK[ilOh]===cgOh) singangScore -= 2 * molWeight; // ê´€Â·ì‹Â·ì¬

    // ì§€ì§€
    if(isBigyep(jjOh) || SAENG[jjOh]===ilOh) singangScore += 3 * molWeight;
    else if(GEUK[jjOh]===ilOh || SAENG[ilOh]===jjOh || GEUK[ilOh]===jjOh) singangScore -= 2 * molWeight;
  }
  // ì¼ì§€ë„ í¬í•¨
  const dpJjOh = JJ_OH[dp.jj];
  if(isBigyep(dpJjOh) || SAENG[dpJjOh]===ilOh) singangScore += 3;
  else if(GEUK[dpJjOh]===ilOh || SAENG[ilOh]===dpJjOh || GEUK[ilOh]===dpJjOh) singangScore -= 2;

  let singangType, singangEmoji, singangColor, singangDesc;
  if(singangScore >= 8){
    singangType = 'ì‹ ê°•(èº«å¼º)'; singangEmoji = 'ğŸ’ª'; singangColor = '#ffd166';
    singangDesc = 'ë„í™” ì—ë„ˆì§€ë¥¼ ë‚´ê°€ ì£¼ë„í•©ë‹ˆë‹¤. ë§¤ë ¥ì„ ì „ëµì ìœ¼ë¡œ í™œìš©í•˜ê³  ìƒí™©ì„ ì»¨íŠ¸ë¡¤í•˜ëŠ” íƒ€ì…. ê´€ê³„ì—ì„œ ì£¼ë„ê¶Œì„ ê°–ë˜, ë„ˆë¬´ ê°•í•˜ë©´ ìƒëŒ€ê°€ ë¶€ë‹´ì„ ëŠë‚„ ìˆ˜ ìˆì–´ìš”.';
  } else if(singangScore >= 1){
    singangType = 'ì¤‘í™”(ä¸­å’Œ)'; singangEmoji = 'âš–ï¸'; singangColor = '#67e8f9';
    singangDesc = 'ë„í™” ì—ë„ˆì§€ì™€ ë‚´ ê¸°ìš´ì´ ê· í˜•ì„ ì´ë£¹ë‹ˆë‹¤. ìƒí™©ì— ë”°ë¼ ì£¼ë„ì ì´ê¸°ë„, ìˆ˜ë™ì ì´ê¸°ë„ í•œ ìœ ì—°í•œ íƒ€ì…. ê°€ì¥ ê´€ê³„ ì§€ì†ì„±ì´ ì¢‹ì€ êµ¬ì¡°ì…ë‹ˆë‹¤.';
  } else {
    singangType = 'ì‹ ì•½(èº«å¼±)'; singangEmoji = 'ğŸŒŠ'; singangColor = '#a78bfa';
    singangDesc = 'ë„í™” ê¸°ìš´ì´ ë‚˜ë³´ë‹¤ ê°•í•©ë‹ˆë‹¤. ë§¤ë ¥ì´ ê°•í•´ì„œ ì¸ê¸°ëŠ” ìˆì§€ë§Œ ì—ë„ˆì§€ ì†Œëª¨ê°€ í¬ê³ , ê´€ê³„ì—ì„œ ì´ëŒë ¤ ë‹¤ë‹ˆëŠ” ê²½í–¥ì´ ìˆì–´ìš”. ì„ íƒê³¼ ê²½ê³„ ì„¤ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.';
  }

  // ì—°ì† í¼ì„¼í…Œì´ì§€
  // pct = score ì§ì ‘ ì‚¬ìš© (0-100), ë³„ë„ ì¡°ì‘ ì—†ìŒ
  let level, levelDesc;
  if (score === 0) {
    level = 'ë„í™” ì—†ìŒ';
    levelDesc = 'ì‚¬ì£¼ì— ë„í™”ì‚´ì´ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ íƒ€ê³ ë‚œ ë§¤ë ¥ì€ ë…¸ë ¥ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”!';
  } else if (score <= 15) {
    level = 'ì ì¬ ë„í™”';
    levelDesc = 'ì•„ì§ í”¼ì§€ ì•Šì€ ê½ƒ. ê°€ê¹Œì´ì„œ ì˜¤ë˜ ë³¼ìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ë§¤ë ¥ì„ ê°€ì¡Œì–´ìš”.';
  } else if (score <= 35) {
    level = 'ì•½í•œ ë„í™”';
    levelDesc = 'ì€ì€í•˜ê²Œ ë¹›ë‚˜ëŠ” ë§¤ë ¥. ê°€ê¹Œì´ì„œ ì˜¤ë˜ ë³¼ìˆ˜ë¡ ì§„ê°€ê°€ ë“œëŸ¬ë‚˜ëŠ” íƒ€ì….';
  } else if (score <= 55) {
    level = 'ì¤‘ê°„ ë„í™”';
    levelDesc = 'ìì—°ìŠ¤ëŸ¬ìš´ ì¸ê¸°ì™€ ë§¤ë ¥. ì²«ì¸ìƒë¶€í„° ê¸°ì–µì— ë‚¨ëŠ” ì¡´ì¬ê°ì„ ê°€ì§‘ë‹ˆë‹¤.';
  } else if (score <= 75) {
    level = 'ê°•í•œ ë„í™”';
    levelDesc = 'íƒ€ê³ ë‚œ ë§¤ë ¥ì´ ì™¸ë¶€ë¡œ ì˜ ë“œëŸ¬ë‚©ë‹ˆë‹¤. ì²«ì¸ìƒë¶€í„° ì‚¬ëŒì„ ëŒì–´ë‹¹ê¸°ëŠ” í˜ì´ ìˆìŠµë‹ˆë‹¤.';
  } else if (score <= 90) {
    level = 'ë§¤ìš° ê°•í•œ ë„í™”';
    levelDesc = 'ê°•ë ¬í•œ ë„í™” ê¸°ìš´. ì–´ë””ì„œë“  ì‹œì„ ì„ ëŒê³  ì´ì„±ì˜ ë§ˆìŒì„ í”ë“œëŠ” ì¡´ì¬ì…ë‹ˆë‹¤.';
  } else {
    level = 'ì²œë¶€ ë„í™”';
    levelDesc = 'ì‚¬ì£¼ ì „ì²´ì— ë„í™” ê¸°ìš´ì´ ì¶©ë§Œ. ì™¸ëª¨Â·ë¶„ìœ„ê¸°Â·ë§íˆ¬ ëª¨ë“  ê²ƒì´ ë§¤ë ¥ í¬ì¸íŠ¸.';
  }
  const pct = score === 0 ? 4 : score; // ë°” í‘œì‹œìš© (0ì ë„ ìµœì†Œ í‘œì‹œ)


  // ë„í™” ìƒì„¸ ë¶„ì„
  // ë„í™” ìƒì„¸ ë¶„ì„ (ì—°ì§€/ì›”ì§€/ì¼ì§€/ì‹œì§€ ê¸°ì¤€ í†µí•©)
  function analyzeDohwaDetail() {
    const bongiCg = JIJANGGAN_BONGI[dp.jj];
    function ss(a,b){
      const oA=OHENG_CG[a],oB=OHENG_CG[b],sameYY=(YY_CG[a]===YY_CG[b]);
      if(oB===oA) return sameYY?'ë¹„ê²¬':'ê²ì¬';
      if(SENG_TO[oB]===oA) return sameYY?'í¸ì¸':'ì •ì¸';
      if(SENG_TO[oA]===oB) return sameYY?'ìƒê´€':'ì‹ì‹ ';
      if(KYEK_TO[oA]===oB) return sameYY?'í¸ì¬':'ì •ì¬';
      if(KYEK_TO[oB]===oA) return sameYY?'í¸ê´€':'ì •ê´€';
      return 'ë¹„ê²¬';
    }
    // allDohwaEntries ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©
    return { entries: allDohwaEntries, dohwaType: ss(ilganIdx, bongiCg), bongiCg };
  }
  const dohwaDetail = analyzeDohwaDetail();

  // ìœ í˜•
  const hasDohwa = allDohwaEntries.some(e => !e.isBasis);  // ì‹¤ì œ ë„í™” ë°œê²¬ ì—¬ë¶€
  const hasMonth = allDohwaEntries.some(e => e.pos==='month');
  const hasHour  = allDohwaEntries.some(e => e.pos==='hour');
  const hasYear  = allDohwaEntries.some(e => e.pos==='year');

  // â”€â”€ ë„í™” ìœ í˜• íŒì • (7ì¢…, ìš°ì„ ìˆœìœ„ ìˆœ) â”€â”€
  let typeKey = 'none';
  if (score === 0) {
    typeKey = 'none';
  } else if (SD2.pyeonya || SD2.golang || score >= 75) {
    typeKey = 'cheonbu';
  } else if (hasDohwa && hongyeomSal) {
    typeKey = 'pampatale';
  } else if (hamjiSal && hasDohwa) {
    typeKey = 'bonneung';
  } else if (hasMonth && hasDohwa) {
    typeKey = 'woljang';
  } else if ((SD2.gwan || SD2.in || SD2.bijep || SD2.siks) && hasDohwa) {
    typeKey = 'jaeneung';
  } else if (hongyeomSal && !hasDohwa) {
    typeKey = 'nunbit';
  } else {
    typeKey = 'none';
  }

  // â”€â”€ ë¶€ìœ í˜• ê³„ì‚° (ë©”ì¸ ì œì™¸í•œ ë³´ì¡° ë„í™” íŠ¹ì„±) â”€â”€
  const SUB_TYPE_DEFS = [
    { key:'cheonbu',   label:'ì²œë¶€í˜•',   emoji:'âš¡', cond: SD2.pyeonya || SD2.golang || score >= 75,
      subdesc:'í¸ì•¼Â·ê³¤ë‘ ë“± ê·¹ê°• ë„í™” ë³´ìœ ' },
    { key:'pampatale', label:'íŒœíŒŒíƒˆí˜•', emoji:'ğŸŒ™', cond: hasDohwa && hongyeomSal,
      subdesc:'ì¸ê¸°+ì¹˜ëª… ëˆˆë¹› ì¡°í•©' },
    { key:'bonneung',  label:'ë³¸ëŠ¥í˜•',   emoji:'ğŸ’˜', cond: hamjiSal && hasDohwa,
      subdesc:'í•¨ì§€ë„í™” ë³¸ëŠ¥ì  ëŒë¦¼' },
    { key:'woljang',   label:'ì¸ê¸°í˜•',   emoji:'ğŸŒ¸', cond: hasMonth && hasDohwa,
      subdesc:'ì–´ë””ì„œë‚˜ ì£¼ëª©ë°›ëŠ” ì¸ê¸°' },
    { key:'jaeneung',  label:'ì¬ëŠ¥í˜•',   emoji:'âœ¨', cond: (SD2.gwan || SD2.in || SD2.bijep || SD2.siks) && hasDohwa,
      subdesc:'ì‹­ì„±ë„í™” ì¬ëŠ¥Â·ì§€ì„± ë§¤ë ¥' },
    { key:'nunbit',    label:'ëˆˆë¹›í˜•',   emoji:'ğŸ”¥', cond: hongyeomSal,
      subdesc:'ì˜ë„ ì—†ì´ ê½‚íˆëŠ” ëˆˆë¹›' },
  ];
  const subTypes = SUB_TYPE_DEFS.filter(s => s.cond && s.key !== typeKey);

  // ì—­ë§ˆì‚´
  const YEOKMA_MAP = {0:2,8:2,4:2, 11:5,3:5,7:5, 2:8,6:8,10:8, 5:11,9:11,1:11};
  const allJjList = active.map(p => p.p.jj);
  const yeokmasal = allJjList.filter(j => j !== yp.jj).includes(YEOKMA_MAP[yp.jj])
                 || active.filter(p=>p.role!=='day').some(p=>p.p.jj===YEOKMA_MAP[dp.jj]);

  // ì›ì§„ì‚´
  const WONGJIN_MAP = {0:7,7:0,1:6,6:1,2:9,9:2,3:10,10:3,4:11,11:4,5:8,8:5};
  let wongjinsal = false;
  const wongjinPairs = [];
  for (let i=0; i<active.length; i++)
    for (let j2=i+1; j2<active.length; j2++)
      if (WONGJIN_MAP[active[i].p.jj] === active[j2].p.jj) {
        wongjinsal = true;
        wongjinPairs.push(active[i].label+'Â·'+active[j2].label);
      }

  // ê·€ë¬¸ê´€ì‚´
  const GWIMUN_MAP = {0:9,9:0,1:6,6:1,2:7,7:2,3:8,8:3,4:11,11:4,5:10,10:5};
  let gwimunsal = false;
  for (let i=0; i<allJjList.length; i++)
    for (let j2=i+1; j2<allJjList.length; j2++)
      if (GWIMUN_MAP[allJjList[i]] === allJjList[j2]) gwimunsal = true;

  // ê²ì‚´ (ì—°ì§€ ê¸°ì¤€ ì‚¼í•© ì´ì „ ì§€ì§€)
  const GYEOPSAL_MAP = {0:11,8:11,4:11, 2:1,6:1,10:1, 11:8,3:8,7:8, 5:5,9:5,1:5};
  const gyeopsalJji = GYEOPSAL_MAP[yp.jj];
  const gyeopsal = active.some(p => p.role !== 'year' && p.p.jj === gyeopsalJji);
  const gyeopsalPillar = active.filter(p => p.role !== 'year' && p.p.jj === gyeopsalJji).map(p=>p.label).join('Â·');

  // ì¬ì‚´ (ì—°ì§€ ê¸°ì¤€)
  const JAESAL_MAP = {0:6,8:6,4:6, 2:0,6:0,10:0, 11:3,3:3,7:3, 5:9,9:9,1:9};
  const jaesalJji = JAESAL_MAP[yp.jj];
  const jaesal = active.some(p => p.role !== 'year' && p.p.jj === jaesalJji);
  const jaesalPillar = active.filter(p => p.role !== 'year' && p.p.jj === jaesalJji).map(p=>p.label).join('Â·');

  // ë§ì‹ ì‚´ (ì—°ì§€ ê¸°ì¤€)
  const MANGSHIN_MAP = {0:7,8:7,4:7, 2:1,6:1,10:1, 11:4,3:4,7:4, 5:10,9:10,1:10};
  const mangshinJji = MANGSHIN_MAP[yp.jj];
  const mangshinsal = active.some(p => p.role !== 'year' && p.p.jj === mangshinJji);
  const mangshinPillar = active.filter(p => p.role !== 'year' && p.p.jj === mangshinJji).map(p=>p.label).join('Â·');

  // í™”ê°œì‚´ (ì—°ì§€ ê¸°ì¤€: ì‚¼í•© ë ì§€ì§€ ë‹¤ìŒ)
  const HWAGAE_MAP = {0:5,8:5,4:5, 2:11,6:11,10:11, 11:2,3:2,7:2, 5:8,9:8,1:8};
  const hwagaeJji = HWAGAE_MAP[yp.jj];
  const hwagaesal = active.some(p => p.role !== 'year' && p.p.jj === hwagaeJji);
  const hwagaePillar = active.filter(p => p.role !== 'year' && p.p.jj === hwagaeJji).map(p=>p.label).join('Â·');

  // ê³µë§ (æ—¬ç©ºäº¡): ì¼ì£¼ ê¸°ì¤€ 60ê°‘ì ìˆœ ë‚´ ì—†ëŠ” ì§€ì§€ 2ê°œ
  const GONGMANG = [
    [10,11],[8,9],[6,7],[4,5],[2,3],[0,1],
    [10,11],[8,9],[6,7],[4,5],[2,3],[0,1],
  ];
  function getGongmang(dayCg, dayJj) {
    const sunn = dayCg - dayJj; // ìˆœ ì˜¤í”„ì…‹
    // 60ê°‘ì ìˆœë²ˆ = Math.floor((dayCg*6 + ...) )
    // ê°„ë‹¨íˆ: ì¼ì£¼ ìˆœë²ˆ = (dayCg + dayJj*...
    // ê³µë§: ì¼ì§€(dayJj)ê°€ ì†í•œ ìˆœ(æ—¬)ì—ì„œ ë¹ ì§„ ì§€ì§€
    // ìˆœ(æ—¬): dayJj %2==dayJj - dayCg ë¡œ ìˆœ ì‹œì‘ ì§€ì§€ ê³„ì‚°
    // ë” ì •í™•íˆ: ìˆœ ì‹œì‘ = dayJj - dayCg (mod 12)
    const start = ((dayJj - dayCg) % 12 + 12) % 12; // ìˆœ ì²« ì§€ì§€
    // ì´ ìˆœì˜ 12ì§€ì§€ 10ê°œ ì‚¬ìš©, ë‚˜ë¨¸ì§€ 2ê°œê°€ ê³µë§
    const used = [];
    for (let i = 0; i < 10; i++) used.push((start + i) % 12);
    const all12 = Array.from({length:12}, (_,i)=>i);
    return all12.filter(j => !used.includes(j));
  }
  const gongmangJjList = getGongmang(dp.cg, dp.jj);
  const gongmangPillars = active.filter(p => gongmangJjList.includes(p.p.jj)).map(p => p.label);

  return {
    yp, mp, dp, hp, active, jasiMode, cityCorr,
    ypSS, mpSS, dpSS, hpSS, sinsalResult, dohwaDetail,
    dohwaPillars, dohwaJjiByYear, dohwaJjiByDay, dohwaByMonthPos, dohwaByHourPos, allDohwaEntries, specialDohwa,
    hamjiSal, hongyeomSal, hongyeomJji, hongyeomPillar, subTypes, scoreBreakdown,
    singangType, singangEmoji, singangColor, singangDesc,
    yeokmasal, wongjinsal, wongjinPairs, gwimunsal,
    gyeopsal, gyeopsalJji, gyeopsalPillar,
    jaesal, jaesalJji, jaesalPillar,
    mangshinsal, mangshinJji, mangshinPillar,
    hwagaesal, hwagaeJji, hwagaePillar,
    gongmangJjList, gongmangPillars,
    strength, level, pct, levelDesc, typeKey,
    year, month, day, hour, min, hasTime, gender, cityCorr
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë„í™” ìœ í˜• ë°ì´í„°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TYPES = {
  // ê°•ë„ ìˆœìœ„: 1ìœ„=ì²œë¶€, 2ìœ„=íŒœíŒŒíƒˆ, 3ìœ„=ë³¸ëŠ¥, 4ìœ„=ë‹´ì¥ë°–, 5ìœ„=ëˆˆë¹›ì¹˜ëª…, 6ìœ„=ì¬ëŠ¥, 7ìœ„=ì ë“ 
  none:      {
    emoji:'ğŸŒ±', label:'TYPE 0',
    title:'ì ë“  ë§¤ë ¥í˜•', subtitle:'ì•„ì§ í”¼ì§€ ì•Šì€ ê½ƒ',
    short:'ë„í™”ì‚´ì€ ì—†ì§€ë§Œ, ì§„ì§œ ë§¤ë ¥ì€ ìˆ¨ì–´ìˆë‹¤.',
    desc:'í™”ë ¤í•˜ê²Œ íŠ€ëŠ” ìŠ¤íƒ€ì¼ì€ ì•„ë‹ˆì—ìš”. ê·¸ëŸ°ë° ì˜¤ë˜ ë³¼ìˆ˜ë¡ ì´ìƒí•˜ê²Œ ëˆˆì´ ê°€ê³ , ê³ì— ìˆìœ¼ë©´ í¸ì•ˆí•œë° ì–´ëŠ ìˆœê°„ ìŠí˜€ì§€ì§€ ì•ŠëŠ” ì‚¬ëŒ. ì–µì§€ë¡œ ë§¤ë ¥ì„ ë§Œë“¤ì§€ ì•Šì•„ë„ ì§„ì •ì„±ê³¼ ê¹Šì´ë¡œ ìƒëŒ€ë°©ì„ ë¬´ì¥í•´ì œì‹œí‚µë‹ˆë‹¤. ì²˜ìŒì—” ëª°ëëŠ”ë° ë‚˜ì¤‘ì— "ì´ ì‚¬ëŒ ì™œ ì´ë ‡ê²Œ ì¢‹ì§€?" í•˜ê²Œ ë§Œë“œëŠ” íƒ€ì…ì´ì—ìš”.',
    traits:['ì§„ì •ì„±','ê¹Šì–´ì§€ëŠ” ë§¤ë ¥','ì‹ ë¢°ê°','ì˜¤ë˜ê°€ëŠ” ì¸ì—°'],
    color:'#34d399', glow:'#34d399', charType:'none'
  },
  nunbit:    {
    emoji:'ğŸ”¥', label:'TYPE 1',
    title:'ëˆˆë¹› ì¹˜ëª…í˜•', subtitle:'ì˜ë„ ì—†ì´ ê½‚íŒë‹¤',
    short:'ë³¸ì¸ì€ ì•„ë¬´ê²ƒë„ ì•ˆ í–ˆëŠ”ë° ìƒëŒ€ê°€ ë¨¼ì € ë„˜ì–´ì˜¨ë‹¤.',
    desc:'í™”ë ¤í•˜ì§€ ì•Šì•„ë„, ì ê·¹ì ì´ì§€ ì•Šì•„ë„ í•œ ë²ˆ ëˆˆì´ ë§ˆì£¼ì¹˜ë©´ ê·¸ ìë¦¬ì—ì„œ ê°ì¸ë©ë‹ˆë‹¤. "ì € ì‚¬ëŒ ì™œ ì €ë ‡ê²Œ ëˆˆë¹›ì´ ê°•í•˜ì§€?" "ë§ì´ ë³„ë¡œ ì—†ëŠ”ë° ì™œ ìê¾¸ ìƒê°ë‚˜ì§€?" ì´ëŸ° ë°˜ì‘ì„ ë§Œë“œëŠ” íƒ€ì…. ë¬´ì‹¬í•œë° ì¹˜ëª…ì ì´ë¼ ìƒëŒ€ê°€ ë¨¼ì € ë¹ ì ¸ë“œëŠ” ë¬˜í•œ ê¸°ìš´ì´ ìˆì–´ìš”.',
    traits:['ë¬´ì‹¬í•œ ì¹˜ëª…ë§¤ë ¥','ìŠí˜€ì§€ì§€ ì•ŠëŠ” ëˆˆë¹›','ì§‘ì°© ìœ ë°œ','ì˜ë„ì¹˜ ì•Šì€ ìœ í˜¹'],
    color:'#ff4500', glow:'#ff6b35', charType:'pure'
  },
  bonneung:  {
    emoji:'ğŸ’˜', label:'TYPE 2',
    title:'ë³¸ëŠ¥ ë§¤ë ¥í˜•', subtitle:'ëŒë¦¼ì´ ë³¸ëŠ¥ì ì´ë‹¤',
    short:'ë…¼ë¦¬ê°€ ì—†ë‹¤. ê·¸ëƒ¥ ëŒë¦°ë‹¤.',
    desc:'ì´ìœ ë¥¼ ì„¤ëª…í•˜ê¸° ì–´ë µì§€ë§Œ ê°™ì€ ê³µê°„ì— ìˆìœ¼ë©´ ìê¾¸ ëˆˆì´ ê°€ëŠ” íƒ€ì…ì´ì—ìš”. ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ ë³´ë©´ ì´ìƒí•˜ê²Œ ì„¤ë ˆê³ , ìƒëŒ€ë°©ì´ "ì™œ ì´ ì‚¬ëŒí•œí…Œ ì´ë ‡ê²Œ ëŒë¦¬ì§€?" ìŠ¤ìŠ¤ë¡œë„ ì´í•´ ëª»í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ë…¼ë¦¬ê°€ ì•„ë‹ˆë¼ ê°ê°ìœ¼ë¡œ ë§¤ë ¥ì„ ë°œì‚°í•˜ëŠ”, ê°€ì¥ ë³¸ëŠ¥ì ì¸ íƒ€ì…ì´ì—ìš”.',
    traits:['ë³¸ëŠ¥ì  ëŒë¦¼','ì„¤ëª… ë¶ˆê°€ ë§¤ë ¥','ê°•í•œ ì´ì„± ì¸ì—°','ì¹˜ëª…ì  ì¡´ì¬ê°'],
    color:'#ff5fa0', glow:'#ff5fa0', charType:'actor'
  },
  woljang:   {
    emoji:'ğŸŒ¸', label:'TYPE 3',
    title:'ë‹´ì¥ ë°– ì¸ê¸°í˜•', subtitle:'ì–´ë””ì„œë“  ì£¼ëª©ë°›ëŠ”ë‹¤',
    short:'ì²˜ìŒ ë³¸ ì‚¬ëŒë„ "ì € ì‚¬ëŒ ëˆ„êµ¬ì•¼" í•˜ê²Œ ë§Œë“œëŠ” íƒ€ì….',
    desc:'ë§¤ë ¥ì´ ê°€ê¹Œìš´ ì‚¬ëŒì„ ë„˜ì–´ ì‚¬íšŒ ì „ì²´ë¡œ í¼ì§€ëŠ” íƒ€ì…ì´ì—ìš”. ì²˜ìŒ ë§Œë‚˜ëŠ” ìë¦¬ì—ì„œë„ ìì—°ìŠ¤ëŸ½ê²Œ ì‹œì„ ì„ ëŒê³ , SNSì— ì˜¬ë¦¬ë©´ ë°˜ì‘ì´ ì¢‹ê³ , ëª¨ì„ì— ë‚˜ê°€ë©´ ë¶„ìœ„ê¸° ë©”ì´ì»¤ê°€ ë©ë‹ˆë‹¤. ì¸í”Œë£¨ì–¸ì„œÂ·ë°©ì†¡ì¸Â·ì„œë¹„ìŠ¤ì§ì—ì„œ ìœ ë… ë¹›ì„ ë°œí•´ìš”.',
    traits:['í­ë„“ì€ ì¸ê¸°','ê°•í•œ ì²«ì¸ìƒ','ëŒ€ì¤‘ì  ë§¤ë ¥','ì‚¬íšŒì  ì¡´ì¬ê°'],
    color:'#ffd166', glow:'#ffd166', charType:'social'
  },
  jaeneung:  {
    emoji:'âœ¨', label:'TYPE 4',
    title:'ì¬ëŠ¥ ë°œì‚°í˜•', subtitle:'ë¬´ì–¸ê°€ë¥¼ ì˜í•  ë•Œ ì œì¼ ë§¤ë ¥ìˆë‹¤',
    short:'ë¼Â·ì‹¤ë ¥Â·ì§€ì„±ì´ ë§¤ë ¥ì´ ë˜ëŠ” íƒ€ì….',
    desc:'ì™¸ëª¨ë‚˜ ë¶„ìœ„ê¸°ê°€ ì•„ë‹ˆë¼, ë¬´ì–¸ê°€ë¥¼ í•˜ëŠ” ëª¨ìŠµì—ì„œ ë§¤ë ¥ì´ í­ë°œí•˜ëŠ” íƒ€ì…ì´ì—ìš”. ë°œí‘œí•  ë•Œ, ì•…ê¸° ì—°ì£¼í•  ë•Œ, ì¼ì— ì§‘ì¤‘í•  ë•Œ, ë§ì„ ì²­ì‚°ìœ ìˆ˜ë¡œ í•  ë•Œ â€” ê·¸ ìˆœê°„ì´ ì œì¼ ë¹›ë‚©ë‹ˆë‹¤. "ì € ì‚¬ëŒ ì €ê±° í•˜ëŠ” ê±° ë³´ë©´ ì§„ì§œ ë§¤ë ¥ìˆì–´" ë¼ëŠ” ë§ì„ ìì£¼ ë“£ëŠ” ìœ í˜•ì´ì—ìš”.',
    traits:['ì¬ëŠ¥í˜• ë§¤ë ¥','ëª°ì…í•˜ëŠ” ëª¨ìŠµì´ ë§¤ë ¥','ì§€ì  ëŒë¦¼','ë¶„ì•¼ì—ì„œ ë¹›ë‚¨'],
    color:'#a78bfa', glow:'#a78bfa', charType:'artist'
  },
  pampatale: {
    emoji:'ğŸŒ™', label:'TYPE 5',
    title:'íŒœíŒŒíƒˆí˜•', subtitle:'ê°€ê¹Œì´ ê°€ë©´ ì•ˆ ë  ê²ƒ ê°™ì€ë° ìê¾¸ ê°€ê²Œ ëœë‹¤',
    short:'ë„í™”ì‚´ + í™ì—¼ì‚´ì˜ ì¡°í•©. ë§¤ë ¥ê³¼ ë…ì„±ì´ ê³µì¡´í•œë‹¤.',
    desc:'ëŒ€ì¤‘ì  ì¸ê¸°ì™€ ì¹˜ëª…ì ì¸ ëˆˆë¹›ì´ ë™ì‹œì— ì‘ë™í•˜ëŠ” ìµœê°• ì¡°í•©ì´ì—ìš”. ê°€ê¹Œì´ í•˜ê¸°ì—” ë„ˆë¬´ ê°•ë ¬í•˜ê³ , ë©€ë¦¬í•˜ê¸°ì—” ë„ˆë¬´ ëŒë¦¬ëŠ” ì•„ìš°ë¼. í•œ ë²ˆ ë¹ ì§€ë©´ í—¤ì–´ë‚˜ì˜¤ê¸° í˜ë“  ì¤‘ë…ì„± ìˆëŠ” ë§¤ë ¥ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì´ì„± ê´€ê³„ê°€ ë³µì¡í•´ì§€ëŠ” ê²½í–¥ì´ ìˆì§€ë§Œ, ê·¸ë§Œí¼ ê°•ë ¬í•œ ì¸ì—°ì„ ë§Œë“¤ì–´ìš”.',
    traits:['ì¹˜ëª…ì  ì•„ìš°ë¼','ì¤‘ë…ì„±','ì´ì„±ê³¼ì˜ ë³µì¡í•œ ì¸ì—°','ì ‘ê·¼ë¶ˆê°€ ì‹ ë¹„'],
    color:'#67e8f9', glow:'#67e8f9', charType:'mystery'
  },
  cheonbu:   {
    emoji:'âš¡', label:'TYPE 6',
    title:'ì²œë¶€ ë§¤ë ¥í˜•', subtitle:'íƒœì–´ë‚  ë•Œë¶€í„° ë„í™”ê°€ ë„˜ì³¤ë‹¤',
    short:'ë…¸ë ¥ ì—†ì´ë„ ì¡´ì¬ ìì²´ê°€ ë§¤ë ¥ì¸ ì‚¬ëŒ.',
    desc:'ì‚¬ì£¼ ì „ì²´ì— ë§¤ë ¥ ì—ë„ˆì§€ê°€ ê°€ë“í•œ íƒ€ì…ì´ì—ìš”. ì™¸ëª¨Â·ë¶„ìœ„ê¸°Â·ë§íˆ¬Â·í–‰ë™ í•˜ë‚˜í•˜ë‚˜ê°€ ì „ë¶€ ë§¤ë ¥ í¬ì¸íŠ¸. íŠ¹ë³„íˆ ë­”ê°€ë¥¼ í•˜ì§€ ì•Šì•„ë„ ê·¸ëƒ¥ ìˆëŠ” ê²ƒë§Œìœ¼ë¡œ ì£¼ëª©ë°›ìŠµë‹ˆë‹¤. ì—°ì˜ˆì¸ ì²´ì§ˆì´ê³  ëŒ€ì¤‘ì˜ ì‚¬ë‘ì„ ë°›ê¸° ìœ„í•´ íƒœì–´ë‚œ ì‚¬ëŒ. ë‹¤ë§Œ ë§¤ë ¥ì´ ë„ˆë¬´ ê°•í•´ ì´ì„± ê´€ê³„ê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.',
    traits:['ì²œë¶€ì  ë§¤ë ¥','ì „ë°©ìœ„ ë„í™”','ì—°ì˜ˆì¸ ì²´ì§ˆ','ì••ë„ì  ì¡´ì¬ê°'],
    color:'#ff5fa0', glow:'#f97316', charType:'charisma'
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI ìƒíƒœ ë³€ìˆ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI ìƒíƒœ ë³€ìˆ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selCal = 'solar', isLeapMonth = false, selGender = 'f', selJasi = 'jo', cityCorr = -32, resData = null;

function setCal(v) {
  selCal = v;
  document.getElementById('calSol').className = 'gbtn' + (v==='solar'?' on':'');
  document.getElementById('calLun').className = 'gbtn' + (v==='lunar'?' on':'');
  document.getElementById('leapWrap').style.display = v==='lunar' ? 'block' : 'none';
}
function toggleLeap() {
  isLeapMonth = !isLeapMonth;
  document.getElementById('leapBtn').textContent = isLeapMonth ? 'âœ… ìœ¤ë‹¬' : 'ìœ¤ë‹¬ ì•„ë‹˜';
  document.getElementById('leapBtn').className = 'gbtn' + (isLeapMonth ? ' on' : '');
}
function setJasi(v) {
  selJasi = v;
  document.getElementById('btnJoJasi').className = 'gbtn' + (v==='jo'?' on':'');
  document.getElementById('btnYaJasi').className = 'gbtn' + (v==='ya'?' on':'');
}
function setG(g) {
  selGender = g;
  document.getElementById('gF').className = 'gbtn' + (g==='f'?' on':'');
  document.getElementById('gM').className = 'gbtn' + (g==='m'?' on':'');
  document.getElementById('heroChibi').innerHTML = getDefaultChibi();
  prefetchGender(g); // ì„±ë³„ ì„ íƒ ì¦‰ì‹œ í•´ë‹¹ ì„±ë³„ ì´ë¯¸ì§€ ì „ì²´ í”„ë¦¬ë¡œë“œ
}
function updateCityCorr() {
  cityCorr = parseInt(document.getElementById('selCity').value) || 0;
  const tips = {
    '0':'ë³´ì • ì—†ìŒ: KST(UTC+9) ê¸°ì¤€', '-32':'ì„œìš¸/ìˆ˜ì›: ê²½ë„ 127Â° â†’ KSTë³´ë‹¤ 32ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
    '-33':'ì¸ì²œ/ê´‘ì£¼: ê²½ë„ 127Â° â†’ KSTë³´ë‹¤ 33ë¶„ ëŠë¦° íƒœì–‘ì‹œ', '-30':'ëŒ€ì „/ì²­ì£¼: KSTë³´ë‹¤ 30ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
    '-31':'ì „ì£¼: KSTë³´ë‹¤ 31ë¶„ ëŠë¦° íƒœì–‘ì‹œ', '-34':'ì œì£¼: KSTë³´ë‹¤ 34ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
    '-29':'ì¶˜ì²œ: KSTë³´ë‹¤ 29ë¶„ ëŠë¦° íƒœì–‘ì‹œ', '-25':'ê°•ë¦‰: KSTë³´ë‹¤ 25ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
    '-26':'ëŒ€êµ¬: KSTë³´ë‹¤ 26ë¶„ ëŠë¦° íƒœì–‘ì‹œ', '-24':'ë¶€ì‚°: KSTë³´ë‹¤ 24ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
    '-23':'ìš¸ì‚°: KSTë³´ë‹¤ 23ë¶„ ëŠë¦° íƒœì–‘ì‹œ',
  };
  document.getElementById('cityTip').textContent = tips[String(cityCorr)] || 'ì§€ë°©ì‹œ ë³´ì • ì ìš©';
}

function toggleCityDropdown(e) {
  e.stopPropagation();
  const dd = document.getElementById('cityDropdown');
  const arrow = document.getElementById('cityArrow');
  const isOpen = dd.classList.contains('open');
  dd.classList.toggle('open');
  arrow.textContent = isOpen ? 'â–¼' : 'â–²';
}

function selectCity(el) {
  // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
  document.querySelectorAll('.city-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
  const txt = el.dataset.value === '0' ? 'ğŸ“ ' + el.textContent : 'ğŸ“ ' + el.textContent;
  document.getElementById('cityBtnText').textContent = txt;
  // hidden input ì—…ë°ì´íŠ¸ â†’ ê¸°ì¡´ ë¡œì§ í˜¸í™˜
  document.getElementById('selCity').value = el.dataset.value;
  // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
  document.getElementById('cityDropdown').classList.remove('open');
  document.getElementById('cityArrow').textContent = 'â–¼';
  // ë³´ì •ê°’ ì—…ë°ì´íŠ¸
  updateCityCorr();
}

// ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', function() {
  const dd = document.getElementById('cityDropdown');
  if (dd) { dd.classList.remove('open'); document.getElementById('cityArrow').textContent = 'â–¼'; }
});

// ë³„ íŒŒí‹°í´
(function() {
  const c = document.getElementById('cosmos');
  for (let i = 0; i < 70; i++) {
    const s = document.createElement('div'), sz = Math.random()<.12?3:Math.random()<.35?2:1;
    s.className = 'star';
    s.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${Math.random()*100}%;background:#fff;--a:${.2+Math.random()*.7};--d:${2+Math.random()*4}s;--dl:${Math.random()*4}s;border-radius:50%;position:absolute;`;
    c.appendChild(s);
  }
})();

// ì´ˆê¸° ì¹˜ë¹„ + ê¸°ë³¸ ì„±ë³„(ì—¬) ì´ë¯¸ì§€ í”„ë¦¬ë¡œë“œ
document.getElementById('heroChibi').innerHTML = getDefaultChibi();
prefetchGender('f'); // í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ ì—¬ì„± ìºë¦­í„° 7ì¢… ë°±ê·¸ë¼ìš´ë“œ ë¡œë“œ

// â”€â”€â”€ ë¶„ì„ ì‹œì‘ â”€â”€â”€
function startAnalysis() {
  let year  = parseInt(document.getElementById('iY').value);
  let month = parseInt(document.getElementById('iMo').value);
  let day   = parseInt(document.getElementById('iD').value);
  const hv  = document.getElementById('iH').value.trim();
  const hour = hv === '' ? null : parseInt(hv);
  const name = document.getElementById('inpName').value.trim();

  if (!year||!month||!day||year<1930||year>2050||month<1||month>12||day<1||day>31) {
    showToast('ìƒë…„ì›”ì¼ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”!'); return;
  }

  if (selCal === 'lunar') {
    const converted = lunarToSolar(year, month, day, isLeapMonth);
    if (!converted) { showToast('ìŒë ¥ ë³€í™˜ ì‹¤íŒ¨. ë‚ ì§œë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.'); return; }
    year = converted.year; month = converted.month; day = converted.day;
  }

  document.getElementById('inputScreen').style.display = 'none';
  document.getElementById('loadingScreen').style.display = 'block';
  document.getElementById('loadChar').innerHTML = getDefaultChibi();

  const loadMsgs = ['ì²œê°„ì§€ì§€ë¥¼ ê³„ì‚°í•˜ê³  ìˆì–´ìš”','ë„í™”ì‚´ ê¸°ìš´ì„ ì½ëŠ” ì¤‘...','í™ì—¼ì‚´Â·í•¨ì§€ì‚´ ë¶„ì„ ì¤‘...','ë‹¹ì‹ ì˜ ë„í™” ìœ í˜•ì„ ì°¾ëŠ” ì¤‘...'];
  let li = 0;
  const ltimer = setInterval(() => {
    li++;
    if (li < loadMsgs.length) document.getElementById('loadTxt').textContent = loadMsgs[li];
  }, 620);

  setTimeout(() => {
    clearInterval(ltimer);
    try {
      const hasTime = hour !== null && !isNaN(hour);
      const minVal = parseInt(document.getElementById('iMin')?.value) || 0;
      const r = analyzeSaju(year, month, day, hasTime?hour:12, hasTime?minVal:0, hasTime, selGender, selJasi, cityCorr);
      r.name = name;
      resData = r;
      // íƒ€ì… í™•ì • â†’ ê²°ê³¼ ì´ë¯¸ì§€ high-priority preload
      const T = TYPES[r.typeKey] || TYPES.none;
      preloadChar(T.charType, r.gender);
      renderResult(r);
      document.getElementById('loadingScreen').style.display = 'none';
      document.getElementById('resultScreen').style.display = 'block';
      window.scrollTo({ top:0, behavior:'smooth' });
    } catch(e) {
      console.error('analyzeSaju error:', e);
      document.getElementById('loadingScreen').style.display = 'none';
      document.getElementById('inputScreen').style.display = 'block';
      showToast('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‚ ì§œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.');
    }
  }, 2800);
}

// â”€â”€â”€ ê²°ê³¼ ë Œë”ë§ â”€â”€â”€
function renderResult(r) {
  const T = TYPES[r.typeKey] || TYPES.none;
  const isMale = (r.gender === 'm');

  // íˆì–´ë¡œ í—¤ë” ìƒ‰ìƒ
  document.getElementById('rHero')?.style.setProperty('--hero-color', T.color);
  const heroStyle = document.createElement('style');
  heroStyle.textContent = `#rHero::before{background:linear-gradient(90deg,${T.color},${T.glow},${T.color})!important;}`;
  document.head.appendChild(heroStyle);

  const _rGlow=document.getElementById('rGlow'); if(_rGlow) _rGlow.style.background=T.glow;
  const _halo=document.getElementById('haloRing'); if(_halo) _halo.style.borderColor=T.color+'66';

  // ì¹˜ë¹„
  document.getElementById('rChibi').innerHTML =
    `<div class="halo-ring" style="border-color:${T.color}66"></div>` +
    getChibiSVG(T.charType, r.gender);

  // ë°°ì§€
  const badges = [];
  if (r.dohwaPillars.length > 0) badges.push(`<span class="sal-badge" style="border-color:${T.color}55;background:${T.color}18;color:${T.color}">ğŸŒ¸ ë„í™”ì‚´<span class="sal-tip">ì´ì„±ì„ ëŒì–´ë‹¹ê¸°ëŠ” ë§¤ë ¥ì˜ ê¸°ìš´ì´ì—ìš”.<br>ì—°ì• Â·ì¸ê¸°Â·ì¸ê°„ê´€ê³„ì— ê°•í•˜ê²Œ ì‘ìš©í•©ë‹ˆë‹¤.</span></span>`);
  if (r.hongyeomSal) badges.push(`<span class="sal-badge" style="border-color:#ff6b6b55;background:#ff6b6b18;color:#ff6b6b">ğŸ”¥ í™ì—¼ì‚´<span class="sal-tip">ê°•ë ¬í•˜ê³  ì¹˜ëª…ì ì¸ ë§¤ë ¥ì˜ ê¸°ìš´ì´ì—ìš”.<br>ì§™ì€ ìƒ‰ì±„ì™€ í™”ëˆí•œ ì¸ìƒì„ í’ê¹ë‹ˆë‹¤.</span></span>`);
  if (r.hamjiSal) badges.push(`<span class="sal-badge" style="border-color:#a78bfa55;background:#a78bfa18;color:#a78bfa">ğŸ’œ í•¨ì§€ì‚´<span class="sal-tip">ì¼ì§€ ê¸°ì¤€ ë„í™” ê¸°ìš´ì´ íƒ€ ê¸°ë‘¥ì— íŒŒê¸‰ë¼<br>ë³¸ëŠ¥ì ìœ¼ë¡œ ì´ì„±ì„ ëŒì–´ë‹¹ê¸°ëŠ” í˜ì…ë‹ˆë‹¤.</span></span>`);
  if (badges.length === 0) badges.push(`<span class="sal-badge" style="border-color:var(--border);background:rgba(255,255,255,.04);color:var(--sub)">ì‚´(æ®º) ì—†ìŒ<span class="sal-tip">ë„í™”ì‚´Â·í™ì—¼ì‚´Â·í•¨ì§€ì‚´ì´ ì—†ì–´ìš”.<br>ì§„ì •ì„± ìˆëŠ” ë§¤ë ¥ì„ ì§€ë‹Œ íƒ€ì…ì´ì—ìš”.</span></span>`);
  document.getElementById('salBadges').innerHTML = badges.join('');

  if (r.name) document.getElementById('rName').textContent = r.name + 'ë‹˜ì˜ ì‚¬ì£¼ ê²°ê³¼';
  if (r.year) {
    try {
      const _lun = solarToLunar(r.year, r.month, r.day);
      const _el = document.getElementById('rLunarDate');
      if (_el) _el.textContent = 'ì–‘ë ¥ ' + r.year + '.' + String(r.month).padStart(2,'0') + '.' + String(r.day).padStart(2,'0') + '  Â·  ìŒë ¥ ' + _lun.year + '.' + (_lun.isLeap?'ìœ¤':'') + String(_lun.month).padStart(2,'0') + '.' + String(_lun.day).padStart(2,'0');
    } catch(e) {}
  }
  document.getElementById('rTypeLbl').textContent = T.label;
  // ìˆœìœ„ ë±ƒì§€
  // score ê¸°ë°˜ ìˆœìœ„ ê³„ì‚° (level ê²½ê³„ì™€ ì™„ì „ ì¼ì¹˜)
  const sc = r.strength; // 0~100ì 
  let scoreRank, scoreRankLabel;
  if      (sc >= 91) { scoreRank = 1; scoreRankLabel = '1ìœ„ / 7'; }
  else if (sc >= 76) { scoreRank = 2; scoreRankLabel = '2ìœ„ / 7'; }
  else if (sc >= 56) { scoreRank = 3; scoreRankLabel = '3ìœ„ / 7'; }
  else if (sc >= 36) { scoreRank = 4; scoreRankLabel = '4ìœ„ / 7'; }
  else if (sc >= 16) { scoreRank = 5; scoreRankLabel = '5ìœ„ / 7'; }
  else if (sc >= 1)  { scoreRank = 6; scoreRankLabel = '6ìœ„ / 7'; }
  else               { scoreRank = 7; scoreRankLabel = '7ìœ„ / 7'; }
  // ìƒìœ„ X% = 100 - score (score ë†’ì„ìˆ˜ë¡ ë” í¬ê·€, í•œêµ­ì–´ "ìƒìœ„" ì˜ë¯¸ì— ë§ê²Œ)
  const topPct = Math.max(1, 100 - sc);
  const rankColors = ['','#ffd700','#c0c0c0','#cd7f32','#a78bfa','#67e8f9','#34d399','#888'];
  const rankEmojis = ['','ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£','7ï¸âƒ£'];
  const rankColor  = rankColors[scoreRank] || '#888';
  const bd = r.scoreBreakdown || {};
  const bonusTotal = (bd.touchuBonus||0) + (bd.hapBonus||0) + (bd.amhapBonus||0);
  const touchuHtml = bonusTotal > 0
    ? `<span style="font-size:10px;color:#ffd166;font-weight:700;margin-left:4px">â–²ë³´ë„ˆìŠ¤ +${bonusTotal}</span>` : '';
  const penaltyHtml = bd.totalPenalty > 0
    ? `<span style="font-size:10px;color:#ff6b6b;font-weight:700;margin-left:4px">â–¼ê°ì  -${bd.totalPenalty}</span>` : '';
  // ë³´ë„ˆìŠ¤ ë…¸íŠ¸ (í•©, íˆ¬ì¶œ)
  const bonusNoteHtml = (bd.bonusNotes && bd.bonusNotes.length > 0) || (bd.touchuPillars && bd.touchuPillars.length > 0)
    ? `<div style="margin-top:5px;display:flex;flex-wrap:wrap;gap:4px;justify-content:center">
        ${(bd.touchuPillars||[]).map(p => `<span style="font-size:10px;color:#ffd166;background:rgba(255,209,102,.08);border:1px solid rgba(255,209,102,.3);padding:2px 8px;border-radius:99px">âœ¨ ${p} ì²œê°„íˆ¬ì¶œ</span>`).join('')}
        ${(bd.bonusNotes||[]).map(n => `<span style="font-size:10px;color:#a78bfa;background:rgba(167,139,250,.08);border:1px solid rgba(167,139,250,.3);padding:2px 8px;border-radius:99px">ğŸ”— ${n}</span>`).join('')}
       </div>` : '';
  const warningsHtml = bd.warnings && bd.warnings.length > 0
    ? `<div style="margin-top:5px;display:flex;flex-wrap:wrap;gap:4px;justify-content:center">
        ${bd.warnings.map(w => `<span style="font-size:10px;color:#ff6b6b;background:rgba(255,107,107,.1);border:1px solid rgba(255,107,107,.3);padding:2px 8px;border-radius:99px">âš ï¸ ${w}</span>`).join('')}
       </div>` : '';

  // â”€â”€ í•œ ì¤„ ìš”ì•½ ìƒì„± â”€â”€
  const summaryTexts = {
    1: `ì‚¬ì£¼ ì „ì²´ì— ë„í™” ê¸°ìš´ì´ ê°€ë“í•´ìš”. ê·¸ëƒ¥ ìˆëŠ” ê²ƒë§Œìœ¼ë¡œë„ ëˆˆì— ë„ëŠ” íƒ€ì…ì´ì—ìš”.`,
    2: `ë„í™” ê¸°ìš´ì´ ë§¤ìš° ê°•í•´ìš”. ì´ì„±ì´ ìì—°ìŠ¤ëŸ½ê²Œ ëŒë¦¬ëŠ” ê°•ë ¥í•œ ë§¤ë ¥ì„ ê°€ì¡Œì–´ìš”.`,
    3: `ë„í™” ê¸°ìš´ì´ ëšœë ·í•´ìš”. ë§¤ë ¥ì„ ë°œì‚°í•˜ëŠ” ìƒí™©ê³¼ ìŠ¤íƒ€ì¼ì´ ëª…í™•í•œ íƒ€ì…ì´ì—ìš”.`,
    4: `ë„í™” ê¸°ìš´ì´ ìˆì–´ìš”. íŠ¹ì • ìƒí™©ì—ì„œ ê°•í•˜ê²Œ ë¹›ë‚˜ëŠ” ë§¤ë ¥ì„ ê°€ì§„ íƒ€ì…ì´ì—ìš”.`,
    5: `ë„í™” ê¸°ìš´ì´ ë³´í†µì´ì—ìš”. ì§„ì •ì„± ìˆëŠ” ê´€ê³„ì—ì„œ ë§¤ë ¥ì´ ë“œëŸ¬ë‚˜ëŠ” íƒ€ì…ì´ì—ìš”.`,
    6: `ë„í™” ê¸°ìš´ì´ ì•½í•œ í¸ì´ì—ìš”. ì˜¤ë˜ ì•Œìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ë§¤ë ¥ì„ ê°€ì§„ íƒ€ì…ì´ì—ìš”.`,
    7: `ë„í™”ì‚´ì´ ì—†ì–´ìš”. í™”ë ¤í•¨ë³´ë‹¤ ì§„ì •ì„±ìœ¼ë¡œ ê¸°ì–µì— ë‚¨ëŠ” íƒ€ì…ì´ì—ìš”.`,
  };
  const summaryText = summaryTexts[scoreRank] || '';
  const hasSalSummary = [];
  if (r.allDohwaEntries.length > 0) hasSalSummary.push(`ë„í™”ì‚´ ${r.allDohwaEntries.length}ê°œ`);
  if (r.hamjiSal) hasSalSummary.push('í•¨ì§€ì‚´');
  if (r.hongyeomSal) hasSalSummary.push('í™ì—¼ì‚´');

  const summaryEl = document.getElementById('rSummaryCard');
  if (summaryEl) {
    summaryEl.innerHTML = `
      <div style="display:flex;align-items:flex-start;gap:10px">
        <span style="font-size:22px;line-height:1.2;flex-shrink:0">${T.emoji}</span>
        <div>
          <div style="font-size:13px;font-weight:700;color:${T.color};margin-bottom:4px">${T.title} Â· ìƒìœ„ ${topPct}%</div>
          <div style="font-size:13px;color:var(--sub);line-height:1.7">${summaryText}</div>
          ${hasSalSummary.length ? `<div style="margin-top:6px;font-size:11px;color:var(--muted)">âœ¦ ë°œê²¬ëœ ê¸°ìš´: ${hasSalSummary.join(' Â· ')}</div>` : ''}
        </div>
      </div>`;
    summaryEl.style.borderColor = T.color + '44';
    summaryEl.style.background = T.color + '0e';
  }

  // â”€â”€ ë­í‚¹ ë±ƒì§€ (ì„íŒ©íŠ¸ ê°•í™”) â”€â”€
  document.getElementById('rRankBadge').innerHTML =
    `<div style="margin:8px 0 4px">
      <div style="font-size:10px;color:var(--muted);letter-spacing:1.5px;font-weight:600;margin-bottom:8px;text-transform:uppercase">ë„í™” ê°•ë„ ë­í‚¹ (7ë‹¨ê³„)</div>
      <div style="display:flex;align-items:center;justify-content:center;gap:0">
        ${[1,2,3,4,5,6,7].map(i => {
          const isMe = i === scoreRank;
          const isBefore = i < scoreRank;
          const dot = isMe
            ? `<div style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:2px">
                <div style="width:44px;height:44px;border-radius:50%;background:${rankColor};display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 0 18px ${rankColor}99,0 0 6px ${rankColor}66;border:2px solid rgba(255,255,255,.25)">
                  ${rankEmojis[i]}
                </div>
                <span style="font-size:9px;font-weight:800;color:${rankColor}">${i}ìœ„</span>
               </div>`
            : `<div style="display:flex;flex-direction:column;align-items:center;gap:2px">
                <div style="width:${isBefore?'28':'24'}px;height:${isBefore?'28':'24'}px;border-radius:50%;background:${isBefore?rankColor+'33':'rgba(255,255,255,.06)'};display:flex;align-items:center;justify-content:center;border:1px solid ${isBefore?rankColor+'55':'rgba(255,255,255,.08)'}">
                  <span style="font-size:${isBefore?'13':'9'}px">${isBefore?rankEmojis[i]:`<span style="color:var(--muted)">${i}</span>`}</span>
                </div>
                <span style="font-size:8px;color:${isBefore?rankColor+'99':'var(--muted)'};font-weight:${isBefore?'700':'400'}">${isBefore?i+'ìœ„':''}</span>
               </div>`;
          const line = i < 7
            ? `<div style="width:10px;height:2px;margin-bottom:12px;background:${i < scoreRank ? rankColor+'44' : 'rgba(255,255,255,.06)'}"></div>` : '';
          return dot + line;
        }).join('')}
      </div>
      <div style="margin-top:6px;font-size:11px;color:${rankColor};font-weight:700">
        ìƒìœ„ ${topPct}% ë„í™” ê¸°ìš´ Â· ${sc}ì 
      </div>
    </div>
    <div style="display:flex;gap:4px;justify-content:center;flex-wrap:wrap;margin-top:2px">
      ${touchuHtml}${penaltyHtml}
    </div>
    <div style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-top:12px">
      ${[
        {l:'ê°•ë„', v:bd.kangdo,  max:40, c:'#ff5fa0', tip:'ë„í™”ì‚´ ê°œìˆ˜Â·ìœ„ì¹˜'},
        {l:'ì„±ì§ˆ', v:bd.seongji, max:25, c:'#67e8f9', tip:'í™ì—¼ì‚´Â·ì‹­ì„±ë„í™”'},
        {l:'ë°œí˜„', v:bd.wichi,   max:20, c:'#ffd166', tip:'ë‚˜ì²´Â·ì›”ë ¹Â·ì¥ë‚´ì™¸'},
        {l:'í¬ê·€', v:Math.max(bd.teuksu||0,0), max:15, c:'#a78bfa', tip:'í¸ì•¼Â·ê³¤ë‘Â·ë…¹ë°©Â·ë„ì‚½'},
      ].map(a => `<span style="display:inline-flex;flex-direction:column;align-items:center;gap:3px;min-width:56px;">
        <span style="font-size:10px;color:var(--muted);font-weight:600">${a.l}</span>
        <span style="width:56px;height:6px;background:var(--border);border-radius:99px;overflow:hidden">
          <span style="display:block;height:100%;width:${Math.round((Math.max(a.v,0)/a.max)*100)}%;background:${a.c};border-radius:99px"></span>
        </span>
        <span style="font-size:12px;font-weight:700;color:${a.c}">${a.v}<span style="opacity:.4;font-weight:400">/${a.max}</span></span>
        <span style="font-size:9px;color:var(--muted);opacity:.8">${a.tip}</span>
      </span>`).join('')}
    </div>
    ${bonusNoteHtml}${warningsHtml}`;
  const _lbl=document.getElementById('rTypeLbl'); if(_lbl) _lbl.style.color=T.color;
  document.getElementById('rSubtitle').textContent = T.subtitle || '';
  const _sub2=document.getElementById('rSubtitle'); if(_sub2) _sub2.style.color=T.color;
  document.getElementById('rTitle').textContent = T.title;
  document.getElementById('rShort').textContent = '"' + (T.short || '') + '"';
  const _short=document.getElementById('rShort'); if(_short) _short.style.color=T.color;

  // ë¶€ìœ í˜• í‘œì‹œ
  const subEl = document.getElementById('rSubTypes');
  if (r.subTypes && r.subTypes.length > 0) {
    const cols = r.subTypes.length >= 2 ? 2 : 1;
    subEl.innerHTML = `<div style="font-size:11px;color:var(--muted);margin-bottom:8px;text-align:center">+ ì¶”ê°€ ë„í™” íŠ¹ì„±</div>
      <div style="display:grid;grid-template-columns:repeat(${cols},1fr);gap:8px;">`
      + r.subTypes.map(s =>
        `<div style="display:flex;flex-direction:column;align-items:center;gap:4px;font-size:11px;font-weight:700;
          color:var(--sub);background:rgba(255,255,255,.06);border:1px solid var(--border);
          padding:12px 10px;border-radius:12px;text-align:center;">
          <span style="font-size:18px">${s.emoji}</span>
          <span style="font-size:12px;font-weight:700">${s.label}</span>
          <span style="font-size:10px;font-weight:400;opacity:.7;line-height:1.4">${s.subdesc||''}</span>
        </div>`
      ).join('') + `</div>`;
  } else {
    subEl.innerHTML = '';
  }
  document.getElementById('rDesc').textContent = T.desc;

  // ë„í™” ìš´ìš© ì§€ìˆ˜ ì¹´ë“œ
  const sgCard = document.getElementById('rSingangCard');
  if (r.singangType) {
    sgCard.innerHTML = `
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="font-size:11px;font-weight:700;letter-spacing:1px;color:var(--muted);text-transform:uppercase">ë„í™” ìš´ìš© ì§€ìˆ˜</span>
        <span style="font-size:11px;font-weight:700;color:${r.singangColor};background:${r.singangColor}22;
          border:1px solid ${r.singangColor}55;padding:2px 10px;border-radius:99px">
          ${r.singangEmoji} ${r.singangType}
        </span>
        <span style="font-size:10px;color:var(--muted);margin-left:auto">*ê°„ëµ ê³„ì‚° ê¸°ì¤€</span>
      </div>
      <p style="font-size:13px;line-height:1.7;color:var(--sub);margin:0">${r.singangDesc}</p>`;
  } else {
    sgCard.innerHTML = '';
  }

  // â”€â”€ ì‚¬ì£¼ íŒ”ì â”€â”€
  const ssByRole = { hour:r.hpSS, day:r.dpSS, month:r.mpSS, year:r.ypSS };
  const pillarsDisplay = [
    { label:'ì‹œ', role:'hour', p:r.hp },
    { label:'ì¼', role:'day',  p:r.dp },
    { label:'ì›”', role:'month', p:r.mp },
    { label:'ì—°', role:'year', p:r.yp },
  ];

  let sajuHtml = '';
  for (const { label, role, p } of pillarsDisplay) {
    if (!p) {
      sajuHtml += `<div class="saju-col"><div class="sp-lbl">${label}ì£¼</div><div class="sc-na">ë¯¸ì…ë ¥</div></div>`;
      continue;
    }
    const cgColor = p.cg % 2 === 0 ? '#ff7bb8' : '#67aaff';
    const jjColor = p.jj % 2 === 0 ? '#ff7bb8' : '#67aaff';
    const ss = ssByRole[role] || {};

    let salHtml = '';
    // ë„í™” ë±ƒì§€: allDohwaEntriesì— í•´ë‹¹ ì£¼(pos)ê°€ ìˆìœ¼ë©´ í‘œì‹œ
    const isDohwa = r.allDohwaEntries.some(e => e.pos === role);
    if (isDohwa) salHtml += `<span class="sc-sal dohwa-sal">ğŸŒ¸ë„í™”</span>`;
    if (role !== 'day' && r.hongyeomSal && p.jj === r.hongyeomJji) salHtml += `<span class="sc-sal hong-sal">ğŸ”¥í™ì—¼</span>`;

    const cgSSTxt = role === 'day' ? 'ì¼ê°„(ë³¸ì¸)' : (ss.cg || '');
    sajuHtml += `<div class="saju-col">
      <div class="sp-lbl">${label}ì£¼</div>
      <div class="sc-ss" style="color:${role==='day'?'#fbbf24':(ss.cgCol||'var(--muted)')}">${cgSSTxt}</div>
      <div class="sc-han" style="color:${cgColor}">${CG[p.cg]}</div>
      <div class="sc-kr">${CGKR[p.cg]}</div>
      <div class="sc-div"></div>
      <div class="sc-han" style="color:${jjColor}">${JJ[p.jj]}</div>
      <div class="sc-kr">${JJKR[p.jj]}</div>
      <div class="sc-ss" style="color:${ss.jjCol||'var(--muted)'}">${ss.jj||''}</div>
      ${salHtml}
    </div>`;
  }
  document.getElementById('sajuGrid').innerHTML = sajuHtml;

  const jbadge = document.getElementById('jasiModeBadge');
  if (jbadge) {
    const _citySelected = document.querySelector('.city-option.selected');
    const cityName = _citySelected ? _citySelected.textContent.split(' ')[0] : 'ì„œìš¸';
    jbadge.textContent = (r.jasiMode==='ya'?'ì•¼ìì‹œ':'ì¡°ìì‹œ') + (r.cityCorr!==0?' Â· '+cityName+' ì§€ë°©ì‹œ':'');
  }

  // â”€â”€ ë„í™” ê°•ë„ â”€â”€
  document.getElementById('dgLevel').textContent = r.level;
  const _dglv=document.getElementById('dgLevel'); if(_dglv) _dglv.style.color=T.color;
  document.getElementById('dgPct').textContent = r.pct + '%';
  setTimeout(() => { const _dgf=document.getElementById('dgFill'); if(_dgf) _dgf.style.width=r.pct+'%'; }, 300);
  document.getElementById('dgNote').textContent = r.levelDesc;

  const pillLabels = { year:'ì—°ì‚´ë„í™”', month:'ì›”ì¥ë„í™”', day:'í•¨ì§€ë„í™”', hour:'ì‹œì‚´ë„í™”' };
  document.getElementById('dgPills').innerHTML = ['year','month','day','hour'].map(k => {
    const on = r.allDohwaEntries.some(e => e.pos === k);
    return `<span class="dg-pill${on?' on':''}">${pillLabels[k]}</span>`;
  }).join('');

  // â”€â”€ ìœ í˜• â”€â”€
  document.getElementById('typeTitle').textContent = T.title + ' ' + T.emoji;
  const _tt=document.getElementById('typeTitle'); if(_tt) _tt.style.color=T.color;
  document.getElementById('typeDesc').innerHTML =
    T.desc +
    `<br><br><span style="color:var(--muted);font-size:12px">ğŸ“Š ë„í™”ì§€ì§€: ${JJ[r.dohwaJjiByYear]}(${JJKR[r.dohwaJjiByYear]}) Â· ì¼ì§€ ë„í™”ì§€ì§€: ${JJ[r.dohwaJjiByDay]}(${JJKR[r.dohwaJjiByDay]}) Â· í™ì—¼ì§€ì§€: ${JJ[r.hongyeomJji]}(${JJKR[r.hongyeomJji]})</span>`;
  document.getElementById('typeTraits').innerHTML = T.traits.map(t => `<span class="trait">${t}</span>`).join('');

  // â”€â”€ ë„í™” ìœ„ì¹˜ & ì„±ì§ˆ â”€â”€
  const DD = r.dohwaDetail;
  let detailHtml = '';
  if (DD.entries.length === 0) {
    detailHtml = `<div style="color:var(--muted);font-size:13px;text-align:center;padding:16px 0">ì‚¬ì£¼ì— ë„í™”ì‚´ì´ ì—†ìŠµë‹ˆë‹¤ ğŸŒ¸</div>`;
  } else {
    DD.entries.forEach(e => {
      const posLabel = { year:'ì—°ì£¼', month:'ì›”ì£¼', day:'ì¼ì£¼', hour:'ì‹œì£¼' }[e.pos] || e.pos;
      const badgeTxt = e.isBasis
        ? `ì¼ì§€ ${JJ[e.basisJji]}(${JJKR[e.basisJji]}) â€” í•¨ì§€ë„í™”ì˜ ê·¼ì›`
        : `ì¼ì§€ ${JJ[e.basisJji]}(${JJKR[e.basisJji]}) ê¸°ì¤€ â†’ ${posLabel}ì— ë„í™”ì§€ì§€`;
      const badgeStyle = e.isBasis
        ? 'font-size:11px;color:#ffe5a0;background:rgba(255,200,60,.25);border:1px solid rgba(255,200,60,.5);padding:2px 10px;border-radius:99px;font-weight:600'
        : 'font-size:11px;color:#ffd6e8;background:rgba(255,95,160,.30);border:1px solid rgba(255,95,160,.5);padding:2px 10px;border-radius:99px;font-weight:500';
      detailHtml += `<div class="dd-pos">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap">
          <span style="font-size:14px;font-weight:700;color:#ff6fa3;font-family:'Noto Serif KR'">${e.name}</span>
          <span style="${badgeStyle}">${badgeTxt}</span>
        </div>
        <div style="font-size:13px;color:var(--sub);line-height:1.9">${e.desc}</div>
      </div>`;
    });
    const typeInfo = DOHWA_TYPE_DESC[DD.dohwaType] || {};
    detailHtml += `<div style="background:rgba(255,111,163,.08);border:1px solid rgba(255,111,163,.25);border-radius:12px;padding:16px;margin-top:12px">
      <div style="font-size:13px;font-weight:700;color:#ffd166;margin-bottom:8px">ğŸŒ¸ ë„í™”ì˜ ì„±ì§ˆ: ${DD.dohwaType}</div>
      <div style="font-size:13px;color:var(--sub);line-height:1.9">${typeInfo.desc || ''}</div>
      <div style="font-size:10px;color:var(--muted);margin-top:8px">â€» ì¼ì§€ ì§€ì¥ê°„ ë³¸ê¸° ${CG[DD.bongiCg]}(${CGKR[DD.bongiCg]})ì™€ ì¼ê°„ì˜ ì‹­ì„± ê´€ê³„</div>
    </div>`;
  }
  document.getElementById('dohwaDetailBody').innerHTML = detailHtml;

  // â”€â”€ íŠ¹ìˆ˜ ë„í™” ë¶„ì„ â”€â”€
  const SD = r.specialDohwa;
  // cat: ì–´ëŠ ì ìˆ˜ ë°”ì— ê¸°ì—¬í•˜ëŠ”ì§€ ('ë°œí˜„'=wichi, 'ì„±ì§ˆ'=seongji, 'í¬ê·€'=teuksu)
  const specList = [
    { key:'jangnae',  on:SD.jangnae,   cat:'ë°œí˜„', catC:'#ffd166', name:'ì¥ë‚´ë„í™”(ç‰†å…§æ¡ƒèŠ±)', ico:'ğŸ ',
      desc:'ê°€ê¹Œìš´ ì‚¬ëŒë“¤ ì‚¬ì´ì—ì„œ ë¹›ë‚˜ëŠ” ë§¤ë ¥ì´ì—ìš”. ê°€ì¡±Â·ì—°ì¸Â·ì§ì¥ ë™ë£Œì²˜ëŸ¼ ìì£¼ ë³´ëŠ” ì‚¬ëŒì—ê²Œ ë” ê¹Šì´ ê°ì¸ë˜ëŠ” íƒ€ì…. ì²˜ìŒ ë§Œë‚œ ì‚¬ëŒë³´ë‹¤ ì˜¤ë˜ ì•Œê³  ì§€ë‚¸ ì‚¬ëŒì´ "ì´ ì‚¬ëŒ ì§„ì§œ ë§¤ë ¥ìˆë‹¤" ê¹¨ë‹«ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.' },
    { key:'jangwoe',  on:SD.jangwoe,   cat:'ë°œí˜„', catC:'#ffd166', name:'ì¥ì™¸ë„í™”(ç‰†å¤–æ¡ƒèŠ±)', ico:'ğŸŒ',
      desc:'ì²˜ìŒ ë§Œë‚˜ëŠ” ì‚¬ëŒì—ê²Œë„ ê°•í•œ ì¸ìƒì„ ë‚¨ê¸°ëŠ” ëŒ€ì¤‘ì  ë§¤ë ¥ì´ì—ìš”. ì‚¬íšŒì ìœ¼ë¡œ í­ë„“ì€ ì¸ê¸°ë¥¼ ëŒê³ , ì¸í”Œë£¨ì–¸ì„œÂ·ë¯¸ë””ì–´Â·ëŒ€ì™¸ í™œë™ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚´ê¸° ì‰½ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë…¸ì¶œì´ ë§ì€ ë§Œí¼ êµ¬ì„¤ì´ë‚˜ ìŠ¤ìº”ë“¤ì— ì£¼ì˜ê°€ í•„ìš”í•´ìš”.' },
    { key:'nake',     on:SD.nake,      cat:'ë°œí˜„', catC:'#ffd166', name:'ë‚˜ì²´ë„í™”(è£¸é«”æ¡ƒèŠ±)', ico:'âœ¨',
      desc:'ê¾¸ë¯¸ì§€ ì•Šì•„ë„ ëˆˆì— ë„ëŠ” ì²œë¶€ì  ë§¤ë ¥ì´ì—ìš”. ì†”ì§í•˜ê³  í™”ëˆí•œ ì„±ê²© ê·¸ ìì²´ê°€ ë§¤ë ¥ í¬ì¸íŠ¸. ê¾¸ë°€ìˆ˜ë¡ ì˜¤íˆë ¤ ë§¤ë ¥ì´ ì¤„ì–´ë“¤ê³ , ìì—°ìŠ¤ëŸ½ê²Œ ìˆì„ ë•Œ ê°€ì¥ ë¹›ë‚˜ëŠ” íƒ€ì…ì´ì—ìš”.' },
    { key:'wollyeong',on:SD.wollyeong, cat:'ë°œí˜„', catC:'#ffd166', name:'ì›”ë ¹ë„í™”(æœˆä»¤æ¡ƒèŠ±)', ico:'ğŸŒ™',
      desc:'íƒœì–´ë‚œ í™˜ê²½ê³¼ ì„±ì¥ ë°°ê²½ì—ì„œ ë¹„ë¡¯ëœ ë§¤ë ¥ì´ì—ìš”. ì–´ë¦´ ë•Œë¶€í„° ì£¼ëª©ë°›ëŠ” í™˜ê²½ì—ì„œ ìë¼ë©° ë§¤ë ¥ì´ ì‚¶ ì „ë°˜ì— ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¤ë©°ë“¤ì–´ ìˆëŠ” íƒ€ì…ì´ì—ìš”.' },
    { key:'gwan',     on:SD.gwan,      cat:'ì„±ì§ˆ', catC:'#67e8f9', name:'ê´€ì„±ë„í™”(å®˜æ˜Ÿæ¡ƒèŠ±)', ico:'ğŸ‘‘',
      desc:'í’ˆê²© ìˆëŠ” ë§¤ë ¥ìœ¼ë¡œ ë†’ì€ ìë¦¬ì— ì˜¤ë¥´ëŠ” íƒ€ì…ì´ì—ìš”. ê¶Œìœ„ì™€ í•¨ê»˜í•˜ëŠ” ë§¤ë ¥ì´ë¼ ì‹ ë¢°ê°ê³¼ ì¹´ë¦¬ìŠ¤ë§ˆê°€ ê°•í•©ë‹ˆë‹¤. ë¦¬ë”Â·ì „ë¬¸ì§Â·ê³µì¸ì²˜ëŸ¼ ê¶Œìœ„ ìˆëŠ” ì—­í• ì—ì„œ ë¹›ì„ ë°œí•´ìš”.' },
    { key:'in',       on:SD.in,        cat:'ì„±ì§ˆ', catC:'#67e8f9', name:'ì¸ì„±ë„í™”(å°æ˜Ÿæ¡ƒèŠ±)', ico:'ğŸ“š',
      desc:'ì§€ì‹ê³¼ ì˜ˆìˆ ì  ì¬ëŠ¥ì—ì„œ ë°œí˜„ë˜ëŠ” ë§¤ë ¥ì´ì—ìš”. ì§€ì ì´ê³  ê¹Šì´ ìˆëŠ” ë§¤ë ¥ìœ¼ë¡œ í”¼ìƒì ì¸ ì¸ê¸°ë³´ë‹¤ ì§„ì‹¬ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì¸ê°„ê´€ê³„ë¥¼ ë§Œë“¤ì–´ìš”. ê°•ì˜Â·ì°½ì‘Â·ì˜ˆìˆ  ë¶„ì•¼ì—ì„œ íŒ¬ì¸µì´ ìƒê¸°ëŠ” íƒ€ì…ì´ì—ìš”.' },
    { key:'bijep',    on:SD.bijep,     cat:'ì„±ì§ˆ', catC:'#67e8f9', name:'ë¹„ê²ë„í™”(æ¯”åŠ«æ¡ƒèŠ±)', ico:'âš¡',
      desc:'ê²½ìŸí•˜ëŠ” í™˜ê²½ì—ì„œ ì˜¤íˆë ¤ ë” ë¹›ë‚˜ëŠ” ë§¤ë ¥ì´ì—ìš”. ë™ë£ŒÂ·ë™ê¸° ì‚¬ì´ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì£¼ì¸ê³µì´ ë˜ê³ , ë¹„êµë˜ëŠ” ìƒí™©ì—ì„œ ë§¤ë ¥ì´ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤. ì˜¤ë””ì…˜Â·ìŠ¤í¬ì¸ Â·ê²½ìŸ ì§êµ°ì—ì„œ ìœ ë… ê°•í•´ìš”.' },
    { key:'siks',     on:SD.siks,      cat:'ì„±ì§ˆ', catC:'#67e8f9', name:'ì‹ìƒë„í™”(é£Ÿå‚·æ¡ƒèŠ±)', ico:'ğŸ¤',
      desc:'ë§ì†œì”¨Â·í‘œí˜„ë ¥Â·ë¼ë¡œ ë°œì‚°í•˜ëŠ” ë§¤ë ¥ì´ì—ìš”. í¬ë¦¬ì—ì´í„°Â·ë°©ì†¡ì¸Â·ì•„í‹°ìŠ¤íŠ¸ì—ê²Œ ë§ì´ ë‚˜íƒ€ë‚˜ë©°, ì¬ëŠ¥ì„ í‘œí˜„í•˜ëŠ” ìˆœê°„ ë§¤ë ¥ì´ í­ë°œí•©ë‹ˆë‹¤. ì½˜í…ì¸ Â·ì˜ˆëŠ¥Â·ì˜ˆìˆ  ë¶„ì•¼ì—ì„œ íŒ¬ì„ ë§Œë“œëŠ” íƒ€ì…ì´ì—ìš”.' },
    { key:'golang',   on:SD.golang,    cat:'í¬ê·€', catC:'#a78bfa', name:'ê³¤ë‘ë„í™”(æ»¾æµªæ¡ƒèŠ±)', ico:'ğŸŒŠ',
      desc:'ë„í™”ì‚´ì´ 3ê°œ ì´ìƒ ê¸°ë‘¥ì— ê±¸ì³ ìˆìŠµë‹ˆë‹¤. ë¬¼ê²°ì´ ì†Œìš©ëŒì´ì¹˜ë“¯ ê°•ë ¬í•œ ë„í™” ê¸°ìš´. ì´ì„± ê´€ê³„ê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì ˆì œê°€ í•„ìš”í•©ë‹ˆë‹¤.' },
    { key:'pyeonya',  on:SD.pyeonya,   cat:'í¬ê·€', catC:'#a78bfa', name:'í¸ì•¼ë„í™”(éé‡æ¡ƒèŠ±)', ico:'ğŸŒº',
      desc:'ì‚¬ì£¼ ì „ì²´ì— ë§¤ë ¥ ì—ë„ˆì§€ê°€ ê°€ë“í•œ íƒ€ì…ì´ì—ìš”. ë“¤íŒì— ê½ƒì´ ë§Œë°œí•˜ë“¯ ì–´ë””ì„œë‚˜ ìì—°ìŠ¤ëŸ½ê²Œ ì£¼ëª©ë°›ìŠµë‹ˆë‹¤. ì—°ì˜ˆì¸Â·ì¸í”Œë£¨ì–¸ì„œ ê¸°ì§ˆì´ ê°•í•˜ê³  ëŒ€ì¤‘ì  ì‚¬ë‘ì„ ë°›ê¸° ìœ„í•´ íƒœì–´ë‚œ ì‚¬ëŒì´ì—ìš”.' },
    { key:'nokbang',  on:SD.nokbang,   cat:'í¬ê·€', catC:'#a78bfa', name:'ë…¹ë°©ë„í™”(ç¥¿å‚æ¡ƒèŠ±)', ico:'ğŸ’°',
      desc:'ì¸ê¸°ê°€ ê³§ ìˆ˜ìµìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì‹¤ì† ìˆëŠ” ë§¤ë ¥ì´ì—ìš”. ë§¤ë ¥ì„ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œ ë§Œë“œëŠ” ëŠ¥ë ¥ì´ ìˆì–´, í¬ë¦¬ì—ì´í„°Â·ì„œë¹„ìŠ¤Â·ì—°ì˜ˆ ë¶„ì•¼ì—ì„œ ì„±ê³µí•˜ê¸° ì‰¬ìš´ íƒ€ì…ì´ì—ìš”.' },
    { key:'dosap',    on:SD.dosap,     cat:'í¬ê·€', catC:'#a78bfa', name:'ë„ì‚½ë„í™”(å€’æ’æ¡ƒèŠ±)', ico:'ğŸ”„',
      desc:`ê±°ê¾¸ë¡œ ê½‚íŒ ë„í™”. ì¼ì§€(${JJ[r.dp.jj]}) ê¸°ì¤€ ë„ì‚½ ë„í™”ì§€ì§€ ${JJ[r.specialDohwa.dosapDohwaJji]}(${JJKR[r.specialDohwa.dosapDohwaJji]})ê°€ ì—°ì§€(${JJ[r.yp.jj]})ì— ìˆìŠµë‹ˆë‹¤. ë‚˜ë³´ë‹¤ ë‚˜ì´ ë§ì€ ì—°ìƒê³¼ ì¸ì—°ì´ ê¹Šê³ , ìœ—ì‚¬ëŒì˜ ë„ì›€ê³¼ ì§€ì§€ë¥¼ ë°›ê¸° ì‰¬ìš´ ê¸°ìš´ì…ë‹ˆë‹¤.` },
  ];

  const activeSpec = specList.filter(s => s.on);
  let specHtml = '';
  if (activeSpec.length === 0) {
    specHtml = `<div style="color:var(--muted);font-size:13px;text-align:center;padding:12px 0">ì¶”ê°€ë¡œ ë°œí˜„ëœ ë„í™” ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
  } else {
    specHtml = activeSpec.map(s => `
      <div style="padding:12px 0;border-bottom:1px solid var(--border)">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap">
          <span style="font-size:15px">${s.ico}</span>
          <span style="font-size:13px;font-weight:700;color:#ffd6e8">${s.name}</span>
          <span style="font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;
            background:${s.catC}22;color:${s.catC};border:1px solid ${s.catC}44;
            margin-left:auto;flex-shrink:0">${s.cat} ì ìˆ˜</span>
        </div>
        <div style="font-size:13px;color:var(--sub);line-height:1.85">${s.desc}</div>
      </div>`).join('');
    specHtml = specHtml.replace(/border-bottom:1px solid var\(--border\)(?=[^}]*<\/div>\s*$)/,'border-bottom:none');
  }
  document.getElementById('specialDohwaBody').innerHTML = specHtml;

  // â”€â”€ ì‚´ ë¶„ì„ â”€â”€
  const labelMap = { year:'ì—°ì£¼', month:'ì›”ì£¼', day:'ì¼ì£¼', hour:'ì‹œì£¼' };
  const salDefs = [
    { ico:'ğŸŒ¸', name:'ë„í™”ì‚´ (æ¡ƒèŠ±æ®º)', on:r.allDohwaEntries.length>0, col:'#ff5fa0',
      onTxt:r.allDohwaEntries.map(e=>`${e.name}: ${e.basisLabel}(${JJ[e.basisJji]}) ê¸°ì¤€ â†’ ${labelMap[e.pos]}ì— ë„í™”ì§€ì§€`).join(' / ') + '. ì´ì„±ì„ ëŒì–´ë‹¹ê¸°ëŠ” ê¸°ìš´ì´ ì‚¬ì£¼ì— ìƒˆê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.',
      offTxt:'ë„í™”ì§€ì§€ê°€ íƒ€ ê¸°ë‘¥ì— ì—†ìŠµë‹ˆë‹¤. ë‚´ë©´ì˜ ì§„ì •ì„± ìˆëŠ” ë§¤ë ¥ì„ ì§€ë‹Œ íƒ€ì….' },
    { ico:'ğŸ’œ', name:'í•¨ì§€ì‚´ (å’¸æ± æ®º)', on:r.hamjiSal, col:'#a78bfa',
      onTxt:`ì¼ì§€ ${JJ[r.dp.jj]}(${JJKR[r.dp.jj]})ì˜ ë„í™”ì§€ì§€ ${JJ[r.dohwaJjiByDay]}(${JJKR[r.dohwaJjiByDay]})ê°€ íƒ€ì£¼ì—ì„œ ë°œê²¬ë©ë‹ˆë‹¤. ì´ì„±ì—ê²Œ ê°•í•˜ê³  ì˜¤ë˜ ê¸°ì–µì— ë‚¨ëŠ” ì¸ìƒì„ ì¤ë‹ˆë‹¤.`,
      offTxt:`ì¼ì§€ ê¸°ì¤€ ë„í™”ì§€ì§€ ${JJ[r.dohwaJjiByDay]}(${JJKR[r.dohwaJjiByDay]})ê°€ íƒ€ì£¼ì— ì—†ìŠµë‹ˆë‹¤.` },
    { ico:'ğŸ”¥', name:'í™ì—¼ì‚´ (ç´…è‰¶æ®º)', on:r.hongyeomSal, col:'#ff6b6b',
      onTxt:`ì¼ê°„ ${CG[r.dp.cg]}(${CGKR[r.dp.cg]}) ê¸°ì¤€ í™ì—¼ì§€ì§€ ${JJ[r.hongyeomJji]}(${JJKR[r.hongyeomJji]})ê°€ ${r.hongyeomPillar}ì£¼ì— ìˆìŠµë‹ˆë‹¤. ì˜ë„ì¹˜ ì•Šì•„ë„ ê°•ë ¬í•˜ê²Œ ê°ì¸ë˜ëŠ” ë‚´ë©´ì˜ ë¶ˆê½ƒ ê°™ì€ ë§¤ë ¥.`,
      offTxt:`ì¼ê°„ ${CG[r.dp.cg]} ê¸°ì¤€ í™ì—¼ì§€ì§€ ${JJ[r.hongyeomJji]}(${JJKR[r.hongyeomJji]})ê°€ ì‚¬ì£¼ì— ì—†ìŠµë‹ˆë‹¤.` },
    { ico:'âš¡', name:'ê²ì‚´ (åŠ«æ®º)', on:r.gyeopsal, col:'#fb923c',
      onTxt:`ì—°ì§€ ê¸°ì¤€ ê²ì‚´ì§€ì§€ ${JJ[r.gyeopsalJji]}(${JJKR[r.gyeopsalJji]})ê°€ ${r.gyeopsalPillar}ì£¼ì— ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì¶©ê²©ì— ë…¸ì¶œë˜ê¸° ì‰½ì§€ë§Œ ê°•í•œ ê°œì²™ë ¥ê³¼ ëŒíŒŒë ¥ì´ ìˆìŠµë‹ˆë‹¤.`,
      offTxt:'ê²ì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ì™¸ë¶€ íƒˆì·¨ë³´ë‹¤ ì•ˆì •ì ì¸ í™˜ê²½ì—ì„œ ëŠ¥ë ¥ì„ ë°œíœ˜í•©ë‹ˆë‹¤.' },
    { ico:'ğŸ”’', name:'ì¬ì‚´ (ç½æ®º)', on:r.jaesal, col:'#94a3b8',
      onTxt:`ì—°ì§€ ê¸°ì¤€ ì¬ì‚´ì§€ì§€ ${JJ[r.jaesalJji]}(${JJKR[r.jaesalJji]})ê°€ ${r.jaesalPillar}ì£¼ì— ìˆìŠµë‹ˆë‹¤. ê´€ì¬Â·êµ¬ì„¤ ì£¼ì˜. ìœ„ê¸° ìƒí™©ì—ì„œ ê¸°ì§€(æ©Ÿæ™º)ì™€ ì„ê¸°ì‘ë³€ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.`,
      offTxt:'ì¬ì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ë²•ì  ë¶„ìŸë³´ë‹¤ ì•ˆì •ì ì¸ ëŒ€ì¸ê´€ê³„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.' },
    { ico:'ğŸ˜³', name:'ë§ì‹ ì‚´ (äº¡èº«æ®º)', on:r.mangshinsal, col:'#f472b6',
      onTxt:`ì—°ì§€ ê¸°ì¤€ ë§ì‹ ì§€ì§€ ${JJ[r.mangshinJji]}(${JJKR[r.mangshinJji]})ê°€ ${r.mangshinPillar}ì£¼ì— ìˆìŠµë‹ˆë‹¤. í–‰ë™ì´ ì™¸ë¶€ë¡œ ë“œëŸ¬ë‚˜ëŠ” ê¸°ìš´. ê³µì¸Â·í¬ë¦¬ì—ì´í„°ì—ê² ëª…ì˜ˆ, ì¼ë°˜ì¸ì—ê² ë…¸ì¶œ ì£¼ì˜.`,
      offTxt:'ë§ì‹ ì‚´ì€ ì—†ìŠµë‹ˆë‹¤. í–‰ë™ì´ ì™¸ë¶€ë¡œ í¬ê²Œ ë“œëŸ¬ë‚˜ì§€ ì•ŠëŠ” íƒ€ì….' },
    { ico:'ğŸ¨', name:'í™”ê°œì‚´ (è¯è“‹æ®º)', on:r.hwagaesal, col:'#818cf8',
      onTxt:`ì—°ì§€ ê¸°ì¤€ í™”ê°œì§€ì§€ ${JJ[r.hwagaeJji]}(${JJKR[r.hwagaeJji]})ê°€ ${r.hwagaePillar}ì£¼ì— ìˆìŠµë‹ˆë‹¤. ì˜ˆìˆ Â·ì¢…êµÂ·ì² í•™ì  ê¸°ì§ˆì´ ê°•í•©ë‹ˆë‹¤. ê³ ë…ì„ ì¦ê¸°ë©° ì°½ì‘ì—ì„œ ë¹›ë‚©ë‹ˆë‹¤.`,
      offTxt:'í™”ê°œì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ê³ ë…ë³´ë‹¤ ì‚¬ëŒê³¼ì˜ ì—°ê²°ì—ì„œ ì—ë„ˆì§€ë¥¼ ì–»ëŠ” íƒ€ì….' },
    { ico:'ğŸ', name:'ì—­ë§ˆì‚´ (é©›é¦¬æ®º)', on:r.yeokmasal, col:'#fbbf24',
      onTxt:'ì´ë™ì´ ì¦ê³  ë³€í™”ë¥¼ ì¦ê¸°ëŠ” ì—ë„ˆì§€. í•´ì™¸ í™œë™Â·ë¬´ì—­Â·ì´ë¯¼ì— ìœ ë¦¬í•˜ë©°, ë‹¤ì–‘í•œ ì‚¬ëŒê³¼ì˜ ë§Œë‚¨ì´ ë„í™” ê¸°ìš´ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.',
      offTxt:'ì—­ë§ˆì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ì •ì°©í˜• ì—ë„ˆì§€ë¡œ ê¹Šê³  ì•ˆì •ì ì¸ ì¸ê°„ê´€ê³„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.' },
    { ico:'ğŸ”®', name:'ê·€ë¬¸ê´€ì‚´ (é¬¼é–€é—œæ®º)', on:r.gwimunsal, col:'#67e8f9',
      onTxt:'ì‹ ë¹„ë¡­ê³  ì˜ˆë¯¼í•œ ê°ìˆ˜ì„±. ì§ê´€ë ¥ê³¼ ì˜ˆìˆ ì  ìƒìƒë ¥ì´ ë„˜ì³ ì´ ë¶„ìœ„ê¸° ìì²´ê°€ ê°•ë ¥í•œ ë§¤ë ¥ì´ ë©ë‹ˆë‹¤. ì˜ì Â·ì‹ ë¹„ë¡œìš´ ë¶„ì•¼ì™€ ì¸ì—°ì´ ê¹ŠìŠµë‹ˆë‹¤.',
      offTxt:'ê·€ë¬¸ê´€ì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì‹ ë¢°í˜• ë§¤ë ¥ì„ ì§€ë‹™ë‹ˆë‹¤.' },
    { ico:'ğŸŒ€', name:'ì›ì§„ì‚´ (å…ƒå—”æ®º)', on:r.wongjinsal, col:'#f87171',
      onTxt:`${r.wongjinPairs.join(', ')} ì›ì§„ ê´€ê³„. ê°•ë ¬í•œ ëŒë¦¼ê³¼ ë°˜ë°œì´ ê³µì¡´í•´, ê°ì • ê¸°ë³µ ìì²´ê°€ ë§¤ë ¥ì˜ ì¼ë¶€ê°€ ë˜ëŠ” ë“œë¼ë§ˆí‹±í•œ ì¸ì—° êµ¬ì¡°ì…ë‹ˆë‹¤.`,
      offTxt:'ì›ì§„ì‚´ì€ ì—†ìŠµë‹ˆë‹¤. ê· í˜• ì¡íŒ ëŒ€ì¸ê´€ê³„ ì—ë„ˆì§€ì…ë‹ˆë‹¤.' },
    { ico:'ğŸŒ‘', name:'ê³µë§ (ç©ºäº¡)', on:r.gongmangPillars.length>0, col:'#64748b',
      onTxt:`ì¼ì£¼ ê¸°ì¤€ ê³µë§ì§€ì§€(${r.gongmangJjList.map(j=>JJ[j]).join('Â·')})ê°€ ${r.gongmangPillars.join('Â·')}ì— ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì£¼ì˜ ê¸°ìš´ì´ ì•½í™”Â·í—ˆê³µì— ëœ¨ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ë¬¼ì§ˆë³´ë‹¤ ì •ì‹ ì  ê°€ì¹˜ì—ì„œ ì˜ë¯¸ë¥¼ ì°¾ìœ¼ë©´ ê¸¸í•©ë‹ˆë‹¤.`,
      offTxt:`ê³µë§ì§€ì§€(${r.gongmangJjList.map(j=>JJ[j]).join('Â·')})ê°€ ì‚¬ì£¼ ê¸°ë‘¥ì— ì—†ìŠµë‹ˆë‹¤. ì‚¬ì£¼ ì—ë„ˆì§€ê°€ ì‹¤ì§ˆì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.` },
  ];
  const onRows  = salDefs.filter(s => s.on);
  const offRows = salDefs.filter(s => !s.on);

  const renderSalRow = s => `
    <div class="sal-row">
      <div class="sal-ico">${s.ico}</div>
      <div class="sal-info">
        <div class="sal-name-row">
          <div class="sal-name">${s.name}</div>
          <span class="sal-tag" style="background:${s.on?s.col+'20':'rgba(255,255,255,.04)'};color:${s.on?s.col:'var(--muted)'};border:1px solid ${s.on?s.col+'44':'var(--border)'}">${s.on?'ìˆìŒ':'ì—†ìŒ'}</span>
        </div>
        <div class="sal-txt">${s.on?s.onTxt:s.offTxt}</div>
      </div>
    </div>`;

  const offCount = offRows.length;
  const offToggleHtml = offCount > 0 ? `
    <div id="salOffToggle" onclick="toggleSalOff()" style="
      display:flex;align-items:center;justify-content:center;gap:6px;
      padding:13px 20px;cursor:pointer;color:var(--muted);font-size:13px;font-weight:600;
      border-top:1px solid var(--border);transition:.2s;
    " onmouseover="this.style.color='var(--sub)'" onmouseout="this.style.color='var(--muted)'">
      <span id="salOffArrow" style="font-size:11px;transition:.2s">â–¼</span>
      <span id="salOffLabel">í•´ë‹¹ ì—†ëŠ” ì‚´ ${offCount}ê°œ ë” ë³´ê¸°</span>
    </div>
    <div id="salOffRows" style="display:none">${offRows.map(renderSalRow).join('')}</div>
  ` : '';

  document.getElementById('salRows').innerHTML =
    onRows.map(renderSalRow).join('') + offToggleHtml;

  window.toggleSalOff = function() {
    const rows  = document.getElementById('salOffRows');
    const arrow = document.getElementById('salOffArrow');
    const label = document.getElementById('salOffLabel');
    const isOpen = rows.style.display !== 'none';
    rows.style.display  = isOpen ? 'none' : 'block';
    arrow.textContent   = isOpen ? 'â–¼' : 'â–²';
    label.textContent   = isOpen ? `í•´ë‹¹ ì—†ëŠ” ì‚´ ${offCount}ê°œ ë” ë³´ê¸°` : 'ì ‘ê¸°';
  };

  // â”€â”€ 12ì‹ ì‚´ ì´ˆê¸° ë Œë” â”€â”€
  window.switchSinsalTab = function(tab) { renderSinsalGrid(r, tab); };
  // ì‹œì§€ ê¸°ì¤€ íƒ­: ì‹œê°„ ë¯¸ì…ë ¥ ì‹œ ë¹„í™œì„±
  const hourTabBtn = document.getElementById('stab-hour');
  if (hourTabBtn) hourTabBtn.style.display = r.hp ? '' : 'none';
  if (hourTabBtn) {
    if (!r.hp) {
      hourTabBtn.style.opacity = '0.35';
      hourTabBtn.style.cursor = 'not-allowed';
      hourTabBtn.onclick = null;
    }
  }
  renderSinsalGrid(r, 'year');
}

// â”€â”€â”€ 12ì‹ ì‚´ ê·¸ë¦¬ë“œ ë Œë”ë§ â”€â”€â”€
function renderSinsalGrid(r, tabMode) {
  ['year','day','month','hour'].forEach(t => {
    const el = document.getElementById('stab-' + t);
    if (el) el.className = 'stab' + (tabMode===t?' on':'');
  });

  const SS = r.sinsalResult;
  const ssByHour = SS.byHour;
  const baseMap = tabMode==='year' ? SS.byYear.map
                : tabMode==='day'  ? SS.byDay.map
                : tabMode==='month'? SS.byMonth.map
                : (ssByHour ? ssByHour.map : {});
  const grp     = tabMode==='year' ? SS.byYear.group
                : tabMode==='day'  ? SS.byDay.group
                : tabMode==='month'? SS.byMonth.group
                : (ssByHour ? ssByHour.group : null);
  const baseJjLabel = tabMode==='year'  ? JJ[r.yp.jj]+'('+JJKR[r.yp.jj]+')'
                    : tabMode==='day'   ? JJ[r.dp.jj]+'('+JJKR[r.dp.jj]+')'
                    : tabMode==='month' ? JJ[r.mp.jj]+'('+JJKR[r.mp.jj]+')'
                    : (r.hp ? JJ[r.hp.jj]+'('+JJKR[r.hp.jj]+')' : 'ë¯¸ì…ë ¥');
  const grpName = { A:'ç”³å­è¾°', B:'å¯…åˆæˆŒ', C:'å·³é…‰ä¸‘', D:'äº¥å¯æœª' }[grp];

  const cols = [
    { label:'ì‹œì£¼', jj: r.hp ? r.hp.jj : null },
    { label:'ì¼ì£¼', jj: r.dp.jj },
    { label:'ì›”ì£¼', jj: r.mp.jj },
    { label:'ì—°ì£¼', jj: r.yp.jj },
  ];
  const typeColor = { good:'#34d399', warn:'#fbbf24', bad:'#f87171', neut:'#a78bfa' };

  let gridHtml = `<div style="font-size:11px;color:var(--sub);margin-bottom:10px;text-align:center">ê¸°ì¤€: ${baseJjLabel} â†’ ì‚¼í•© ${grpName} ê·¸ë£¹</div>`;
  gridHtml += '<div class="ss-grid">';
  cols.forEach(col => {
    gridHtml += '<div class="ss-col">';
    gridHtml += `<div class="ss-head">${col.label}</div>`;
    if (col.jj === null) {
      gridHtml += '<div class="ss-cell"><span class="ss-empty">ë¯¸ì…ë ¥</span></div>';
    } else {
      const isSelf = (tabMode==='year'&&col.label==='ì—°ì£¼')||(tabMode==='day'&&col.label==='ì¼ì£¼')||(tabMode==='month'&&col.label==='ì›”ì£¼')||(tabMode==='hour'&&col.label==='ì‹œì£¼');
      const ss = baseMap[col.jj];
      const isChunEul = checkChunEul(r.dp.cg, col.jj);
      const info = SINSAL_INFO[ss] || {};
      const col_hex = ss ? (typeColor[info.type] || '#888') : 'var(--muted)';
      const jjColor = col.jj % 2 === 0 ? '#ff7bb8' : '#67aaff';
      const bgColor = ss && !isSelf ? (typeColor[info.type]||'#888')+'18' : 'transparent';
      gridHtml += `<div class="ss-cell" style="background:${bgColor};border-radius:8px;padding:6px 2px">`;
      gridHtml += `<div class="ss-jj" style="color:${jjColor};font-size:18px;font-weight:700">${JJ[col.jj]}</div>`;
      gridHtml += `<div style="font-size:10px;color:var(--muted);margin-bottom:2px">${JJKR[col.jj]}</div>`;
      if (isSelf) gridHtml += `<div class="ss-name" style="color:var(--muted);font-size:10px;border:1px solid var(--border);border-radius:99px;padding:1px 6px">ê¸°ì¤€</div>`;
      else if (ss) gridHtml += `<div class="ss-name" style="color:${col_hex};font-size:12px;font-weight:700;background:${col_hex}22;border-radius:99px;padding:2px 7px">${ss}</div>`;
      else gridHtml += `<div class="ss-empty" style="color:rgba(255,255,255,0.2)">â€”</div>`;
      if (isChunEul) gridHtml += `<div class="ss-name" style="color:#ffd166;font-size:9px;margin-top:2px">â˜…ê·€ì¸</div>`;
      gridHtml += '</div>';
    }
    gridHtml += '</div>';
  });
  gridHtml += '</div>';
  document.getElementById('ssGrid').innerHTML = gridHtml;

  // ìƒì„¸ ëª©ë¡
  const found = {};
  const roleLabel = { year:'ì—°ì£¼', month:'ì›”ì£¼', day:'ì¼ì£¼', hour:'ì‹œì£¼' };
  for (const [role, pd] of Object.entries(SS.pillars)) {
    if (!pd) continue;
    pd.sinsal.forEach(s => {
      if (s.basis !== 'chuneul' && s.basis !== tabMode) return;
      if (!found[s.name]) found[s.name] = [];
      found[s.name].push(roleLabel[role]);
    });
  }
  // ì²œì„ê·€ì¸
  for (const [role, pd] of Object.entries(SS.pillars)) {
    if (!pd) continue;
    if (checkChunEul(r.dp.cg, pd.jj)) {
      if (!found['ì²œì„ê·€ì¸']) found['ì²œì„ê·€ì¸'] = [];
      if (!found['ì²œì„ê·€ì¸'].includes(roleLabel[role])) found['ì²œì„ê·€ì¸'].push(roleLabel[role]);
    }
  }

  let detailHtml = '';
  if (Object.keys(found).length === 0) {
    detailHtml = '<div style="text-align:center;color:var(--muted);font-size:13px;padding:16px">í•´ë‹¹ ê¸°ì¤€ì˜ ì‹ ì‚´ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  } else {
    for (const [name, roles] of Object.entries(found)) {
      const info = name==='ì²œì„ê·€ì¸'
        ? { type:'good', ico:'â­', short:'ê·€ì¸ ê¸°ìš´Â·ë³´í˜¸ë§‰', desc:'ë‚˜ë¥¼ ë„ì™€ì£¼ëŠ” ê·€ì¸ì˜ ê¸°ìš´. í˜ë“  ìˆœê°„ì— ëœ»ë°–ì˜ ë„ì›€ì´ ì°¾ì•„ì™€ìš”.' }
        : (SINSAL_INFO[name] || {});
      const typeColor2 = { good:'#34d399', warn:'#fbbf24', bad:'#f87171', neut:'#a78bfa' };
      const col2 = typeColor2[info.type] || '#888';
      detailHtml += `<div class="ss-detail-item" style="border-left:3px solid ${col2}44;padding-left:12px">
        <div class="ss-di-ico">${info.ico || 'â€¢'}</div>
        <div class="ss-di-body">
          <div class="ss-di-title" style="color:${col2};font-size:14px;font-weight:700">${name}
            <span style="font-size:10px;color:var(--muted);font-weight:400;margin-left:4px">${info.short || ''}</span>
          </div>
          <div class="ss-di-where" style="font-size:11px;color:#a78bfa;margin:3px 0">ğŸ“ ${roles.join(' Â· ')}</div>
          <div class="ss-di-desc" style="font-size:12px;color:#c8c8d8;line-height:1.8">${info.desc || ''}</div>
        </div>
      </div>`;
    }
  }
  document.getElementById('ssDetails').innerHTML = detailHtml;
}

// â”€â”€â”€ ì‚´ ë±ƒì§€ íˆ´íŒ ìœ„ì¹˜ ë™ì  ì„¤ì • â”€â”€â”€
document.addEventListener('mouseover', function(e) {
  const badge = e.target.closest('.sal-badge');
  if (!badge) return;
  const tip = badge.querySelector('.sal-tip');
  if (!tip) return;
  const rect = badge.getBoundingClientRect();
  const tipW = 220;
  let left = rect.left + rect.width/2 - tipW/2;
  // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡
  left = Math.max(8, Math.min(left, window.innerWidth - tipW - 8));
  const top = rect.top - 8; // ë±ƒì§€ ìœ„ 8px
  tip.style.left = left + 'px';
  tip.style.top = (top - tip.offsetHeight || top - 70) + 'px';
});
document.addEventListener('touchstart', function(e) {
  const badge = e.target.closest('.sal-badge');
  if (!badge) return;
  const tip = badge.querySelector('.sal-tip');
  if (!tip) return;
  const rect = badge.getBoundingClientRect();
  const tipW = 220;
  let left = rect.left + rect.width/2 - tipW/2;
  left = Math.max(8, Math.min(left, window.innerWidth - tipW - 8));
  tip.style.left = left + 'px';
  tip.style.top = (rect.top - 80) + 'px';
}, {passive:true});



function getShareText() {
  if (!resData) return '';
  const T = TYPES[resData.typeKey] || TYPES.none;
  return `${T.emoji} ë‚˜ì˜ ë„í™”ì‚´ ì‚¬ì£¼ ê²°ê³¼\n\nìœ í˜•: ${T.title}\nê°•ë„: ${resData.level} (${resData.pct}%)\ní™ì—¼ì‚´: ${resData.hongyeomSal?'ìˆìŒ':'ì—†ìŒ'} | í•¨ì§€ì‚´: ${resData.hamjiSal?'ìˆìŒ':'ì—†ìŒ'}\n\n"${resData.levelDesc}"\n\në‚˜ë„ í…ŒìŠ¤íŠ¸í•˜ê¸° ğŸ‘‡\nhttps://webtoolbox.kr/dohwa/`;
}
function openShare() { document.getElementById('modalBg').classList.add('show'); }
function closeModal(e) { if (!e || e.target===document.getElementById('modalBg')) document.getElementById('modalBg').classList.remove('show'); }
async function shareNative() {
  const t = getShareText();
  if (navigator.share) { try { await navigator.share({ title:'ë„í™”ì‚´ ì‚¬ì£¼ ê²°ê³¼', text:t }); closeModal(); } catch(e) { if(e.name!=='AbortError') copyClip(t); } }
  else { copyClip(t); showToast('í…ìŠ¤íŠ¸ ë³µì‚¬ë¨! ğŸ“‹'); closeModal(); }
}
function shareKakao() { copyClip('https://webtoolbox.kr/dohwa/'); showToast('ë§í¬ ë³µì‚¬ë¨! ğŸ’¬'); closeModal(); }
function shareURL() { copyClip('https://webtoolbox.kr/dohwa/'); showToast('ë§í¬ ë³µì‚¬ë¨! ğŸ”—'); closeModal(); }
function copyTxt() { copyClip(getShareText()); showToast('ê²°ê³¼ ë³µì‚¬ë¨! ğŸ“‹'); }
function copyClip(t) { navigator.clipboard.writeText(t).catch(() => {}); }
function restart() {
  document.getElementById('resultScreen').style.display = 'none';
  document.getElementById('inputScreen').style.display = 'block';
  window.scrollTo({ top:0, behavior:'smooth' });
}

let toastT;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(toastT);
  toastT = setTimeout(() => el.classList.remove('show'), 2800);
}
</script>
</body>
</html>
