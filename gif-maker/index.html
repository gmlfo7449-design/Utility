<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GIF ë§Œë“¤ê¸° â€“ ì´ë¯¸ì§€, ë™ì˜ìƒ, í™”ë©´ ë…¹í™”, í…ìŠ¤íŠ¸ GIF ìƒì„±ê¸°</title>
<meta name="description" content="ë¬´ë£Œ ì˜¨ë¼ì¸ GIF ìƒì„±ê¸°. ì´ë¯¸ì§€ë¥¼ ëª¨ì•„ GIF ì• ë‹ˆë©”ì´ì…˜ì„ ë§Œë“¤ê±°ë‚˜, ë™ì˜ìƒì„ GIFë¡œ ë³€í™˜í•˜ê³ , í™”ë©´ ë…¹í™” GIF, í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ GIFë¥¼ ìƒì„±í•˜ì„¸ìš”.">
<meta name="keywords" content="GIF ë§Œë“¤ê¸°, GIF ìƒì„±ê¸°, ì´ë¯¸ì§€ GIF, ë™ì˜ìƒ GIF ë³€í™˜, í™”ë©´ ë…¹í™” GIF, í…ìŠ¤íŠ¸ GIF, ë¬´ë£Œ GIF">
<meta property="og:title" content="GIF ë§Œë“¤ê¸° â€“ ë¬´ë£Œ ì˜¨ë¼ì¸ GIF ìƒì„±ê¸°">
<meta property="og:description" content="ì´ë¯¸ì§€, ë™ì˜ìƒ, í™”ë©´ ë…¹í™”, í…ìŠ¤íŠ¸ë¡œ GIFë¥¼ ë§Œë“œì„¸ìš”. ì„œë²„ ì „ì†¡ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ìƒì„±ë©ë‹ˆë‹¤.">
<link rel="canonical" href="https://webtoolbox.kr/gif-maker/">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#f6f7f9;--surface:#fff;--border:#e4e6eb;
    --text:#1a1c20;--text-sub:#5f6368;--text-muted:#9aa0a8;
    --accent:#2563eb;--accent-hover:#1d4ed8;--accent-light:#eff4ff;
    --green:#16a34a;--green-light:#dcfce7;
    --red:#dc2626;--red-light:#fef2f2;
    --shadow-sm:0 1px 3px rgba(0,0,0,.04),0 1px 2px rgba(0,0,0,.06);
    --shadow-md:0 4px 12px rgba(0,0,0,.06),0 2px 4px rgba(0,0,0,.04);
    --radius:14px;--radius-sm:10px;
  }
  body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased}
  .nav{background:rgba(255,255,255,.92);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
  .nav-inner{max-width:960px;margin:0 auto;padding:0 24px;height:60px;display:flex;align-items:center;gap:10px}
  .nav-logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
  .nav-logo-icon{width:34px;height:34px;background:var(--accent);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-family:'Outfit',sans-serif;font-size:16px}
  .nav-logo-text{font-family:'Outfit',sans-serif;font-weight:700;font-size:18px}
  .nav-sep{color:var(--border);font-size:20px;font-weight:300}
  .nav-page{font-size:14px;color:var(--text-sub);font-weight:500}
  .container{max-width:960px;margin:0 auto;padding:32px 24px 80px}
  .page-header{text-align:center;margin-bottom:32px}
  .page-header h1{font-family:'Outfit',sans-serif;font-size:32px;font-weight:700;letter-spacing:-.5px;margin-bottom:10px}
  .page-header p{font-size:15px;color:var(--text-sub);max-width:520px;margin:0 auto}
  .ad-slot{margin:24px 0}
  .ad-banner{background:var(--surface);border:1px dashed var(--border);border-radius:var(--radius-sm);min-height:90px;display:flex;align-items:center;justify-content:center;color:var(--text-muted);font-size:13px}
  .tabs{display:flex;gap:4px;margin-bottom:20px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:4px;box-shadow:var(--shadow-sm);flex-wrap:wrap}
  .tab{flex:1;min-width:120px;padding:10px 16px;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:.15s;background:transparent;color:var(--text-muted);text-align:center}
  .tab.active{background:var(--accent);color:#fff}
  .tab:not(.active):hover{background:var(--bg);color:var(--text-sub)}
  .tab-icon{display:block;font-size:20px;margin-bottom:2px}
  .panel{display:none}.panel.active{display:block}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:16px;box-shadow:var(--shadow-sm)}
  .dropzone{border:2px dashed var(--border);border-radius:var(--radius);padding:40px 24px;text-align:center;cursor:pointer;transition:.2s;margin-bottom:16px}
  .dropzone:hover,.dropzone.dragover{border-color:var(--accent);background:var(--accent-light)}
  .dropzone-icon{font-size:40px;margin-bottom:8px}
  .dropzone-text{font-size:15px;font-weight:600;margin-bottom:4px}
  .dropzone-sub{font-size:13px;color:var(--text-muted)}
  .settings{display:flex;gap:16px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
  .setting{display:flex;align-items:center;gap:8px}
  .setting label{font-size:13px;font-weight:600;color:var(--text-sub);white-space:nowrap}
  .setting input[type=number],.setting select{padding:6px 10px;border:1px solid var(--border);border-radius:6px;font-size:13px;font-family:'JetBrains Mono',monospace;width:80px;outline:none}
  .setting input[type=range]{width:120px;accent-color:var(--accent)}
  .setting select{width:auto}
  .btn{padding:8px 18px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:.15s}
  .btn-primary{background:var(--accent);color:#fff}.btn-primary:hover{background:var(--accent-hover)}
  .btn-green{background:var(--green);color:#fff}.btn-green:hover{background:#15803d}
  .btn-red{background:var(--red-light);color:var(--red);border:1px solid #fecaca}.btn-red:hover{background:#fee2e2}
  .btn-outline{background:var(--surface);color:var(--text-sub);border:1px solid var(--border)}.btn-outline:hover{border-color:var(--accent);color:var(--accent)}
  .btn-lg{padding:12px 32px;font-size:15px;font-weight:700;border-radius:10px}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn-row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:16px 0}
  .frame-list{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;min-height:20px}
  .frame-item{width:80px;height:80px;border-radius:8px;border:2px solid var(--border);overflow:hidden;position:relative;cursor:grab}
  .frame-item img{width:100%;height:100%;object-fit:cover}
  .frame-item .frame-remove{position:absolute;top:2px;right:2px;width:20px;height:20px;background:rgba(0,0,0,.6);color:#fff;border:none;border-radius:50%;font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .frame-item .frame-num{position:absolute;bottom:2px;left:2px;background:rgba(0,0,0,.6);color:#fff;font-size:10px;padding:1px 5px;border-radius:3px;font-family:'JetBrains Mono',monospace}
  .preview-area{text-align:center;margin:16px 0;min-height:10px}
  .preview-area video{max-width:100%;max-height:400px;border-radius:var(--radius-sm);border:1px solid var(--border)}
  .progress-wrap{margin:12px 0;display:none}
  .progress-wrap.show{display:block}
  .progress-bar{width:100%;height:8px;background:var(--border);border-radius:4px;overflow:hidden}
  .progress-fill{height:100%;background:var(--accent);border-radius:4px;transition:width .15s}
  .progress-text{font-size:13px;color:var(--text-sub);text-align:center;margin-top:6px}
  .result-area{text-align:center;margin:16px 0;display:none}
  .result-area.show{display:block}
  .result-area img{max-width:100%;max-height:400px;border-radius:var(--radius-sm);border:1px solid var(--border);margin-bottom:12px}
  .result-info{font-size:13px;color:var(--text-sub);margin-bottom:12px}
  .result-info strong{color:var(--text)}
  .rec-dot{display:inline-block;width:10px;height:10px;background:var(--red);border-radius:50%;margin-right:6px;animation:blink 1s infinite}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
  .text-preview-canvas{border:1px solid var(--border);border-radius:var(--radius-sm);margin:12px auto;display:block;max-width:100%}
  .privacy{text-align:center;margin-top:24px;padding:14px;background:var(--green-light);border-radius:var(--radius-sm);font-size:13px;color:var(--green);font-weight:500}
  .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--text);color:#fff;padding:10px 20px;border-radius:8px;font-size:13px;font-weight:500;opacity:0;transition:.3s;z-index:999;pointer-events:none}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  .faq-section{margin-top:48px}.faq-section h2{font-size:20px;font-weight:700;margin-bottom:20px}
  .faq-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:10px;overflow:hidden}
  .faq-q{padding:16px 20px;font-weight:500;font-size:15px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
  .faq-q::after{content:'+';font-size:20px;color:var(--text-muted);transition:transform .2s}
  .faq-item.open .faq-q::after{transform:rotate(45deg)}
  .faq-a{max-height:0;overflow:hidden;transition:max-height .3s}
  .faq-a-inner{padding:0 20px 16px;color:var(--text-sub);font-size:14px;line-height:1.8}
  .faq-item.open .faq-a{max-height:300px}
  @media(max-width:640px){.page-header h1{font-size:24px}.tab{min-width:70px;padding:8px 8px;font-size:12px}.frame-item{width:60px;height:60px}}
</style>
</head>
<body>

<nav class="nav"><div class="nav-inner">
  <a href="/" class="nav-logo"><div class="nav-logo-icon">U</div><span class="nav-logo-text">Utility</span></a>
  <span class="nav-sep">/</span><span class="nav-page">GIF ë§Œë“¤ê¸°</span>
</div></nav>

<div class="container">
  <div class="page-header">
    <h1>GIF ë§Œë“¤ê¸°</h1>
    <p>ì´ë¯¸ì§€, ë™ì˜ìƒ, í™”ë©´ ë…¹í™”, í…ìŠ¤íŠ¸ë¡œ GIF ì• ë‹ˆë©”ì´ì…˜ì„ ë§Œë“œì„¸ìš”. ëª¨ë“  ì²˜ë¦¬ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p>
  </div>
  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('images')"><span class="tab-icon">ğŸ–¼ï¸</span>ì´ë¯¸ì§€ â†’ GIF</button>
    <button class="tab" onclick="switchTab('video')"><span class="tab-icon">ğŸ¬</span>ë™ì˜ìƒ â†’ GIF</button>
    <button class="tab" onclick="switchTab('screen')"><span class="tab-icon">ğŸ–¥ï¸</span>í™”ë©´ ë…¹í™”</button>
    <button class="tab" onclick="switchTab('text')"><span class="tab-icon">âœï¸</span>í…ìŠ¤íŠ¸ GIF</button>
  </div>

  <!-- 1. ì´ë¯¸ì§€ â†’ GIF -->
  <div class="panel active" id="panel-images">
    <div class="dropzone" id="imgDropzone">
      <div class="dropzone-icon">ğŸ–¼ï¸</div>
      <div class="dropzone-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì¶”ê°€</div>
      <div class="dropzone-sub">PNG, JPG, WebP Â· ì—¬ëŸ¬ ì¥ ì„ íƒ ê°€ëŠ¥ Â· ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½</div>
      <input type="file" id="imgInput" accept="image/*" multiple hidden>
    </div>
    <div class="frame-list" id="imgFrameList"></div>
    <div class="card">
      <div class="settings">
        <div class="setting"><label>í”„ë ˆì„ ì†ë„</label><input type="number" id="imgDelay" value="500" min="20" max="5000" step="50"><label>ms</label></div>
        <div class="setting"><label>ë„ˆë¹„</label><input type="number" id="imgWidth" value="320" min="50" max="800"><label>px</label></div>
        <div class="setting"><label>ë°˜ë³µ</label><select id="imgLoop"><option value="0">ë¬´í•œ</option><option value="1">1íšŒ</option><option value="3">3íšŒ</option></select></div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary btn-lg" id="btnImgGenerate" disabled>GIF ìƒì„±</button>
      <button class="btn btn-red" id="btnImgClear" disabled>ì „ì²´ ì‚­ì œ</button>
    </div>
  </div>

  <!-- 2. ë™ì˜ìƒ â†’ GIF -->
  <div class="panel" id="panel-video">
    <div class="dropzone" id="vidDropzone">
      <div class="dropzone-icon">ğŸ¬</div>
      <div class="dropzone-text">ë™ì˜ìƒ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</div>
      <div class="dropzone-sub">MP4, WebM ì§€ì› Â· ìµœëŒ€ 10ì´ˆ ê¶Œì¥</div>
      <input type="file" id="vidInput" accept="video/mp4,video/webm,video/*" hidden>
    </div>
    <div class="preview-area" id="vidPreview"></div>
    <div class="card">
      <div class="settings">
        <div class="setting"><label>ì‹œì‘</label><input type="number" id="vidStart" value="0" min="0" step="0.1"><label>ì´ˆ</label></div>
        <div class="setting"><label>ê¸¸ì´</label><input type="number" id="vidDuration" value="3" min="0.5" max="15" step="0.5"><label>ì´ˆ</label></div>
        <div class="setting"><label>FPS</label><select id="vidFps"><option value="5">5</option><option value="8" selected>8</option><option value="10">10</option><option value="15">15</option></select></div>
        <div class="setting"><label>ë„ˆë¹„</label><input type="number" id="vidWidth" value="320" min="100" max="800"><label>px</label></div>
      </div>
    </div>
    <div class="btn-row"><button class="btn btn-primary btn-lg" id="btnVidGenerate" disabled>GIF ìƒì„±</button></div>
  </div>

  <!-- 3. í™”ë©´ ë…¹í™” -->
  <div class="panel" id="panel-screen">
    <div class="card" style="text-align:center">
      <p style="margin-bottom:16px;color:var(--text-sub);font-size:14px">í™”ë©´, ì°½, ë˜ëŠ” íƒ­ì„ ì„ íƒí•˜ì—¬ ë…¹í™”í•˜ë©´ GIFë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
      <div class="settings" style="justify-content:center">
        <div class="setting"><label>ìµœëŒ€</label><input type="number" id="scrDuration" value="5" min="1" max="15"><label>ì´ˆ</label></div>
        <div class="setting"><label>FPS</label><select id="scrFps"><option value="5" selected>5</option><option value="8">8</option><option value="10">10</option></select></div>
        <div class="setting"><label>ë„ˆë¹„</label><input type="number" id="scrWidth" value="480" min="200" max="800"><label>px</label></div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary btn-lg" id="btnScrStart">ë…¹í™” ì‹œì‘</button>
        <button class="btn btn-red btn-lg" id="btnScrStop" style="display:none"><span class="rec-dot"></span>ë…¹í™” ì¤‘ì§€</button>
      </div>
      <div id="scrStatus" style="font-size:13px;color:var(--text-muted);margin-top:8px"></div>
    </div>
  </div>

  <!-- 4. í…ìŠ¤íŠ¸ GIF -->
  <div class="panel" id="panel-text">
    <div class="card">
      <div class="settings" style="flex-direction:column;align-items:stretch;gap:12px">
        <div class="setting" style="width:100%"><label style="min-width:60px">í…ìŠ¤íŠ¸</label><input type="text" id="txtContent" value="ì•ˆë…•í•˜ì„¸ìš”!" style="flex:1;width:auto;padding:8px 12px;font-size:15px;border:1px solid var(--border);border-radius:6px;font-family:'Noto Sans KR',sans-serif" maxlength="30"></div>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div class="setting"><label>íš¨ê³¼</label><select id="txtEffect"><option value="typewriter">íƒ€ì´í•‘</option><option value="bounce">ë°”ìš´ìŠ¤</option><option value="fade">í˜ì´ë“œì¸</option><option value="rainbow">ë ˆì¸ë³´ìš°</option><option value="shake">í”ë“¤ê¸°</option></select></div>
          <div class="setting"><label>í¬ê¸°</label><input type="number" id="txtSize" value="40" min="16" max="100"><label>px</label></div>
          <div class="setting"><label>ê¸€ê¼´ìƒ‰</label><input type="color" id="txtColor" value="#ffffff" style="width:40px;height:30px;border:1px solid var(--border);border-radius:4px;cursor:pointer"></div>
          <div class="setting"><label>ë°°ê²½ìƒ‰</label><input type="color" id="txtBg" value="#2563eb" style="width:40px;height:30px;border:1px solid var(--border);border-radius:4px;cursor:pointer"></div>
          <div class="setting"><label>ë„ˆë¹„</label><input type="number" id="txtWidth" value="400" min="200" max="800"></div>
          <div class="setting"><label>ë†’ì´</label><input type="number" id="txtHeight" value="160" min="80" max="600"></div>
        </div>
      </div>
    </div>
    <div style="text-align:center"><canvas id="txtPreviewCanvas" class="text-preview-canvas" width="400" height="160"></canvas></div>
    <div class="btn-row">
      <button class="btn btn-outline" id="btnTxtPreview">ë¯¸ë¦¬ë³´ê¸°</button>
      <button class="btn btn-primary btn-lg" id="btnTxtGenerate">GIF ìƒì„±</button>
    </div>
  </div>

  <!-- ê³µí†µ ê²°ê³¼ -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
    <div class="progress-text" id="progressText"></div>
  </div>
  <div class="result-area" id="resultArea">
    <img id="resultImg" src="">
    <div class="result-info" id="resultInfo"></div>
    <div class="btn-row"><button class="btn btn-green btn-lg" id="btnDownload">ë‹¤ìš´ë¡œë“œ</button></div>
  </div>

  <div class="privacy">ğŸ”’ ì„œë²„ ì „ì†¡ ì—†ìŒ â€“ ëª¨ë“  GIF ìƒì„±ì€ 100% ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤</div>
  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>

  <div class="faq-section">
    <h2>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)</h2>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">GIF íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í¬ë©´?</div><div class="faq-a"><div class="faq-a-inner">ë„ˆë¹„ë¥¼ ì¤„ì´ê±°ë‚˜ FPSë¥¼ ë‚®ì¶”ì„¸ìš”. ìƒ‰ìƒì´ ë‹¨ìˆœí•œ ì´ë¯¸ì§€ì¼ìˆ˜ë¡ GIF ì••ì¶•ì´ ì˜ ë©ë‹ˆë‹¤. ë™ì˜ìƒì€ ê¸¸ì´ë¥¼ ì§§ê²Œ ì„¤ì •í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.</div></div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">í™”ë©´ ë…¹í™”ê°€ ì•ˆ ë¼ìš”</div><div class="faq-a"><div class="faq-a-inner">Chrome, Edge, Firefoxì—ì„œ ì§€ì›ë©ë‹ˆë‹¤. SafariëŠ” ì œí•œì ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ í™”ë©´ ê³µìœ  ê¶Œí•œì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.</div></div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">ì²˜ë¦¬ê°€ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ê²½ìš°</div><div class="faq-a"><div class="faq-a-inner">í”„ë ˆì„ ìˆ˜ê°€ ë§ê±°ë‚˜ í•´ìƒë„ê°€ ë†’ìœ¼ë©´ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤. ë„ˆë¹„ 320px, 5~10FPS, 5ì´ˆ ì´ë‚´ê°€ ê°€ì¥ ë¹ ë¦…ë‹ˆë‹¤.</div></div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">ì´ë¯¸ì§€ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆë‚˜ìš”?</div><div class="faq-a"><div class="faq-a-inner">ë„¤. ì´ë¯¸ì§€ í”„ë ˆì„ì„ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. X ë²„íŠ¼ìœ¼ë¡œ ê°œë³„ ì‚­ì œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div></div></div>
  </div>
  <div class="ad-slot"><div class="ad-banner">ê´‘ê³  ì˜ì—­</div></div>
</div>
<div class="toast" id="toast"></div>

<script>
// ========================================================
//  Self-contained GIF Encoder (zero external dependencies)
//  Based on GIF89a specification + LZW compression
// ========================================================

class GIFEncoder {
  constructor(width, height) {
    this.width = width;
    this.height = height;
    this.data = [];
    this.frames = [];
    this.repeat = 0; // 0 = infinite
    this.delay = 100; // ms
    this.finished = false;
  }

  setRepeat(r) { this.repeat = r; }
  setDelay(ms) { this.delay = ms; }

  addFrame(canvas) {
    const ctx = canvas.getContext('2d');
    const imageData = ctx.getImageData(0, 0, this.width, this.height);
    const pixels = imageData.data; // RGBA

    // Quantize to 256 colors using median cut (simplified)
    const { palette, indexed } = this._quantize(pixels);
    this.frames.push({ palette, indexed, delay: this.delay });
  }

  finish() {
    const out = [];
    // Header
    this._writeStr(out, 'GIF89a');
    // Logical Screen Descriptor
    this._writeU16(out, this.width);
    this._writeU16(out, this.height);
    out.push(0x70); // GCT flag=0, color res=7, sort=0, GCT size=0 (no global table)
    out.push(0);    // bg color index
    out.push(0);    // pixel aspect ratio

    // Netscape Extension (loop)
    this._writeStr(out, '\x21\xFF\x0BNETSCAPE2.0');
    out.push(3, 1);
    this._writeU16(out, this.repeat);
    out.push(0);

    for (const frame of this.frames) {
      // Graphics Control Extension
      out.push(0x21, 0xF9, 4);
      out.push(0x04); // disposal=none, no transparent
      this._writeU16(out, Math.round(frame.delay / 10)); // delay in 1/100s
      out.push(0);    // transparent index
      out.push(0);    // terminator

      // Image Descriptor
      out.push(0x2C);
      this._writeU16(out, 0); // left
      this._writeU16(out, 0); // top
      this._writeU16(out, this.width);
      this._writeU16(out, this.height);
      out.push(0x87); // local color table, 256 colors (2^(7+1))

      // Local Color Table (256 * 3 bytes)
      for (let i = 0; i < 256; i++) {
        out.push(frame.palette[i * 3] || 0);
        out.push(frame.palette[i * 3 + 1] || 0);
        out.push(frame.palette[i * 3 + 2] || 0);
      }

      // LZW Image Data
      const minCodeSize = 8;
      out.push(minCodeSize);
      const lzwData = this._lzwEncode(frame.indexed, minCodeSize);
      // Write in sub-blocks (max 255 bytes each)
      let offset = 0;
      while (offset < lzwData.length) {
        const chunkSize = Math.min(255, lzwData.length - offset);
        out.push(chunkSize);
        for (let i = 0; i < chunkSize; i++) {
          out.push(lzwData[offset + i]);
        }
        offset += chunkSize;
      }
      out.push(0); // block terminator
    }

    out.push(0x3B); // Trailer
    return new Blob([new Uint8Array(out)], { type: 'image/gif' });
  }

  _writeStr(out, str) {
    for (let i = 0; i < str.length; i++) out.push(str.charCodeAt(i));
  }
  _writeU16(out, val) {
    out.push(val & 0xFF);
    out.push((val >> 8) & 0xFF);
  }

  // Simple color quantization using frequency-based palette
  _quantize(pixels) {
    const w = this.width, h = this.height, total = w * h;
    const colorMap = new Map();

    // Sample pixels (every pixel for small images, stride for large)
    const stride = total > 50000 ? 3 : 1;
    for (let i = 0; i < total; i += stride) {
      const off = i * 4;
      // Reduce to 5-bit per channel for grouping
      const r5 = pixels[off] >> 3;
      const g5 = pixels[off + 1] >> 3;
      const b5 = pixels[off + 2] >> 3;
      const key = (r5 << 10) | (g5 << 5) | b5;
      colorMap.set(key, (colorMap.get(key) || 0) + 1);
    }

    // Sort by frequency, take top 256
    const sorted = [...colorMap.entries()].sort((a, b) => b[1] - a[1]);
    const paletteEntries = sorted.slice(0, 256);

    // Build palette RGB array and lookup
    const palette = new Uint8Array(256 * 3);
    const lookup = new Map();
    for (let i = 0; i < paletteEntries.length; i++) {
      const key = paletteEntries[i][0];
      const r5 = (key >> 10) & 31;
      const g5 = (key >> 5) & 31;
      const b5 = key & 31;
      palette[i * 3] = (r5 << 3) | (r5 >> 2);
      palette[i * 3 + 1] = (g5 << 3) | (g5 >> 2);
      palette[i * 3 + 2] = (b5 << 3) | (b5 >> 2);
      lookup.set(key, i);
    }

    // Map each pixel to nearest palette index
    const indexed = new Uint8Array(total);
    for (let i = 0; i < total; i++) {
      const off = i * 4;
      const r5 = pixels[off] >> 3;
      const g5 = pixels[off + 1] >> 3;
      const b5 = pixels[off + 2] >> 3;
      const key = (r5 << 10) | (g5 << 5) | b5;
      if (lookup.has(key)) {
        indexed[i] = lookup.get(key);
      } else {
        // Find nearest color in palette
        indexed[i] = this._findNearest(palette, paletteEntries.length, pixels[off], pixels[off+1], pixels[off+2]);
      }
    }

    return { palette, indexed };
  }

  _findNearest(palette, count, r, g, b) {
    let minDist = Infinity, best = 0;
    for (let i = 0; i < count; i++) {
      const dr = r - palette[i*3];
      const dg = g - palette[i*3+1];
      const db = b - palette[i*3+2];
      const dist = dr*dr + dg*dg + db*db;
      if (dist < minDist) { minDist = dist; best = i; }
    }
    return best;
  }

  // LZW Encoding for GIF
  _lzwEncode(indexed, minCodeSize) {
    const clearCode = 1 << minCodeSize;
    const eoiCode = clearCode + 1;
    let codeSize = minCodeSize + 1;
    let nextCode = eoiCode + 1;
    const maxCode = 4096;

    // Output bit stream
    const output = [];
    let curByte = 0;
    let curBit = 0;

    function writeBits(code, size) {
      curByte |= (code << curBit);
      curBit += size;
      while (curBit >= 8) {
        output.push(curByte & 0xFF);
        curByte >>= 8;
        curBit -= 8;
      }
    }

    // Initialize code table
    let table = new Map();
    function resetTable() {
      table = new Map();
      for (let i = 0; i < clearCode; i++) {
        table.set(String(i), i);
      }
      codeSize = minCodeSize + 1;
      nextCode = eoiCode + 1;
    }

    resetTable();
    writeBits(clearCode, codeSize);

    let current = String(indexed[0]);
    for (let i = 1; i < indexed.length; i++) {
      const next = String(indexed[i]);
      const combined = current + ',' + next;

      if (table.has(combined)) {
        current = combined;
      } else {
        writeBits(table.get(current), codeSize);

        if (nextCode < maxCode) {
          table.set(combined, nextCode);
          nextCode++;
          if (nextCode > (1 << codeSize) && codeSize < 12) {
            codeSize++;
          }
        } else {
          writeBits(clearCode, codeSize);
          resetTable();
        }
        current = next;
      }
    }

    writeBits(table.get(current), codeSize);
    writeBits(eoiCode, codeSize);

    // Flush remaining bits
    if (curBit > 0) output.push(curByte & 0xFF);

    return output;
  }
}

// ========================================================
//  UI Logic
// ========================================================
const progressWrap = document.getElementById('progressWrap');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const resultArea = document.getElementById('resultArea');
const resultImg = document.getElementById('resultImg');
const resultInfo = document.getElementById('resultInfo');
const toastEl = document.getElementById('toast');
let resultBlob = null;

function switchTab(name) {
  document.querySelectorAll('.tab').forEach((t, i) => {
    const panels = ['images','video','screen','text'];
    t.classList.toggle('active', panels[i] === name);
  });
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  resultArea.classList.remove('show');
  progressWrap.classList.remove('show');
}

function showProgress(pct, text) {
  progressWrap.classList.add('show');
  progressFill.style.width = pct + '%';
  progressText.textContent = text || '';
}
function hideProgress() { progressWrap.classList.remove('show'); }

function showResult(blob) {
  resultBlob = blob;
  resultImg.src = URL.createObjectURL(blob);
  resultInfo.innerHTML = '<strong>íŒŒì¼ í¬ê¸°:</strong> ' + formatSize(blob.size);
  resultArea.classList.add('show');
  hideProgress();
  showToast('GIF ìƒì„± ì™„ë£Œ!');
  resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

document.getElementById('btnDownload').onclick = () => {
  if (!resultBlob) return;
  const a = document.createElement('a'); a.href = URL.createObjectURL(resultBlob);
  a.download = 'animation.gif'; a.click();
};

function formatSize(b) {
  if (b < 1024) return b + ' B';
  if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
  return (b/1048576).toFixed(2) + ' MB';
}
function showToast(m) { toastEl.textContent = m; toastEl.classList.add('show'); setTimeout(() => toastEl.classList.remove('show'), 2500); }

// Async yield to keep UI responsive
function yieldFrame() { return new Promise(r => setTimeout(r, 0)); }

async function encodeGIF(canvases, width, height, delay, repeat, onProgress) {
  const enc = new GIFEncoder(width, height);
  enc.setRepeat(repeat);
  enc.setDelay(delay);
  for (let i = 0; i < canvases.length; i++) {
    enc.addFrame(canvases[i]);
    if (onProgress) onProgress(i, canvases.length);
    if (i % 2 === 0) await yieldFrame(); // let UI update
  }
  return enc.finish();
}

// ===== 1. ì´ë¯¸ì§€ â†’ GIF =====
const imgFrames = [];
const imgDropzone = document.getElementById('imgDropzone');
const imgInput = document.getElementById('imgInput');
const imgFrameList = document.getElementById('imgFrameList');

imgDropzone.onclick = () => imgInput.click();
imgDropzone.ondragover = e => { e.preventDefault(); imgDropzone.classList.add('dragover'); };
imgDropzone.ondragleave = () => imgDropzone.classList.remove('dragover');
imgDropzone.ondrop = e => { e.preventDefault(); imgDropzone.classList.remove('dragover'); addImgFiles(e.dataTransfer.files); };
imgInput.onchange = () => { addImgFiles(imgInput.files); imgInput.value = ''; };

function addImgFiles(files) {
  Array.from(files).filter(f => f.type.startsWith('image/')).forEach(f => {
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => { imgFrames.push({ img, src: e.target.result }); renderImgFrames(); };
      img.src = e.target.result;
    };
    reader.readAsDataURL(f);
  });
}

function renderImgFrames() {
  imgFrameList.innerHTML = imgFrames.map((f, i) =>
    `<div class="frame-item" draggable="true" data-idx="${i}"><img src="${f.src}"><button class="frame-remove" onclick="event.stopPropagation();removeImgFrame(${i})">Ã—</button><span class="frame-num">${i+1}</span></div>`
  ).join('');
  document.getElementById('btnImgGenerate').disabled = imgFrames.length < 2;
  document.getElementById('btnImgClear').disabled = imgFrames.length === 0;
  imgFrameList.querySelectorAll('.frame-item').forEach(el => {
    el.ondragstart = e => e.dataTransfer.setData('text/plain', el.dataset.idx);
    el.ondragover = e => e.preventDefault();
    el.ondrop = e => {
      e.preventDefault();
      const from = +e.dataTransfer.getData('text/plain'), to = +el.dataset.idx;
      if (from !== to) { const item = imgFrames.splice(from, 1)[0]; imgFrames.splice(to, 0, item); renderImgFrames(); }
    };
  });
}
window.removeImgFrame = i => { imgFrames.splice(i, 1); renderImgFrames(); };
document.getElementById('btnImgClear').onclick = () => { imgFrames.length = 0; renderImgFrames(); };

document.getElementById('btnImgGenerate').onclick = async () => {
  if (imgFrames.length < 2) return;
  const w = +document.getElementById('imgWidth').value;
  const delay = +document.getElementById('imgDelay').value;
  const repeat = +document.getElementById('imgLoop').value;

  resultArea.classList.remove('show');
  showProgress(0, 'í”„ë ˆì„ ì¤€ë¹„ ì¤‘...');

  const canvases = imgFrames.map(f => {
    const ratio = f.img.naturalHeight / f.img.naturalWidth;
    const h = Math.round(w * ratio);
    const c = document.createElement('canvas'); c.width = w; c.height = h;
    c.getContext('2d').drawImage(f.img, 0, 0, w, h);
    return c;
  });

  const maxH = Math.max(...canvases.map(c => c.height));
  const final = canvases.map(c => {
    if (c.height === maxH) return c;
    const nc = document.createElement('canvas'); nc.width = w; nc.height = maxH;
    const ctx = nc.getContext('2d');
    ctx.fillStyle = '#000'; ctx.fillRect(0, 0, w, maxH);
    ctx.drawImage(c, 0, Math.floor((maxH - c.height) / 2));
    return nc;
  });

  const blob = await encodeGIF(final, w, maxH, delay, repeat, (i, t) => {
    showProgress(Math.round(((i+1)/t)*100), `ì¸ì½”ë”© ì¤‘... ${i+1}/${t} í”„ë ˆì„`);
  });
  showResult(blob);
};

// ===== 2. ë™ì˜ìƒ â†’ GIF =====
const vidDropzone = document.getElementById('vidDropzone');
const vidInput = document.getElementById('vidInput');
let videoEl = null;

vidDropzone.onclick = () => vidInput.click();
vidDropzone.ondragover = e => { e.preventDefault(); vidDropzone.classList.add('dragover'); };
vidDropzone.ondragleave = () => vidDropzone.classList.remove('dragover');
vidDropzone.ondrop = e => { e.preventDefault(); vidDropzone.classList.remove('dragover'); if (e.dataTransfer.files[0]) loadVideo(e.dataTransfer.files[0]); };
vidInput.onchange = () => { if (vidInput.files[0]) loadVideo(vidInput.files[0]); vidInput.value = ''; };

function loadVideo(file) {
  const url = URL.createObjectURL(file);
  videoEl = document.createElement('video');
  videoEl.src = url; videoEl.controls = true; videoEl.muted = true;
  videoEl.style.maxWidth = '100%'; videoEl.style.borderRadius = '10px';
  document.getElementById('vidPreview').innerHTML = '';
  document.getElementById('vidPreview').appendChild(videoEl);
  videoEl.onloadedmetadata = () => {
    document.getElementById('vidStart').max = Math.floor(videoEl.duration);
    document.getElementById('btnVidGenerate').disabled = false;
  };
}

function seekVideo(vid, time) {
  return new Promise(r => { vid.currentTime = time; const h = () => { vid.removeEventListener('seeked', h); r(); }; vid.addEventListener('seeked', h); });
}

document.getElementById('btnVidGenerate').onclick = async () => {
  if (!videoEl) return;
  const start = +document.getElementById('vidStart').value;
  const dur = +document.getElementById('vidDuration').value;
  const fps = +document.getElementById('vidFps').value;
  const w = +document.getElementById('vidWidth').value;
  const totalFrames = Math.ceil(dur * fps);
  const delay = Math.round(1000 / fps);
  const ratio = videoEl.videoHeight / videoEl.videoWidth;
  const h = Math.round(w * ratio);
  const canvas = document.createElement('canvas'); canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d');

  resultArea.classList.remove('show');
  showProgress(0, 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...');

  const frames = [];
  for (let i = 0; i < totalFrames; i++) {
    const time = start + (i / fps);
    if (time > videoEl.duration) break;
    await seekVideo(videoEl, time);
    ctx.drawImage(videoEl, 0, 0, w, h);
    const fc = document.createElement('canvas'); fc.width = w; fc.height = h;
    fc.getContext('2d').drawImage(canvas, 0, 0);
    frames.push(fc);
    showProgress(Math.round(((i+1)/totalFrames)*50), `í”„ë ˆì„ ì¶”ì¶œ ${i+1}/${totalFrames}`);
  }

  if (frames.length < 2) { hideProgress(); showToast('í”„ë ˆì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.'); return; }

  const blob = await encodeGIF(frames, w, h, delay, 0, (i, t) => {
    showProgress(50 + Math.round(((i+1)/t)*50), `ì¸ì½”ë”© ${i+1}/${t} í”„ë ˆì„`);
  });
  showResult(blob);
};

// ===== 3. í™”ë©´ ë…¹í™” =====
let screenStream = null, screenFrames = [], screenRecording = false, screenInterval = null;

document.getElementById('btnScrStart').onclick = async () => {
  try { screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false }); }
  catch { showToast('í™”ë©´ ê³µìœ ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤'); return; }

  screenRecording = true; screenFrames = [];
  document.getElementById('btnScrStart').style.display = 'none';
  document.getElementById('btnScrStop').style.display = 'inline-flex';
  resultArea.classList.remove('show');

  const maxDur = +document.getElementById('scrDuration').value * 1000;
  const fps = +document.getElementById('scrFps').value;
  const w = +document.getElementById('scrWidth').value;
  const video = document.createElement('video');
  video.srcObject = screenStream; video.muted = true; await video.play();
  const ratio = video.videoHeight / video.videoWidth;
  const h = Math.round(w * ratio);
  const canvas = document.createElement('canvas'); canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d');
  const startTime = Date.now();

  screenInterval = setInterval(() => {
    if (!screenRecording || Date.now() - startTime > maxDur) { stopScreen(); return; }
    ctx.drawImage(video, 0, 0, w, h);
    const fc = document.createElement('canvas'); fc.width = w; fc.height = h;
    fc.getContext('2d').drawImage(canvas, 0, 0);
    screenFrames.push(fc);
    document.getElementById('scrStatus').innerHTML = `<span class="rec-dot"></span>ë…¹í™” ì¤‘ ${((Date.now()-startTime)/1000).toFixed(1)}ì´ˆ Â· ${screenFrames.length} í”„ë ˆì„`;
  }, Math.round(1000 / fps));

  screenStream.getVideoTracks()[0].onended = () => stopScreen();
};

document.getElementById('btnScrStop').onclick = () => stopScreen();

async function stopScreen() {
  screenRecording = false;
  if (screenInterval) { clearInterval(screenInterval); screenInterval = null; }
  if (screenStream) { screenStream.getTracks().forEach(t => t.stop()); screenStream = null; }
  document.getElementById('btnScrStart').style.display = 'inline-flex';
  document.getElementById('btnScrStop').style.display = 'none';

  if (screenFrames.length < 2) { document.getElementById('scrStatus').textContent = 'í”„ë ˆì„ ë¶€ì¡±. ë” ê¸¸ê²Œ ë…¹í™”í•˜ì„¸ìš”.'; return; }

  document.getElementById('scrStatus').textContent = 'GIF ë³€í™˜ ì¤‘...';
  const fps = +document.getElementById('scrFps').value;
  const delay = Math.round(1000 / fps);
  const w = screenFrames[0].width, h = screenFrames[0].height;

  showProgress(0, 'GIF ì¸ì½”ë”© ì¤‘...');
  const blob = await encodeGIF(screenFrames, w, h, delay, 0, (i, t) => {
    showProgress(Math.round(((i+1)/t)*100), `ì¸ì½”ë”© ${i+1}/${t}`);
  });
  document.getElementById('scrStatus').textContent = '';
  showResult(blob);
}

// ===== 4. í…ìŠ¤íŠ¸ GIF =====
const txtCanvas = document.getElementById('txtPreviewCanvas');
const txtCtx = txtCanvas.getContext('2d');

function updateTxtPreview() {
  const w = +document.getElementById('txtWidth').value;
  const h = +document.getElementById('txtHeight').value;
  txtCanvas.width = w; txtCanvas.height = h;
  const text = document.getElementById('txtContent').value || 'í…ìŠ¤íŠ¸';
  const size = +document.getElementById('txtSize').value;
  const color = document.getElementById('txtColor').value;
  const bg = document.getElementById('txtBg').value;
  txtCtx.fillStyle = bg; txtCtx.fillRect(0, 0, w, h);
  txtCtx.fillStyle = color;
  txtCtx.font = `bold ${size}px "Noto Sans KR", sans-serif`;
  txtCtx.textAlign = 'center'; txtCtx.textBaseline = 'middle';
  txtCtx.fillText(text, w / 2, h / 2);
}

['txtContent','txtSize','txtColor','txtBg','txtWidth','txtHeight'].forEach(id =>
  document.getElementById(id).addEventListener('input', updateTxtPreview)
);
document.getElementById('btnTxtPreview').onclick = updateTxtPreview;

document.getElementById('btnTxtGenerate').onclick = async () => {
  const text = document.getElementById('txtContent').value || 'í…ìŠ¤íŠ¸';
  const effect = document.getElementById('txtEffect').value;
  const size = +document.getElementById('txtSize').value;
  const color = document.getElementById('txtColor').value;
  const bg = document.getElementById('txtBg').value;
  const w = +document.getElementById('txtWidth').value;
  const h = +document.getElementById('txtHeight').value;

  resultArea.classList.remove('show');
  showProgress(0, 'í”„ë ˆì„ ìƒì„± ì¤‘...');

  const frames = [];
  const total = effect === 'typewriter' ? text.length + 6 : 20;

  for (let i = 0; i < total; i++) {
    const c = document.createElement('canvas'); c.width = w; c.height = h;
    const ctx = c.getContext('2d');
    ctx.fillStyle = bg; ctx.fillRect(0, 0, w, h);
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.font = `bold ${size}px "Noto Sans KR", sans-serif`;
    const t = i / total;

    switch (effect) {
      case 'typewriter': {
        const chars = Math.min(i + 1, text.length);
        ctx.fillStyle = color;
        ctx.fillText(text.substring(0, chars), w/2, h/2);
        if (chars <= text.length && i % 2 === 0) {
          const tw = ctx.measureText(text.substring(0, chars)).width;
          ctx.fillRect(w/2 + tw/2 + 3, h/2 - size*0.4, 3, size*0.8);
        }
        break;
      }
      case 'bounce':
        ctx.fillStyle = color;
        ctx.fillText(text, w/2, h/2 - Math.abs(Math.sin(t * Math.PI * 3)) * h * 0.2);
        break;
      case 'fade':
        ctx.globalAlpha = Math.min(t * 2.5, 1);
        ctx.fillStyle = color; ctx.fillText(text, w/2, h/2);
        break;
      case 'rainbow':
        ctx.fillStyle = `hsl(${Math.round(t*360)%360},80%,60%)`;
        ctx.fillText(text, w/2, h/2);
        break;
      case 'shake':
        ctx.fillStyle = color;
        ctx.fillText(text, w/2 + (Math.random()-.5)*12, h/2 + (Math.random()-.5)*12);
        break;
    }
    frames.push(c);
    showProgress(Math.round(((i+1)/total)*40), `í”„ë ˆì„ ìƒì„± ${i+1}/${total}`);
    if (i % 3 === 0) await yieldFrame();
  }

  const delay = effect === 'typewriter' ? 180 : 80;
  const blob = await encodeGIF(frames, w, h, delay, 0, (i, t) => {
    showProgress(40 + Math.round(((i+1)/t)*60), `ì¸ì½”ë”© ${i+1}/${t}`);
  });
  showResult(blob);
};

updateTxtPreview();
</script>
</body>
</html>
